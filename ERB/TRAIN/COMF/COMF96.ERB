;後背位

;-------------------------------------------------
;コマンド名称
;-------------------------------------------------
@COM_NAME96
LOCALS:0 = 豚をＡにけしかけ

RESULTS:0 = %LOCALS:0%る
RESULTS:1 = %LOCALS:0%させられる
RESULTS:2 = %LOCALS:0%させる
RESULTS:3 = %LOCALS:0%られる
RESULTS:4 = %LOCALS:0%させる
RESULTS:5 = %LOCALS:0%るの見せつけ

;-------------------------------------------------
;選択可否判定
;-------------------------------------------------
@COM_ABLE96
;共通部分
CALL COM_ABLE_COMMON(96)
SIF RESULT == 0
	RETURN 0
;プレイヤーは最大で1人まで
SIF MPLY_NUM <= 0 || MPLY_NUM > 1
	RETURN 0
;ターゲットは最大で3人まで
SIF MTAR_NUM <= 0 || MTAR_NUM > 3
	RETURN 0
;プレイヤーが行動不能なら不可
SIF !IS_PLAYABLE(MPLY:0)
	RETURN 0
;バイブが必要
SIF !ITEM:豚 && !ITEM:A_豚
	RETURN 0
FOR LOCAL, 0, MTAR_NUM
	;プレイヤーとターゲットの挿入関係を取得
	LOCAL:1 = IS_INSERT_MUTUAL(MPLY:0, MTAR:(LOCAL))
	;ターゲットからプレイヤーに挿入中なら不可
	SIF LOCAL:1 == 3 || LOCAL:1 == 4
		RETURN 1
	;ターゲットのＡが埋まっているなら不可
	SIF IS_INSERT_SINGLE(MTAR:(LOCAL), "Ａ")
		RETURN 0
	;ターゲットが顔面騎乗されているなら不可
	SIF IS_RIDDEN(MTAR:(LOCAL))
		RETURN 0
	;ターゲットが顔面騎乗中なら不可
	SIF IS_RIDE(MTAR:(LOCAL))
		RETURN 0

	;ターゲットがクンニされているなら不可
	SIF IS_EQUIP_TARGET(MTAR:(LOCAL), 2)
		RETURN 0
	;ターゲットからプレイヤーにイラマ中なら不可
	SIF SEARCH_EQUIP(90, MTAR:(LOCAL), MPLY:0) >= 0
		RETURN 0
NEXT
RETURN 1

;-------------------------------------------------
;メイン処理
;-------------------------------------------------
@COM96
;実行判定
CALL COM_ORDER_COMMON
SIF RESULT == 0
	RETURN 0

;挿入関係を一時リセット
CALL CLEAR_INSERT_FLAG(MPLY:0, "Ｐ")
FOR LOCAL, 0, MTAR_NUM
;●ターゲット側の処理
DOWNBASE:(MTAR:(LOCAL)):体力 += 120

EXP:(MTAR:(LOCAL)):性技経験値 += 1
EXP:(MTAR:(LOCAL)):性交経験値 += 1

SOURCE:(MTAR:(LOCAL)):快Ａ = SENSE_SEX_TARGET(MPLY:0, MTAR:(LOCAL), 1500)
SOURCE:(MTAR:(LOCAL)):露出 = 800
SOURCE:(MTAR:(LOCAL)):性行動 = 450
SOURCE:(MTAR:(LOCAL)):不潔 = 300
SOURCE:(MTAR:(LOCAL)):逸脱 = 300
SOURCE:(MTAR:(LOCAL)):苦痛 = 150

IF MPLY:0 == MASTER
	CALL ADD_SOURCE_AIZYOU(MTAR:(LOCAL), 20)
ELSEIF MTAR:(LOCAL) != MASTER
	SOURCE:(MTAR:(LOCAL)):露出 += 400
ENDIF

;性交系の共通処理
CALL COM_COMMON_ASEX_A(MTAR:(LOCAL), MPLY:0)

;主導権に応じた優越・屈従のソース追加
CALL ADD_SOURCE_INITIATIVE_U(MTAR:(LOCAL), 120, 180)

;奉仕経験値を得られるコマンドのフラグ
TCVAR:(MTAR:(LOCAL)):4 = 1

;主導度変化基準値
TFLAG:49 = 3

;倒錯度変化基準値
TFLAG:50 = 1

;レズ・ＢＬ経験基準値
TFLAG:51 = 3

;豚の射精ゲージを追加
TFLAG:102 += SENSE_SEX_PLAYER_P(MTAR:LOCAL, MPLY:0, 1500)
IF TFLAG:102 >= 10000
	PRINTFORML 豚は%ANAME(MTAR:LOCAL)%の肛内に射精した……
	EXP:(MTAR:LOCAL):精愛経験値 += 1
	TFLAG:102 -= 10000
ENDIF
NEXT
RETURN 1

;-------------------------------------------------
;継続コマンドかどうかを設定
;-------------------------------------------------
@COM_IS_EQUIP96
RETURN 1

;-------------------------------------------------
;継続状態の処理
;-------------------------------------------------
@COM_EQUIP96(ARG:0)
FOR LOCAL, 0, MEQUIP_TARGET_NUM:(ARG:0)
LOCAL:2 = MEQUIP_PLAYER:(ARG:0):0
LOCAL:3 = MEQUIP_TARGET:(ARG:0):LOCAL

;ソースを退避
CALL PUTOUT_SOURCE(LOCAL:3)

DOWNBASE:(LOCAL:3):体力 += 50

EXP:(LOCAL:3):性技経験値 += 1
EXP:(LOCAL:3):性交経験値 += 1

SOURCE:(LOCAL:3):快Ａ += SENSE_SEX_TARGET(LOCAL:2, LOCAL:3, 750)
SOURCE:(LOCAL:3):露出 += 400
SOURCE:(LOCAL:3):性行動 += 150
SOURCE:(MTAR:0):不潔 = 120
SOURCE:(MTAR:0):逸脱 = 120
SOURCE:(MTAR:0):苦痛 = 100

;性交系の共通処理
CALL COM_COMMON_ASEX_A(LOCAL:3, LOCAL:2)

;奉仕経験値を得られるコマンドのフラグ
TCVAR:(LOCAL:3):4 = 1

;倒錯度変化基準値
TCVAR:(LOCAL:3):50 += 1

;退避したソースを加算
CALL SUM_SOURCE(LOCAL:3)

	;豚の射精ゲージを追加
	TFLAG:102 += SENSE_SEX_PLAYER_P(LOCAL:3, LOCAL:2, 1500)
	IF TFLAG:102 >= 10000
		PRINTFORML 豚は%ANAME(LOCAL:3)%の肛内に射精した……
		EXP:(LOCAL:3):精愛経験値 += 1
		TFLAG:102 -= 10000
	ENDIF

NEXT
;-------------------------------------------------
;継続中の表示
;-------------------------------------------------
@EQUIP_MESSAGE96(ARG:0)
RESULTS = 豚が%EQUIP_TARGET_ANAME(ARG:0)%のアナルに挿入中

;-------------------------------------------------
;継続中の地の文(前文)
;-------------------------------------------------
@COM_TEXT_BEFORE_EQUIP96(ARG:0)
PRINTFORML %EQUIP_TARGET_ANAME(ARG:0)%の尻穴が豚の竿を咥え込んでいる…

;-------------------------------------------------
;継続を解除したときの地の文
;-------------------------------------------------
@COM_TEXT_RELEASE_EQUIP96(ARG:0)
PRINTFORMW 豚は%EQUIP_TARGET_ANAME(ARG:0)%の尻穴からペニスを引き抜いた…

;-------------------------------------------------
;固有の実行判定(プレイヤー側)
;-------------------------------------------------
@COM_ORDER_PLAYER96(ARG:0)
;実行値の設定
TCVAR:(ARG:0):25 = 100

;膣性交共通
CALL COM_ORDER_VSEX_P(ARG:0)
RETURN 1

;-------------------------------------------------
;地の文(前文)
;-------------------------------------------------
@COM_TEXT_BEFORE96
IF ABL:(MTAR:0):Ａ感 >= 3
	LOCALS:0 = 十分に開発されたアナル
ELSEIF ABL:(MTAR:0):Ａ感 >= 2
	LOCALS:0 = 開発途上のアナル
ELSE
	LOCALS:0 = キツく閉じたアナル
ENDIF
SELECTCASE MTAR_NUM
	CASE 3
		LOCALS:1 = %ANAME(MTAR:0)%たち
	CASE 2
		LOCALS:1 = %ANAME(MTAR:0)%と%ANAME(MTAR:1)%
	CASE 1
		LOCALS:1 = %ANAME(MTAR:0)%
ENDSELECT

SELECTCASE GET_COM_INITIATIVE()
	;プレイヤーに主導権
	CASE 0
		PRINTFORML %ANAME(MPLY:0)%は豚に後ろから%LOCALS:1%の%LOCALS:0%にペニスを突き入れさせた
		PRINTFORMW 豚は興奮したように、何度も腰を打ち付け%TARGET_STR("た", "てきた")%…
	;ターゲットに主導権
	CASE 1
		PRINTFORMW %LOCALS:1%は%ANAME(MPLY:0)%に尻を向け、豚に後ろから%LOCALS:0%にペニスを挿入させた…
	;第三者に主導権
	CASEELSE
		PRINTFORML %ANAME(TFLAG:45)%は%ANAME(MPLY:0)%に、豚をけしかけて%LOCALS:1%を犯させるように命令した
		PRINTFORMW %ANAME(MPLY:0)%は%ANAME(MTAR:0)%を四つん這いにすると、豚に%LOCALS:1%の%LOCALS:0%へペニスを突き入れさせた
		PRINTFORMW 豚は興奮したように、何度も腰を打ち付けた…
ENDSELECT

