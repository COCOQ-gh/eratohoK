;武術を教える

;-------------------------------------------------
;コマンド名称
;-------------------------------------------------
@COM_NAME500
IF LOCAL:0 >= 0 && CFLAG:(MTAR:0):28 <= 2
	RESULTS = 外で遊ぶ
ELSE
	RESULTS = 武術を教える
ENDIF

;-------------------------------------------------
;選択可否判定
;-------------------------------------------------
@COM_ABLE500
;共通部分
CALL COM_ABLE_COMMON(500)
SIF RESULT == 0
	RETURN 0
;主人公がプレイヤーのとき限定
SIF MPLY:0 != MASTER
	RETURN 0
RETURN 1

;-------------------------------------------------
;メイン処理
;-------------------------------------------------
@COM500
;外で遊ぶ
IF LOCAL:0 >= 0 && CFLAG:(MTAR:0):28 <= 2
	;成長度を加算
	CFLAG:(MTAR:0):130 += POWER(2, 5 - CFLAG:(MTAR:0):110)
	;選択回数を加算
	CFLAG:(MTAR:0):110 ++

;武術を教える
ELSE
	;成長度を加算
	CFLAG:(MTAR:0):140 += (150 + ABL:(MPLY:0):武闘) / POWER(2, MAX(CFLAG:(MTAR:0):120, 63))
	;選択回数を加算
	CFLAG:(MTAR:0):120 ++
ENDIF

RETURN 1

;-------------------------------------------------
;地の文(前文)
;-------------------------------------------------
@COM_TEXT_BEFORE500
;外で遊ぶ
IF LOCAL:0 >= 0 && CFLAG:(MTAR:0):28 <= 2
	PRINTFORMW %ANAME(MPLY:0)%は%ANAME(MTAR:0)%と一緒に野山を駆け回って遊んだ

;武術を教える
ELSE
	PRINTFORMW %ANAME(MPLY:0)%は%ANAME(MTAR:0)%に武術の特訓を行った
ENDIF

;--------------------------------------------------------
;地の文(パラメータ・刻印変動後)
;--------------------------------------------------------
@COM_TEXT_LAST500
