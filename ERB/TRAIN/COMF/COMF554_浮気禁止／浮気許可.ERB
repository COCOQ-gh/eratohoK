;浮気禁止／浮気許可

;-------------------------------------------------
;コマンド名称
;-------------------------------------------------
@COM_NAME554
IF CFLAG:(MTAR:0):63
	RESULTS:0 = 浮気許可
ELSE
	RESULTS:0 = 浮気禁止
ENDIF

;-------------------------------------------------
;選択可否判定
;-------------------------------------------------
@COM_ABLE554
;共通部分
CALL COM_ABLE_COMMON(554)
SIF RESULT == 0
	RETURN 0
;プレイヤーは最大で1人まで
SIF MPLY_NUM <= 0 || MPLY_NUM > 1
	RETURN 0
;ターゲットは最大で1人まで
SIF MTAR_NUM <= 0 || MTAR_NUM > 1
	RETURN 0
;主人公がプレイヤーのとき限定
SIF MPLY:0 != MASTER
	RETURN 0
;恋慕or服従の霖之助・タチ役がターゲットのとき限定
;タチ役をCONFIG:88で設定
SIF !((MTAR:0 == CONFIG:88 || MTAR:0 == NAME_TO_CHARA("霖之助")) && (TALENT:(MTAR:0):恋慕 || TALENT:(MTAR:0):服従))
	RETURN 0
;プレイヤーの口が塞がっているなら不可
SIF IS_M_HOLD(MPLY:0)
	RETURN 0
RETURN 1

;-------------------------------------------------
;メイン処理
;-------------------------------------------------
@COM554
IF CFLAG:(MTAR:0):63
	PRINTFORMW %ANAME(MPLY:0)%は%ANAME(MTAR:0)%に、他の相手に積極的に手を出すように言い聞かせた
	PRINTFORMW %ANAME(MTAR:0)%は困惑している様子だが、%ANAME(MPLY:0)%がそれで構わないなら……と納得したようだ
ELSE
	PRINTFORMW %ANAME(MPLY:0)%は%ANAME(MTAR:0)%に、他の相手に手を出さないように言い聞かせた
	PRINTFORMW %ANAME(MTAR:0)%は%ANAME(MPLY:0)%が言うならと、浮気をしないことを約束した
ENDIF

CFLAG:(MTAR:0):63 = !CFLAG:(MTAR:0):63

RETURN 1
