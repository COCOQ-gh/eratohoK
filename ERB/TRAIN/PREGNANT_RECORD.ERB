;妊娠した子供の種親を記録する

;---------------------------------------------------------
;母親のキャラ番号と父親のIDを受け取り、母親の妊娠記録を更新する
;P_TIMESは回数 通常は1
;---------------------------------------------------------
@REFRESH_PREGNANT_RECORD(MOTHER, FATHER_ID, P_TIMES = 1)
#DIM MOTHER
#DIM FATHER_ID
#DIM P_TIMES

IF P_TIMES <= 0
	RETURN
ENDIF

;父親不明(=0)の場合、-1として記録
IF FATHER_ID == 0
	FATHER_ID = -1
ENDIF

;既に同一のIDが記録されているか調べる
FOR LOCAL:0, 0, PREGNANT_RECORD_MAX
	IF PREGNANT_RECORD_FATHER:MOTHER:(LOCAL:0) == FATHER_ID
		;同一のIDが見つかった場合、その父親による妊娠回数をP_TIMES分増やして終了
		PREGNANT_RECORD_TIMES:MOTHER:(LOCAL:0) += P_TIMES
		RETURN
	ENDIF
NEXT

;既存の記録が見つからなかった場合、空いている場所に新たに記録
FOR LOCAL:0, 0, PREGNANT_RECORD_MAX
	IF PREGNANT_RECORD_FATHER:MOTHER:(LOCAL:0) == 0
		PREGNANT_RECORD_FATHER:MOTHER:(LOCAL:0) = FATHER_ID
		PREGNANT_RECORD_TIMES:MOTHER:(LOCAL:0) = P_TIMES
		RETURN
	ENDIF
NEXT

;---------------------------------------------------------
; ARG:0番のキャラの妊娠記録を一括表示する
;---------------------------------------------------------
@SHOW_PREGNANT_RECORD(ARG:0)
VARSET LOCAL, 0

DRAWLINE
PRINTFORML ○%CALLNAME:(ARG:0)%の妊娠記録○

FOR LOCAL:0, 0, PREGNANT_RECORD_MAX
	LOCAL:3 = PREGNANT_RECORD_FATHER:(ARG:0):(LOCAL:0)
	IF LOCAL:3 != 0
		LOCAL:4 = PREGNANT_RECORD_TIMES:(ARG:0):(LOCAL:0)

		;特殊ネームはそれぞれ回数をLOCAL:6～LOCAL:11に記録
		IF LOCAL:3 == -10
			LOCAL:6 += LOCAL:4
		ELSEIF LOCAL:3 == -11
			LOCAL:7 += LOCAL:4
		ELSEIF LOCAL:3 == -12
			LOCAL:8 += LOCAL:4
		ELSEIF LOCAL:3 == -13
			LOCAL:9 += LOCAL:4
		ELSEIF LOCAL:3 == -16
			LOCAL:10 += LOCAL:4
		ELSEIF LOCAL:3 == -17
			LOCAL:11 += LOCAL:4
		ELSEIF LOCAL:3 == -14
			LOCAL:12 += LOCAL:4
		ELSEIF LOCAL:3 == -15
			LOCAL:13 += LOCAL:4
		;父親がわかっている場合、回数ごとにソートする
		ELSEIF LOCAL:3 >= 1 && ID_TO_CHARA(LOCAL:3) >= 0
			FOR LOCAL:1, 0, LOCAL:20 + 1
				IF LOCAL:4 > LOCAL:(LOCAL:1 + 200)
					FOR LOCAL:2, LOCAL:20 - 1, LOCAL:1 - 1, -1
						LOCAL:(LOCAL:2 + 101) = LOCAL:(LOCAL:2 + 100)
						LOCAL:(LOCAL:2 + 201) = LOCAL:(LOCAL:2 + 200)
					NEXT
					LOCAL:(LOCAL:1 + 100) = LOCAL:3
					LOCAL:(LOCAL:1 + 200) = LOCAL:4
					LOCAL:20 ++
					BREAK
				ENDIF
			NEXT

		;父親が不明または既に削除されている場合
		ELSE
			;「その他」の項目に回数を加算する
			LOCAL:5 += LOCAL:4
		ENDIF
	ENDIF
NEXT

FOR LOCAL:0, 0, LOCAL:20
	LOCAL:3 = LOCAL:(LOCAL:0 + 100)
	LOCAL:4 = LOCAL:(LOCAL:0 + 200)
	IF LOCAL:12 >= 1
		IF LOCAL:12 % 3 == 0
			PRINTL 
		ELSE
			PRINT     
		ENDIF
	ENDIF
	LOCAL:12 ++
	PRINTFORM %NAME_DOUBLE(ID_TO_CHARA(LOCAL:3)), 18, RIGHT%{LOCAL:4, 6, RIGHT}
NEXT
IF LOCAL:20 >= 1
	PRINTL 
	PRINTL 
ENDIF

SIF LOCAL:6 >= 1
	PRINTFORM               触手{LOCAL:6, 6, RIGHT}    
SIF LOCAL:7 >= 1
	PRINTFORM   誰とも知らぬ兵士{LOCAL:7, 6, RIGHT}    
SIF LOCAL:8 >= 1
	PRINTFORM             外来人{LOCAL:8, 6, RIGHT}    
SIF LOCAL:9 >= 1
	PRINTFORM       ホフゴブリン{LOCAL:9, 6, RIGHT}    
SIF LOCAL:10 >= 1
	PRINTFORM               野盗{LOCAL:10, 6, RIGHT}    
SIF LOCAL:11 >= 1
	PRINTFORM         金貸しの客{LOCAL:11, 6, RIGHT}    
SIF LOCAL:12 >= 1
	PRINTFORM                 犬{LOCAL:12, 6, RIGHT}    
SIF LOCAL:13 >= 1
	PRINTFORM                 豚{LOCAL:12, 6, RIGHT}    
SIF LOCAL:6 + LOCAL:7 + LOCAL:8 + LOCAL:9 + LOCAL:10 + LOCAL:11 + LOCAL:12 + LOCAL:13 >= 1
	PRINTL 

IF LOCAL:5 >= 1
	PRINTFORM       不明・その他{LOCAL:5, 6, RIGHT}
	PRINTL 
ENDIF

;表示件数ゼロなら無しと表示しておく
IF LOCAL:20 + LOCAL:5 + LOCAL:6 + LOCAL:7 + LOCAL:8 + LOCAL:9 + LOCAL:10 + LOCAL:11 + LOCAL:12 + LOCAL:13  <= 0
	PRINTL   なし
ENDIF
