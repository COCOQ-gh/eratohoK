;-------------------------------------------------
;都市ARG:0の情報を表示
;-------------------------------------------------
@SHOW_CITY_INFO(ARG:0)
#DIM UNIT_LIST, 5
#DIM SPACE
#DIM SHOW_UNITS
SHOW_UNITS = 0

;指定された都市または中継地点が存在しない場合
IF GET_RELAYNAME(ARG:0) == "無名"
	PRINTL 自勢力の都市、自勢力と隣接する都市の情報を見ることができます
	PRINTL 
	PRINTL 
	PRINTL 
	RETURN
ELSE
	FLAG:24 += 6
ENDIF

;防衛情報が参照可能かどうかのフラグ(自勢力の都市、または自勢力と隣接する都市のみ可能。観戦モードなら全て可)
LOCAL:4 = CFLAG:MASTER:1 >= 1 && (CITY_OWNER:(ARG:0) == CFLAG:MASTER:1 || IS_NEIGHBORING_COUNTRY(ARG:0, CFLAG:MASTER:1) >= 0)
LOCAL:4 = LOCAL:4 || FLAG:1

;都市上の敵部隊を取得し、変数UNIT_LISTに記録
CALL GET_STAY_UNIT(ARG:0)
FOR LOCAL:0, 0, 5
	UNIT_LIST:(LOCAL:0) = RESULT:(LOCAL:0)
NEXT

;中継地点
IF CITY_TYPE:(ARG:0) == 1
	LOCALS:0 = ◆中継地点(%GET_RELAYNAME(ARG:0)%)◆
	SPACE = STRLENS(LOCALS:0)+1
	PRINTFORML %LOCALS:0%

;	IF (CITY_OWNER:(ARG:0) == CFLAG:MASTER:1 || IS_INVADABLE(ARG:0, CFLAG:MASTER:1) || FLAG:1) && IS_STAY_UNIT(ARG:0)
;		PRINTBUTTON "[部隊一覧]", 2500 + ARG:0
;	ENDIF

;都市
ELSE
	LOCAL:6 = CITY_OWNER:(ARG:0)
	LOCAL:7 = GET_COUNTRY_BOSS(LOCAL:6)
	LOCALS:0 = ◆%GET_CITYNAME(ARG:0)%◆
;	LOCALS:0 = %LOCALS:0%%TOSTR_SPACE((10 - STRLENS(LOCALS:0)) / 2 * 2)%
	LOCALS:0 = %LOCALS:0%%TOSTR_SPACE((16 - STRLENS(LOCALS:0)) / 2 * 2)%
	LOCALS  += " "
	SPACE = STRLENS(LOCALS:0)
	;SPACE = MAX(23, STRLENS(LOCALS:0))
	PRINTFORML %LOCALS:0%
	;CALL SPACER( MAX( 0, 23 - STRLENS(LOCALS:0) ) )
	PRINT 所属:
	IF LOCAL:7 >= 0
		SETCOLOR COUNTRY_COLOR:(LOCAL:6)
		LOCALS:0 = %NAME:(LOCAL:7)%
		PRINTFORM %LOCALS:0%
		RESETCOLOR
		PRINTBUTTON "[色変更]", LOCAL:6 + 600
	ELSE
		LOCALS:0 = ----
		PRINTFORM %LOCALS:0%
		SETCOLOR COLOR("選択不可")
		PRINTPLAIN [色変更]
		RESETCOLOR
	ENDIF
	PRINTPLAINFORM %TOSTR_SPACE(8 - STRLENS(LOCALS:0))%
	IF LOCAL:4
		LOCALS:0 = {CITY_SOLDIER:(ARG:0)}
	ELSE
		LOCALS:0 = ????
	ENDIF
	PRINTPLAINFORM   防衛兵数:%LOCALS:0%
	IF CFLAG:MASTER:1 >= 1 && LOCAL:6 == CFLAG:MASTER:1 && CONFIG:302 == 0
		IF UNIT_LIST:0 >= 0
			SETCOLOR COLOR("敵")
			FONTSTYLE 4
		ENDIF
		PRINTBUTTON "[設定]", ARG:0 + 200
		RESETCOLOR
		FONTREGULAR
	ELSE
		SETCOLOR COLOR("選択不可")
		PRINTPLAINFORM [設定]
		RESETCOLOR
	ENDIF
	PRINTPLAINFORM %TOSTR_SPACE(8 - STRLENS(LOCALS:0))%
	IF LOCAL:4
		LOCALS:0 = %GET_CITY_COMMANDER_NAME(ARG:0)%
		IF LOCALS:0 == ""
			LOCALS:0 = ----
		ENDIF
		PRINTPLAINFORM 守将:%LOCALS:0%
	ELSE
		PRINTPLAINFORM 守将:????
	ENDIF
	IF CFLAG:MASTER:1 >= 1 && LOCAL:6 == CFLAG:MASTER:1 && CONFIG:302 == 0
		IF UNIT_LIST:0 >= 0
			SETCOLOR COLOR("敵")
			FONTSTYLE 4
		ENDIF
		PRINTBUTTON "[設定]", ARG:0 + 400
		PRINT 　
		PRINTBUTTON "[防衛解除]", ARG:0 + 800
		RESETCOLOR
		FONTREGULAR
	ELSE
		SETCOLOR COLOR("選択不可")
		PRINTPLAINFORM [設定]
		RESETCOLOR
	ENDIF
	LOCAL:12 = 0
	FOR LOCAL:11,0,10
		SIF UNIT_POSITION:(CFLAG:MASTER:1):(LOCAL:11) == ARG:0 && UNIT_SOLDIER:(CFLAG:MASTER:1):(LOCAL:11) > 0
;		SIF UNIT_POSITION:(CFLAG:MASTER:1):(LOCAL:11) == ARG:0
			LOCAL:12 ++
	NEXT
;	SIF LOCAL:12
;	PRINTBUTTON " [部隊駐留中]", 0
	PRINTL 
	
	LOCAL:8 = CITY_ECONOMY:(ARG:0) * 3 / 10000 + 100
	PRINTFORM 経済規模:{CITY_ECONOMY:(ARG:0) / 100, 4}/{CITY_ECONOMY_LIMIT:(ARG:0) / 100, 4}
	PRINTFORM      防衛倍率:%DECIMAL_STRING(CITY_GUARD:(ARG:0), 2)%(都市)
	PRINTFORM ×%DECIMAL_STRING(LOCAL:8, 2)%(経済)
	PRINT ×
	IF LOCAL:6 == CFLAG:MASTER:1
		SELECTCASE COUNTRY_POLICY:(CFLAG:MASTER:1)
			CASE 2
				PRINT 1.50
				LOCAL:9 = 15
			CASEELSE
				PRINT 1.00
				LOCAL:9 = 10
		ENDSELECT
		PRINTFORM (政策)＝%DECIMAL_STRING(CITY_GUARD:(ARG:0) * LOCAL:8 * LOCAL:9 / 1000, 2)%
	ELSEIF LOCAL:7 < 0
		PRINTFORM 1.00(政策)＝%DECIMAL_STRING(CITY_GUARD:(ARG:0) * LOCAL:8 / 100, 2)%
	ELSE
		PRINTFORM ????(政策)＝????
	ENDIF
	PRINTL 

	IF CHECK_COUNTRY_RELATION_F(CITY_OWNER:(ARG:0), CFLAG:MASTER:1) <= 0 || CITY_OWNER:(ARG:0)==0
		IF IS_INVADABLE(ARG:0, CFLAG:MASTER:1)
			IF DAY < SLG_PP:1
				FONTSTYLE 4
				PRINT [侵攻する]
				FONTSTYLE 0
				SETCOLOR COLOR("注意")
				PRINTFORM  ※{SLG_PP:1}期までは侵攻を行うことができません
				RESETCOLOR
			ELSEIF (GET_UNION_TARGET(CFLAG:MASTER:1) != -1 && GET_UNION_TARGET(CFLAG:MASTER:1) != CITY_OWNER:(ARG:0))
				LOCALS:8 '= NAME:(GET_COUNTRY_BOSS(GET_UNION_TARGET(CFLAG:MASTER:1)))
				FONTSTYLE 4
				PRINT [侵攻する]
				FONTSTYLE 0
				SETCOLOR COLOR("注意")
				PRINTFORM  ※反%LOCALS:8%連合に参加中であるため、%LOCALS:8%勢力以外への出撃ができません
				RESETCOLOR
			ELSE
				PRINTBUTTON "[侵攻する]", 2000+ARG:0
			ENDIF
			
		ELSE
			SETCOLOR COLOR("選択不可")
			PRINT [侵攻する]
			RESETCOLOR
		ENDIF
	ELSEIF CHECK_COUNTRY_RELATION_F(CITY_OWNER:(ARG:0), CFLAG:MASTER:1) >= 2
		IF DAY < SLG_PP:1
			FONTSTYLE 4
			PRINT [移動する]
			FONTSTYLE 0
			SETCOLOR COLOR("注意")
			PRINTFORM  ※{SLG_PP:1}期までは移動を行うことができません
			RESETCOLOR
		ELSE
			PRINTBUTTON "[移動する]", 2000+ARG:0
		ENDIF
	ENDIF
	IF LOCAL:12
		SETCOLOR COLOR("オレンジ")
		PRINTBUTTON " [部隊駐留中]", 0
		RESETCOLOR
	ENDIF
	PRINTL

ENDIF

FOR LOCAL:0, 0, 5
	LOCAL:8 = UNIT_LIST:(LOCAL:0)
	IF LOCAL:8 >= 0
		PRINTFORML ◆この場所に存在する部隊◆
		SHOW_UNITS++
		BREAK
	ENDIF
NEXT

FOR LOCAL, 0, 5
	LOCAL:8 = UNIT_LIST:(LOCAL:0)
	IF LOCAL:8 >= 0
		LOCAL:6 = GET_COUNTRY_BOSS(LOCAL:8)
		IF !LOCAL:4 || LOCAL:6 == -1
			CALL COLORPRINTFORM(@"%"????軍", 16, LEFT% 兵数:%"????", 10, LEFT%", COLOR("選択不可"), "L")
			SHOW_UNITS++
		ELSE
			FOR LOCAL:1, 0, MAX_UNIT
				IF UNIT_SOLDIER:(LOCAL:8):(LOCAL:1) > 0 && UNIT_POSITION:(LOCAL:8):(LOCAL:1) == ARG:0
					LOCALS:2 = %GET_UNIT_COMMANDER_NAME(LOCAL:8, LOCAL:1)%
					SIF LOCALS:2 != ""
						LOCALS:2 = <%LOCALS:2%>
					SELECTCASE CHECK_COUNTRY_RELATION_F(CFLAG:MASTER:1, LOCAL:8)
						CASE 0
							SETCOLOR COLOR("敵")
							PRINT 敵 
						CASE 1
							SETCOLOR COLOR("停戦")
							PRINT 停 
						CASE 2
							SETCOLOR COLOR("連合")
							PRINT 連 
						CASE 3
							SETCOLOR COLOR("同盟")
							PRINT 同 
						CASE 4
							SETCOLOR COLOR("永久同盟")
							PRINT 永 
						CASE 5
							PRINT 自 
					ENDSELECT
					SETCOLOR COUNTRY_COLOR:(LOCAL:8)
					PRINTFORM %ANAME(LOCAL:6) + "軍 ", 16, LEFT% 
					PRINTFORM %LOCALS:2, 32, LEFT%
					PRINTFORM 兵数:{UNIT_SOLDIER:(LOCAL:8):(LOCAL:1), 10, LEFT}
					PRINTL
					SHOW_UNITS++
					RESETCOLOR
				ENDIF
			NEXT
		ENDIF
	ENDIF
NEXT

FOR LOCAL:0, 0, 6 - SHOW_UNITS
	PRINTFORML 
NEXT
IF CITY_TYPE:(ARG:0) == 1
	PRINTFORML
	PRINTFORML
	PRINTFORML
ENDIF
@SPACER(ARG:0)
PRINTFORM %TOSTR_SPACE(ARG:0)%