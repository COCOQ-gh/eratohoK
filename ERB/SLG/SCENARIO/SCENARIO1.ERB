;-------------------------------------------------
;シナリオ1
;作品対抗幻想郷大戦（暫定）
;-------------------------------------------------
@SCENARIO_NAME_1
RESULTS = 幻想郷大戦
RETURN

@SCENARIO_1
PRINTFORML
PRINTFORMW 幻想郷は分裂した！
PRINTFORMW 各勢力が様々な思惑を絡め、争いあう！
PRINTFORMW だが目に見える勢力だけに囚われるな、水面下の動きにも気を払え！
PRINTFORMW 君はこの戦いを生き残り、幻想郷の覇者となれるのか！
PRINTL

;ランダムキャラは選択に委ねる
FLAG:4 = 0


;勢力設定
COUNTRY_BOSS:0 = 0
COUNTRY_COLOR:0 = GETDEFCOLOR()



;;--------霊夢;--------
COUNTRY_BOSS:1 = GET_ID(NAME_TO_CHARA("霊夢"))
COUNTRY_COLOR:1 = 0x757575
COUNTRY_AI_TYPE:1 = AI_外交

CITY_OWNER:GET_CITYNUMBER("博麗神社") = 1
CITY_OWNER:GET_CITYNUMBER("博麗大結界") = 1
CITY_OWNER:GET_CITYNUMBER("ミズナラの木") = 1
CITY_OWNER:GET_CITYNUMBER("裏手の池") = 1
;三妖精に萃香 あと華扇
;おーい誰か魅魔様の行方を(ry
CFLAG:(NAME_TO_CHARA("霊夢")):1 = 1
CFLAG:(NAME_TO_CHARA("サニーミルク")):1 = 1
CFLAG:(NAME_TO_CHARA("ルナチャイルド")):1 = 1
CFLAG:(NAME_TO_CHARA("スターサファイア")):1 = 1
CFLAG:(NAME_TO_CHARA("萃香")):1 = 1
CFLAG:(NAME_TO_CHARA("華扇")):1 = 1
CFLAG:(NAME_TO_CHARA("菫子")):1 = 1

;--------レミリア--------
COUNTRY_BOSS:2 = GET_ID(NAME_TO_CHARA("レミリア"))
COUNTRY_COLOR:2 = 0xFF0000
COUNTRY_AI_TYPE:2 = AI_好戦

CITY_OWNER:GET_CITYNUMBER("紅魔館") = 2
CITY_OWNER:GET_CITYNUMBER("地下図書館") = 2
;紅魔館組
CFLAG:(NAME_TO_CHARA("レミリア")):1 = 2
CFLAG:(NAME_TO_CHARA("美鈴")):1 = 2
CFLAG:(NAME_TO_CHARA("咲夜")):1 = 2
CFLAG:(NAME_TO_CHARA("小悪魔")):1 = 2
CFLAG:(NAME_TO_CHARA("パチュリー")):1 = 2
CFLAG:(NAME_TO_CHARA("フランドール")):1 = 2

;--------魔理沙--------
COUNTRY_BOSS:3 = GET_ID(NAME_TO_CHARA("魔理沙"))
COUNTRY_COLOR:3 = 0xE1D200
CITY_OWNER:GET_CITYNUMBER("マーガトロイド館") = 3
CITY_OWNER:GET_CITYNUMBER("霧雨魔法店") = 3
;アリスと人形たち　あと朱鷺子
CFLAG:(NAME_TO_CHARA("魔理沙")):1 = 3
CFLAG:(NAME_TO_CHARA("アリス")):1 = 3
CFLAG:(NAME_TO_CHARA("上海人形")):1 = 3
CFLAG:(NAME_TO_CHARA("蓬莱人形")):1 = 3
CFLAG:(NAME_TO_CHARA("大江戸人形")):1 = 3
CFLAG:(NAME_TO_CHARA("ゴリアテ人形")):1 = 3
CFLAG:(NAME_TO_CHARA("朱鷺子")):1 = 3

;--------幽々子--------
COUNTRY_BOSS:4 = GET_ID(NAME_TO_CHARA("幽々子"))
COUNTRY_COLOR:4 = 0xF5A9F2
COUNTRY_AI_TYPE:4 = AI_内政

CITY_OWNER:GET_CITYNUMBER("白玉楼") = 4
CITY_OWNER:GET_CITYNUMBER("七千階段") = 4
CITY_OWNER:GET_CITYNUMBER("西行妖") = 4
;アリスと橙以外の妖々夢組
CFLAG:(NAME_TO_CHARA("幽々子")):1 = 4
CFLAG:(NAME_TO_CHARA("リリカ")):1 = 4
CFLAG:(NAME_TO_CHARA("メルラン")):1 = 4
CFLAG:(NAME_TO_CHARA("ルナサ")):1 = 4
CFLAG:(NAME_TO_CHARA("妖夢")):1 = 4
CFLAG:(NAME_TO_CHARA("半霊")):1 = 4


;--------紫--------
COUNTRY_BOSS:5 = GET_ID(NAME_TO_CHARA("紫"))
COUNTRY_COLOR:5 = 0x792B90
COUNTRY_AI_TYPE:5 = AI_内政

CITY_OWNER:GET_CITYNUMBER("八雲屋敷") = 5
CITY_OWNER:GET_CITYNUMBER("マヨヒガ") = 5
;八雲家
CFLAG:(NAME_TO_CHARA("紫")):1 = 5
CFLAG:(NAME_TO_CHARA("藍")):1 = 5
CFLAG:(NAME_TO_CHARA("橙")):1 = 5
CFLAG:(NAME_TO_CHARA("妖忌")):1 = 5

;--------永琳--------
COUNTRY_BOSS:6 = GET_ID(NAME_TO_CHARA("永琳"))
COUNTRY_COLOR:6 = 0x778CFF
COUNTRY_AI_TYPE:6 = AI_防衛

CITY_OWNER:GET_CITYNUMBER("永遠亭") = 6
CITY_OWNER:GET_CITYNUMBER("素兎の集落") = 6
CITY_OWNER:GET_CITYNUMBER("迷いの竹林東部") = 6
CITY_OWNER:GET_CITYNUMBER("迷いの竹林西部") = 6

;永遠亭組
CFLAG:(NAME_TO_CHARA("永琳")):1 = 6
CFLAG:(NAME_TO_CHARA("てゐ")):1 = 6
CFLAG:(NAME_TO_CHARA("鈴仙")):1 = 6
CFLAG:(NAME_TO_CHARA("輝夜")):1 = 6


;--------映姫--------
COUNTRY_BOSS:7 = GET_ID(NAME_TO_CHARA("四季映姫"))
COUNTRY_COLOR:7 = 0x088A08
CITY_OWNER:GET_CITYNUMBER("彼岸") = 7
CITY_OWNER:GET_CITYNUMBER("是非曲直庁") = 7
CITY_OWNER:GET_CITYNUMBER("渡し舟処") = 7
;ヅカ組
CFLAG:(NAME_TO_CHARA("四季映姫")):1 = 7
CFLAG:(NAME_TO_CHARA("メディスン")):1 = 7
CFLAG:(NAME_TO_CHARA("幽香")):1 = 7
CFLAG:(NAME_TO_CHARA("小町")):1 = 7
CFLAG:(NAME_TO_CHARA("文")):1 = 7
CFLAG:(NAME_TO_CHARA("リリーブラック")):1 = 7


;--------神奈子--------
COUNTRY_BOSS:8 = GET_ID(NAME_TO_CHARA("神奈子"))
COUNTRY_COLOR:8 = 0x79FF4B
COUNTRY_AI_TYPE:8 = AI_好戦

CITY_OWNER:GET_CITYNUMBER("守矢神社") = 8
CITY_OWNER:GET_CITYNUMBER("風神の湖") = 8
CITY_OWNER:GET_CITYNUMBER("間欠泉地下センター") = 8
;風神録組とはたて
CFLAG:(NAME_TO_CHARA("静葉")):1 = 8
CFLAG:(NAME_TO_CHARA("穣子")):1 = 8
CFLAG:(NAME_TO_CHARA("雛")):1 = 8
CFLAG:(NAME_TO_CHARA("にとり")):1 = 8
CFLAG:(NAME_TO_CHARA("椛")):1 = 8
CFLAG:(NAME_TO_CHARA("はたて")):1 = 8
CFLAG:(NAME_TO_CHARA("早苗")):1 = 8
CFLAG:(NAME_TO_CHARA("諏訪子")):1 = 8
CFLAG:(NAME_TO_CHARA("神奈子")):1 = 8

;--------天子--------
COUNTRY_BOSS:9 = GET_ID(NAME_TO_CHARA("天子"))
COUNTRY_COLOR:9 = 0x002FFF

CITY_OWNER:GET_CITYNUMBER("桃園") = 9
CITY_OWNER:GET_CITYNUMBER("天人の都") = 9
CITY_OWNER:GET_CITYNUMBER("有頂天") = 9
CITY_OWNER:GET_CITYNUMBER("竜宮の遣い専用宿舎") = 9
CITY_OWNER:GET_CITYNUMBER("比那名居家総領娘屋敷") = 9
;天子衣玖
CFLAG:(NAME_TO_CHARA("天子")):1 = 9
CFLAG:(NAME_TO_CHARA("衣玖")):1 = 9


;--------さとり--------
COUNTRY_BOSS:10 = GET_ID(NAME_TO_CHARA("さとり"))
COUNTRY_COLOR:10 = 0xFA5882
COUNTRY_AI_TYPE:10 = AI_防衛

CITY_OWNER:GET_CITYNUMBER("地霊殿") = 10
CITY_OWNER:GET_CITYNUMBER("灼熱地獄跡") = 10
CITY_OWNER:GET_CITYNUMBER("旧都温泉街") = 10
;地霊殿組
CFLAG:(NAME_TO_CHARA("さとり")):1 = 10
CFLAG:(NAME_TO_CHARA("燐")):1 = 10
CFLAG:(NAME_TO_CHARA("空")):1 = 10
CFLAG:(NAME_TO_CHARA("こいし")):1 = 10


;--------白蓮--------
COUNTRY_BOSS:11 = GET_ID(NAME_TO_CHARA("白蓮"))
COUNTRY_COLOR:11 = 0xDF01D7
COUNTRY_AI_TYPE:11 = AI_外交

CITY_OWNER:GET_CITYNUMBER("命蓮寺") = 11
CITY_OWNER:GET_CITYNUMBER("墓地") = 11
;響子と小傘含む寺
CFLAG:(NAME_TO_CHARA("響子")):1 = 11
CFLAG:(NAME_TO_CHARA("ナズーリン")):1 = 11
CFLAG:(NAME_TO_CHARA("小傘")):1 = 11
CFLAG:(NAME_TO_CHARA("一輪")):1 = 11
CFLAG:(NAME_TO_CHARA("雲山")):1 = 11
CFLAG:(NAME_TO_CHARA("水蜜")):1 = 11
CFLAG:(NAME_TO_CHARA("星")):1 = 11
CFLAG:(NAME_TO_CHARA("白蓮")):1 = 11
CFLAG:(NAME_TO_CHARA("マミゾウ")):1 = 11

;--------神子--------
COUNTRY_BOSS:12 = GET_ID(NAME_TO_CHARA("神子"))
COUNTRY_COLOR:12 = 0xFF8000
COUNTRY_AI_TYPE:12 = AI_外交

CITY_OWNER:GET_CITYNUMBER("夢殿大祀廟") = 12
CITY_OWNER:GET_CITYNUMBER("神霊廟") = 12
;廟＋こころ
CFLAG:(NAME_TO_CHARA("神子")):1 = 12
CFLAG:(NAME_TO_CHARA("芳香")):1 = 12
CFLAG:(NAME_TO_CHARA("青娥")):1 = 12
CFLAG:(NAME_TO_CHARA("布都")):1 = 12
CFLAG:(NAME_TO_CHARA("屠自古")):1 = 12
CFLAG:(NAME_TO_CHARA("こころ")):1 = 12


;--------針妙丸--------
COUNTRY_BOSS:13 = GET_ID(NAME_TO_CHARA("針妙丸"))
COUNTRY_COLOR:13 = 0x00BFFF
CITY_OWNER:GET_CITYNUMBER("輝針城") = 13
;輝針城組
CFLAG:(NAME_TO_CHARA("わかさぎ姫")):1 = 13
CFLAG:(NAME_TO_CHARA("赤蛮奇")):1 = 13
CFLAG:(NAME_TO_CHARA("影狼")):1 = 13
CFLAG:(NAME_TO_CHARA("弁々")):1 = 13
CFLAG:(NAME_TO_CHARA("八橋")):1 = 13
CFLAG:(NAME_TO_CHARA("正邪")):1 = 13
CFLAG:(NAME_TO_CHARA("針妙丸")):1 = 13
CFLAG:(NAME_TO_CHARA("雷鼓")):1 = 13


;--------慧音（人里）--------
COUNTRY_BOSS:14 = GET_ID(NAME_TO_CHARA("慧音"))
COUNTRY_COLOR:14 = 0x974E00
COUNTRY_AI_TYPE:14 = AI_防衛

CITY_OWNER:GET_CITYNUMBER("阿求屋敷") = 14
CITY_OWNER:GET_CITYNUMBER("鈴奈庵") = 14
CITY_OWNER:GET_CITYNUMBER("人里住宅街") = 14
CITY_OWNER:GET_CITYNUMBER("霧雨店") = 14
CITY_OWNER:GET_CITYNUMBER("寺子屋") = 14
;慧音と妹紅とあきゅこす
CFLAG:(NAME_TO_CHARA("慧音")):1 = 14
CFLAG:(NAME_TO_CHARA("妹紅")):1 = 14
CFLAG:(NAME_TO_CHARA("阿求")):1 = 14
CFLAG:(NAME_TO_CHARA("小鈴")):1 = 14

;--------依姫--------
COUNTRY_BOSS:15 = GET_ID(NAME_TO_CHARA("依姫"))
COUNTRY_COLOR:15 = 0xFFF999
COUNTRY_AI_TYPE:15 = AI_好戦

CITY_OWNER:GET_CITYNUMBER("月の都") = 15
CITY_OWNER:GET_CITYNUMBER("月兎街") = 15
CITY_OWNER:GET_CITYNUMBER("綿月亭") = 15
CITY_OWNER:GET_CITYNUMBER("薬搗場") = 15

;月組
CFLAG:(NAME_TO_CHARA("依姫")):1 = 15
CFLAG:(NAME_TO_CHARA("豊姫")):1 = 15
CFLAG:(NAME_TO_CHARA("レイセン")):1 = 15
CFLAG:(NAME_TO_CHARA("鈴瑚")):1 = 15
CFLAG:(NAME_TO_CHARA("清蘭")):1 = 15
CFLAG:(NAME_TO_CHARA("サグメ")):1 = 15
CFLAG:(NAME_TO_CHARA("月の門番")):1 = 15

;--------チルノら--------
COUNTRY_BOSS:16 = GET_ID(NAME_TO_CHARA("チルノ"))
COUNTRY_COLOR:16 = 0x00FFF7
CITY_OWNER:GET_CITYNUMBER("霧の湖の畔") = 16
;たぶんここが一番キツいと思います まともなのいねぇ
CFLAG:(NAME_TO_CHARA("大妖精")):1 = 16
CFLAG:(NAME_TO_CHARA("チルノ")):1 = 16
CFLAG:(NAME_TO_CHARA("ルーミア")):1 = 16
CFLAG:(NAME_TO_CHARA("リグル")):1 = 16
CFLAG:(NAME_TO_CHARA("ミスティア")):1 = 16
CFLAG:(NAME_TO_CHARA("リリーホワイト")):1 = 16
CFLAG:(NAME_TO_CHARA("レティ")):1 = 16

;--------スターベア--------
COUNTRY_BOSS:17 = GET_ID(NAME_TO_CHARA("勇儀"))
COUNTRY_COLOR:17 = 0XFACC2E
CITY_OWNER:GET_CITYNUMBER("旧都歓楽街") = 17
CITY_OWNER:GET_CITYNUMBER("旧地獄街道") = 17
CITY_OWNER:GET_CITYNUMBER("渡る者の途絶えた橋") = 17
CFLAG:(NAME_TO_CHARA("キスメ")):1 = 17
CFLAG:(NAME_TO_CHARA("ヤマメ")):1 = 17
CFLAG:(NAME_TO_CHARA("パルスィ")):1 = 17
CFLAG:(NAME_TO_CHARA("勇儀")):1 = 17

;--------夢美教授--------
COUNTRY_BOSS:18 = GET_ID(NAME_TO_CHARA("夢美"))
COUNTRY_COLOR:18 = 0XB5495B
CITY_OWNER:GET_CITYNUMBER("夢幻遺跡") = 18
CITY_OWNER:GET_CITYNUMBER("岡崎研究室") = 18
;チート教授とその助手と神社から返品されたメイドロボ
CFLAG:(NAME_TO_CHARA("ちゆり")):1 = 18
CFLAG:(NAME_TO_CHARA("夢美")):1 = 18
CFLAG:(NAME_TO_CHARA("る～こと")):1 = 18

;--------ちんき様--------
COUNTRY_BOSS:19 = GET_ID(NAME_TO_CHARA("神綺"))
COUNTRY_COLOR:19 = 0XA6D6DB
CITY_OWNER:GET_CITYNUMBER("最果て") = 19
CITY_OWNER:GET_CITYNUMBER("魔界庁") = 19
CITY_OWNER:GET_CITYNUMBER("魔界大都会") = 19
CITY_OWNER:GET_CITYNUMBER("魔界旅行会社") = 19
;怪綺談－アリス
CFLAG:(NAME_TO_CHARA("サラ")):1 = 19
CFLAG:(NAME_TO_CHARA("ルイズ")):1 = 19
CFLAG:(NAME_TO_CHARA("ユキ")):1 = 19
CFLAG:(NAME_TO_CHARA("マイ")):1 = 19
CFLAG:(NAME_TO_CHARA("夢子")):1 = 19
CFLAG:(NAME_TO_CHARA("神綺")):1 = 19

;--------幻月--------
COUNTRY_BOSS:20 = GET_ID(NAME_TO_CHARA("幻月"))
COUNTRY_COLOR:20 = 0XB8D200
CITY_OWNER:GET_CITYNUMBER("夢幻館") = 20
CITY_OWNER:GET_CITYNUMBER("夢幻門") = 20
CITY_OWNER:GET_CITYNUMBER("夢幻界") = 20
;むげんげつ
CFLAG:(NAME_TO_CHARA("夢月")):1 = 20
CFLAG:(NAME_TO_CHARA("幻月")):1 = 20

;おい・・・
;おい！！！！！！！１！！！１！！１１
;おい嫦娥！！！！１１！１１１フグ田移転の敵！１１
;嫦娥みてるか！！！！！１１！！１１！１
;月の民の弄した愚策を！！１１１欲に溺れ生死を貪る穢れた人間の姿を！！！！！１１
COUNTRY_BOSS:21 = GET_ID(NAME_TO_CHARA("純狐"))
COUNTRY_COLOR:21 = 0XB40404
COUNTRY_AI_TYPE:21 = AI_好戦

CITY_OWNER:GET_CITYNUMBER("静かな海") = 21
CITY_OWNER:GET_CITYNUMBER("表の月面") = 21
;むげんげつ
CFLAG:(NAME_TO_CHARA("純狐")):1 = 21
CFLAG:(NAME_TO_CHARA("ヘカーティア")):1 = 21
CFLAG:(NAME_TO_CHARA("クラウンピース")):1 = 21


;指定されなかったキャラは放浪 ただし霖之助は後から手動で指定するので除外する。あと「あなた」も（MASTER入れ替えたときに放浪するのを防ぐ）。
FOR LOCAL:0, 1, CHARANUM
	SIF CFLAG:(LOCAL:0):1 == 0 && CSTR:(LOCAL:0):99 != "霖之助" && CSTR:(LOCAL:0):99 != "あなた"
		CFLAG:(LOCAL:0):12 = 1
NEXT

;兵力の初期配置
CALL INIT_ARMY

;純狐勢力にゲタ
COUNTRY_SOLDIER:21 = 10000


;無所属都市の兵数は経済の7.5%
FOR LOCAL:0, 0, MAX_CITY
	SIF CITY_OWNER:(LOCAL:0) == 0
		CITY_SOLDIER:(LOCAL:0) = CITY_ECONOMY:(LOCAL:0) * 75 / 1000
NEXT

;■関係設定
CALL SHARED_SETTING_RELATION

;暫定　とりあえず君主だけ設定
CALL INIT_RELATION("霊夢", "魔理沙", 400, 0)
CALL INIT_RELATION("霊夢", "紫", 500, 0)
CALL INIT_RELATION("霊夢", "慧音", 300, 0)
CALL INIT_RELATION("霊夢", "神奈子", 0, 300)
CALL INIT_RELATION("霊夢", "針妙丸", 300, 0)
CALL INIT_RELATION("霊夢", "白蓮", 300, 300)
CALL INIT_RELATION("霊夢", "神子", 300, 300)
CALL INIT_RELATION("霊夢", "依姫", 0, 500)
CALL INIT_RELATION("霊夢", "夢美", 300, 300)

CALL INIT_RELATION("魔理沙", "霊夢", 500, 0)
CALL INIT_RELATION("魔理沙", "慧音", 300, 0)
CALL INIT_RELATION("魔理沙", "チルノ", 300, 0)
CALL INIT_RELATION("魔理沙", "依姫", 0, 300)

CALL INIT_RELATION("レミリア", "霊夢", 400, 0)
CALL INIT_RELATION("レミリア", "紫", 0, 500)
CALL INIT_RELATION("レミリア", "幽々子", 0, 400)
CALL INIT_RELATION("レミリア", "永琳", 0, 700)
CALL INIT_RELATION("レミリア", "天子", 0, 400)
CALL INIT_RELATION("レミリア", "チルノ", 300, 0)
CALL INIT_RELATION("レミリア", "依姫", 0, 800)
;面白そうな存在
CALL INIT_RELATION("レミリア", "夢美", 300, 0)

CALL INIT_RELATION("幽々子", "紫", 500, 0)
CALL INIT_RELATION("幽々子", "永琳", 0, 1000)
CALL INIT_RELATION("幽々子", "四季映姫", 300, 0)
CALL INIT_RELATION("幽々子", "さとり", 0, 500)
CALL INIT_RELATION("幽々子", "依姫", 0, 1000)

CALL INIT_RELATION("紫", "霊夢", 1000, 0)
CALL INIT_RELATION("紫", "幽々子", 500, 0)
CALL INIT_RELATION("紫", "四季映姫", 0, 1000)
CALL INIT_RELATION("紫", "天子", 0, 1500)
CALL INIT_RELATION("紫", "さとり", 0, 500)
CALL INIT_RELATION("紫", "針妙丸", 0, 1000)
CALL INIT_RELATION("紫", "慧音", 500, 0)
CALL INIT_RELATION("紫", "依姫", 0, 1500)
;結界ぶち破れる存在ですしおすし
CALL INIT_RELATION("紫", "夢美", 0, 700)

CALL INIT_RELATION("永琳", "レミリア", 0, 400)
CALL INIT_RELATION("永琳", "幽々子", 0, 1000)
CALL INIT_RELATION("永琳", "紫", 0, 1000)
CALL INIT_RELATION("永琳", "四季映姫", 0, 1000)
CALL INIT_RELATION("永琳", "慧音", 500, 300)
CALL INIT_RELATION("永琳", "依姫", 1500, 0)

CALL INIT_RELATION("四季映姫", "幽々子", 300, 0)
CALL INIT_RELATION("四季映姫", "紫", 0, 1000)
CALL INIT_RELATION("四季映姫", "永琳", 0, 1500)
CALL INIT_RELATION("四季映姫", "天子", 0, 500)
CALL INIT_RELATION("四季映姫", "永琳", 0, 1000)
CALL INIT_RELATION("四季映姫", "さとり", 300, 500)


CALL INIT_RELATION("神奈子", "霊夢", 500, 300)
CALL INIT_RELATION("神奈子", "紫", 0, 400)
CALL INIT_RELATION("神奈子", "慧音", 300, 0)
CALL INIT_RELATION("神奈子", "さとり", 300, 0)

CALL INIT_RELATION("天子", "霊夢", 300, 0)
CALL INIT_RELATION("天子", "紫", 0, 1500)

CALL INIT_RELATION("さとり", "紫", 0, 400)
CALL INIT_RELATION("さとり", "神奈子", 300, 300)
CALL INIT_RELATION("さとり", "四季映姫", 300, 300)
CALL INIT_RELATION("さとり", "勇儀", 300, 0)
CALL INIT_RELATION("さとり", "夢美", 0, 500)

CALL INIT_RELATION("白蓮", "霊夢", 300, 0)
CALL INIT_RELATION("白蓮", "神子", 500, 1500)
CALL INIT_RELATION("白蓮", "慧音", 300, 0)
CALL INIT_RELATION("白蓮", "さとり", 300, 300)
CALL INIT_RELATION("白蓮", "神綺", 300, 0)

CALL INIT_RELATION("神子", "霊夢", 300, 0)
CALL INIT_RELATION("神子", "白蓮", 500, 1500)
CALL INIT_RELATION("神子", "慧音", 300, 0)

;霊夢以外の強そうな連中にけんかを売っていくスタイル
CALL INIT_RELATION("針妙丸", "霊夢", 500, 0)
CALL INIT_RELATION("針妙丸", "魔理沙", 0, 500)
CALL INIT_RELATION("針妙丸", "レミリア", 0, 500)
CALL INIT_RELATION("針妙丸", "幽々子", 0, 500)
CALL INIT_RELATION("針妙丸", "紫", 0, 500)
CALL INIT_RELATION("針妙丸", "永琳", 0, 500)
CALL INIT_RELATION("針妙丸", "四季映姫", 0, 500)
CALL INIT_RELATION("針妙丸", "神奈子", 0, 500)
CALL INIT_RELATION("針妙丸", "天子", 0, 500)
CALL INIT_RELATION("針妙丸", "さとり", 0, 500)
CALL INIT_RELATION("針妙丸", "白蓮", 0, 500)
CALL INIT_RELATION("針妙丸", "神子", 0, 500)
CALL INIT_RELATION("針妙丸", "勇儀", 0, 500)
CALL INIT_RELATION("針妙丸", "依姫", 0, 500)
;チルノのとこはなんとか取り込めないかな……って思ってる
CALL INIT_RELATION("針妙丸", "チルノ", 300, 0)
CALL INIT_RELATION("針妙丸", "夢美", 0, 500)
CALL INIT_RELATION("針妙丸", "神綺", 0, 500)
CALL INIT_RELATION("針妙丸", "幻月", 0, 500)

CALL INIT_RELATION("慧音", "霊夢", 300, 0)
CALL INIT_RELATION("慧音", "魔理沙", 300, 0)
CALL INIT_RELATION("慧音", "紫", 300, 300)
CALL INIT_RELATION("慧音", "永琳", 500, 300)
CALL INIT_RELATION("慧音", "さとり", 0, 300)
CALL INIT_RELATION("慧音", "白蓮", 300, 300)
CALL INIT_RELATION("慧音", "神子", 300, 300)
CALL INIT_RELATION("慧音", "チルノ", 0, 200)
CALL INIT_RELATION("慧音", "針妙丸", 0, 200)
CALL INIT_RELATION("慧音", "依姫", 0, 200)

CALL INIT_RELATION("チルノ", "霊夢", 300, 300)
CALL INIT_RELATION("チルノ", "魔理沙", 300, 300)
CALL INIT_RELATION("チルノ", "レミリア", 300, 300)
CALL INIT_RELATION("チルノ", "紫", 300, 0)
CALL INIT_RELATION("チルノ", "四季映姫", 0, 300)
CALL INIT_RELATION("チルノ", "針妙丸", 0, 500)

CALL INIT_RELATION("勇儀", "霊夢", 300, 0)
CALL INIT_RELATION("勇儀", "魔理沙", 300, 0)
CALL INIT_RELATION("勇儀", "さとり", 300, 500)

CALL INIT_RELATION("依姫", "霊夢", 0, 1500)
CALL INIT_RELATION("依姫", "魔理沙", 0, 1500)
CALL INIT_RELATION("依姫", "レミリア", 0, 1500)
CALL INIT_RELATION("依姫", "紫", 0, 1500)
CALL INIT_RELATION("依姫", "幽々子", 0, 1500)
CALL INIT_RELATION("依姫", "永琳", 1500, 0)
CALL INIT_RELATION("依姫", "四季映姫", 0, 1500)
CALL INIT_RELATION("依姫", "神奈子", 0, 1500)
CALL INIT_RELATION("依姫", "天子", 0, 1500)
CALL INIT_RELATION("依姫", "さとり", 0, 1500)
CALL INIT_RELATION("依姫", "白蓮", 0, 1500)
CALL INIT_RELATION("依姫", "神子", 0, 1500)
CALL INIT_RELATION("依姫", "針妙丸", 0, 1500)
CALL INIT_RELATION("依姫", "チルノ", 0, 1500)
CALL INIT_RELATION("依姫", "慧音", 0, 1500)
CALL INIT_RELATION("依姫", "勇儀", 0, 1500)
CALL INIT_RELATION("依姫", "夢美", 0, 1500)
CALL INIT_RELATION("依姫", "神綺", 0, 1500)
CALL INIT_RELATION("依姫", "幻月", 0, 1500)
CALL INIT_RELATION("依姫", "純狐", 0, 1500)

;教授から見れば幻想郷の住民はみんな素敵だよ
CALL INIT_RELATION("夢美", "霊夢", 300, 0)
CALL INIT_RELATION("夢美", "魔理沙", 300, 0)
CALL INIT_RELATION("夢美", "レミリア", 300, 0)
CALL INIT_RELATION("夢美", "紫", 300, 0)
CALL INIT_RELATION("夢美", "幽々子", 300, 0)
CALL INIT_RELATION("夢美", "永琳", 300, 0)
CALL INIT_RELATION("夢美", "四季映姫", 300, 0)
CALL INIT_RELATION("夢美", "神奈子", 300, 0)
CALL INIT_RELATION("夢美", "天子", 300, 0)
CALL INIT_RELATION("夢美", "さとり", 300, 0)
CALL INIT_RELATION("夢美", "白蓮", 300, 0)
CALL INIT_RELATION("夢美", "神子", 300, 0)
CALL INIT_RELATION("夢美", "針妙丸", 300, 0)
CALL INIT_RELATION("夢美", "チルノ", 300, 0)
CALL INIT_RELATION("夢美", "慧音", 300, 0)
CALL INIT_RELATION("夢美", "勇儀", 300, 0)
CALL INIT_RELATION("夢美", "神綺", 300, 0)
CALL INIT_RELATION("夢美", "幻月", 300, 0)


CALL INIT_RELATION("神綺", "霊夢", 300, 300)
;魔理沙んちにアリスがいるから優しいよ
CALL INIT_RELATION("神綺", "魔理沙", 300, 0)
CALL INIT_RELATION("神綺", "白蓮", 300, 0)

CALL INIT_RELATION("幻月", "神綺", 300, 0)

;おい・・・
;おい！！！！！！！１！！！１！！１１
;おい嫦娥！！！！１１！１１１フグ田移転の敵！１１
;嫦娥みてるか！！！！！１１！！１１！１
;月の民の弄した愚策を！！１１１欲に溺れ生死を貪る穢れた人間の姿を！！！！！１１
CALL INIT_RELATION("純狐", "依姫", 0, 1500)

CALL INIT_ALLIANCE_BY_NAME("依姫", "永琳", 25)
CALL INIT_ALLIANCE_BY_NAME("紫", "幽々子", 10)
CALL INIT_ALLIANCE_BY_NAME("霊夢", "魔理沙", 15)
CALL INIT_ALLIANCE_BY_NAME("霊夢", "針妙丸", 10)
CALL INIT_ALLIANCE_BY_NAME("霊夢", "紫", 10)
CALL INIT_ALLIANCE_BY_NAME("神綺", "白蓮", 10)
CALL INIT_ALLIANCE_BY_NAME("神奈子", "さとり", 10)



;-------------------------------------------------
;定例イベント
;ターンエンド時に呼び出される
;SCVAR:0 封獣ぬえ離反済みフラグ
;-------------------------------------------------
@SCENARIO_EVENT_1

;封獣ぬえ・鬼人正邪離反イベント（それぞれ１回独立します）
;30期以降、封獣ぬえか鬼人正邪がプレイヤーでなく捕虜や放浪状態や死亡状態や外来勢力所属でもなく、かつその所属勢力が5つ以上の都市を得ているとき
;キャラに応じた条件で離反が発生します（上から順に行い離反者が決まれば実行、１期に１人まで）
;REBELLION_FLAGの引数(:省略時の値)は("キャラ名" , 離反開始ターン数:6 , 離反元の最低支配都市数:5 , 離反元の最大離反都市数:99 , 離反確率:100)です
;またREBELLION_FLAG側で「無所属でない」「捕虜でない」「スキマ送りされていない」「プレイヤーではない」「君主ではない」を判定しています
;他の条件については頑張って解読してください（ぉ
LOCAL:1 = 0
;正邪優先、ただし君主が針妙丸の時は起こらない
IF !GETBIT(SCVAR:0,0) && REBELLION_FLAG("正邪", 30) && CFLAG:(NAME_TO_CHARA("正邪")):1 != GET_COUNTRY_FROM_ID(COUNTRY_GAIRAI) && GET_COUNTRY_BOSS(CFLAG:(NAME_TO_CHARA("正邪")):1) != FINDCHARA(CSTR:99, "針妙丸")
	LOCAL:1 = FINDCHARA(CSTR:99, "正邪")
ELSEIF !GETBIT(SCVAR:0,1) && REBELLION_FLAG("ぬえ", 30) && CFLAG:(NAME_TO_CHARA("ぬえ")):1 != GET_COUNTRY_FROM_ID(COUNTRY_GAIRAI)
	LOCAL:1 = FINDCHARA(CSTR:99, "ぬえ")
ENDIF
IF LOCAL:1 != 0
	;離反元君主のキャラ番号
	LOCAL:2 = GET_COUNTRY_BOSS(CFLAG:(LOCAL:1):1)
	;離反元国家の番号
	LOCAL:3 = CFLAG:(LOCAL:1):1
	;新しい勢力を取得
	LOCAL:4 = GET_NEW_COUNTRY()
	;反乱フラグをビット処理。これで同一周回でふたりとも謀反できるよ、やったね
	;本命は当然反乱予定者を増やすためにございます（とは言っても64人が限界ですが。TWのビット処理を引用すると汎用でない全キャラ巻き込めますが）
	;勢力発生後に移動させたのは反乱かやらごとの一部設定をここで設定しやすいように。具体的には勢力カラーとか（イメージに合う色が思いつかないのでそのままにしておく）。
	SELECTCASE LOCAL:1
	CASE FINDCHARA(CSTR:99, "正邪")
		SETBIT SCVAR:0 , 0
		COUNTRY_COLOR:(LOCAL:4) = 0xB40431
	CASE FINDCHARA(CSTR:99, "ぬえ")
		SETBIT SCVAR:0 , 1
		COUNTRY_COLOR:(LOCAL:4) = 0xB40431
	ENDSELECT
	;プレイヤーの態度をLOCAL:10に格納
	;出力 0:離反について出奔,1:元君主のもとに留まる,2:説得を行うも失敗
	LOCAL:10 = 1
	;プレイヤーが離反者の所属国家の君主でなく、かつ離反者の同僚である
	IF LOCAL:2 != MASTER && CFLAG:MASTER:1 == CFLAG:(LOCAL:1):1
		;それなりに仲が良いと、一緒に来ないかと尋ねられる
		;正邪用のセリフは用意してません。共通です。一応正体不明云々はぬえの時だけ表示されるはず
		IF CFLAG:(LOCAL:1):2 >= 300
			DRAWLINE
			PRINTFORMW ある日、%ANAME(LOCAL:1)%に急に呼び出された
			PRINTFORMW 人払いをした彼女の部屋で、%ANAME(LOCAL:1)%に告げられる
			PRINTFORMW 「じつはさぁ……%ANAME(LOCAL:2)%のとこを出ようと思うんだよね」
			PRINTFORMW 「つまり離反ってやつ。で、あんた見たところ使えそうだし、なんならウチに来ない？　って相談なんだけど。どう？」
			PRINTFORMW 「迷うと思うんだけど、できればすぐ返事が欲しいんだよね……アンタが%ANAME(LOCAL:2)%にチクらないとも限らないし」
			PRINTFORMW すぐに返事しろと言われても困る。だが%ANAME(LOCAL:1)%は、ともかく何かしら応えるまで返すつもりはないようだ……
			$INPUT_LOOP_NUE_INVITATION
			PRINTFORML [0] %ANAME(LOCAL:1)%につく
			PRINTFORML [1] %ANAME(LOCAL:2)%側に残る
			PRINTFORML [2] バカなことはやめろという
			INPUT
			IF RESULT == 0
				CFLAG:MASTER:1 = LOCAL:4
				PRINTFORMW 「くくっ、あんたならそう言ってくれると思ってたよ」
				PRINTFORMW %ANAME(LOCAL:1)%は凶悪な笑みをにやりと浮かべてみせた。
				PRINTFORMW 「じゃあ、いっちょやってやろうじゃないか。私とあんたで、この幻想郷を恐怖の底に沈めてやるのさ」
				IF LOCAL:1 == NAME_TO_CHARA("ぬえ")
					PRINTFORMW 「……正体不明の恐怖にね！　くくく！」
				ENDIF
				PRINTFORMW なんだかえらいことに首を突っ込んでしまった気がする。大丈夫だろうか……。
				;ぬえちゃん強キャラだけどぶっちゃけ他に誰連れてこれるか次第だねこれね。
				;チート級あなたが味方ならそりゃまぁ心強いけど、途中何回孕まされるか分かったもんじゃないね？？
				LOCAL:10 = 0
			ELSEIF RESULT == 1
				PRINTFORMW %ANAME(LOCAL:2)%を裏切るわけにはいかない……そう告げると、%ANAME(LOCAL:1)%は露骨に失望した表情を浮かべた
				PRINTFORMW 「……はあ。あっそ、じゃあとっとと出ていきな」
				PRINTFORMW 「後悔しないことだね。私の国は、あんたんとこなんて一瞬で食い尽くすよ」
				PRINTFORMW それっきり%ANAME(LOCAL:1)%はこちらに興味を失ったのか、そっぽを向いてしまった
				PRINTFORMW ここで%ANAME(MASTER)%に危害を加えるつもりはないようだが、次に会うときは敵としてになるだろう……
				PRINTL
				LOCAL:10 = 1
			ELSEIF RESULT == 2
				PRINTFORMW バカなことはやめろ……
				;何らかのあなたに対する陥落素質があれば思いとどまる
				IF (IS_LOVER(LOCAL:1) || IS_SLAVE(LOCAL:1))
					PRINTFORMW %ANAME(MASTER)%が必死に説得すると、%ANAME(LOCAL:1)%はため息をついた
					PRINTFORMW 「……はあ。あんたにそんなこと言われちゃうなんてね」
					PRINTFORMW 「まあ、分かったよ。あんたの言うことは断りたくないから。我慢してあげる」
					PRINTFORMW 「……その代わり、私のこと、色々満足させてよね？」
					PRINTFORMW どうやら%ANAME(LOCAL:1)%は離反をあきらめてくれたようだ……
					RETURN
				;なければd100が現在の好感度の1/10より大きければキレる
				ELSEIF RAND:100 > CFLAG:(LOCAL:1):2 / 10
					PRINTFORMW %ANAME(MASTER)%が必死に説得すると、%ANAME(LOCAL:1)%は逆上した
					PRINTFORMW 「あ？　なんであんたにそんなこと言われなきゃいけないわけ？」
					PRINTFORMW 「もういい。分かった。あんたは要らない。私が作る新しい国に、呑まれて消えちまえばいいんだ」
					PRINTFORMW 「出て行け！　今すぐ私の前から消えなっ！」
					PRINTFORMW そう言って怒りを収めることなく%ANAME(LOCAL:1)%はあなたを部屋から追い出した
					PRINTFORMW 次に%ANAME(LOCAL:1)%と出会うのは戦場か、それとも……
					PRINTL
					LOCAL:10 = 2
				;そうでなければ普通に別れる、なお台詞はコピペのままで終わらせたくなかったのでちょこちょこ変えてみた
				ELSE
					PRINTFORMW %ANAME(MASTER)%が必死に説得すると、%ANAME(LOCAL:1)%は嫌悪の表情を浮かべた
					PRINTFORMW 「……はあ。こっちに付く気がないなら出てってくれないかい？」
					PRINTFORMW 「あんたが%ANAME(LOCAL:2)%にご執心なのは分かったから、今のうちにあいつと乳繰り合っておきな」
					PRINTFORMW 違う、そう反論しようとするよりも早く%ANAME(LOCAL:1)%は言葉を続けた
					PRINTFORMW 「すぐに私の国が、色呆けしてるあんたもろともこの国を呑み込んでやるからな」
					PRINTFORMW 怒りの表情を隠さない%ANAME(LOCAL:1)%の姿を背に、あなたは部屋から出て行った
					PRINTFORMW %ANAME(MASTER)%と刃を交えるとき、お互いどのような顔をしているのだろうか……
					PRINTL
					LOCAL:10 = 1
				ENDIF
			ENDIF
		ENDIF
	ENDIF
	DRAWLINE

	SETCOLOR COLOR("注意")
	PRINTFORMW ！%NAME_FORMAL(LOCAL:1)%が挙兵し、%NAME_FORMAL(LOCAL:2)%の勢力から独立しました！
	RESETCOLOR
	WAIT
	
	COUNTRY_BOSS:(LOCAL:4) = GET_ID(LOCAL:1)
	CFLAG:(LOCAL:1):1 = LOCAL:4

	;離反元勢力の都市の守将を解除
	FOR LOCAL:0, 0, MAX_CITY
		IF CITY_OWNER:(LOCAL:0) == LOCAL:3
			CITY_COMMANDER:(LOCAL:0) = 0
		ENDIF
	NEXT

	;DEBUGPRINTFORML DISARM:{LOCAL:3}

	;都市を二つかすめ取る
	;ただし、激おこであれば1/3（最低2都市）持っていく
	IF LOCAL:10 == 2
		CALL STEAL_CITIES(LOCAL:3, LOCAL:4, MAX(GET_OWN_CITY(LOCAL:3) / 3 , 2))
	ELSE
		CALL STEAL_CITIES(LOCAL:3, LOCAL:4, 2)
	ENDIF

	;マミゾウは（ぬえの離反の時、離反元にいて、捕虜でなく、君主でもなければ）必ず奪う
	IF CFLAG:(NAME_TO_CHARA("マミゾウ")):1 == LOCAL:3 && CFLAG:(NAME_TO_CHARA("マミゾウ")):9 == 0 && LOCAL:2 != NAME_TO_CHARA("マミゾウ") && LOCAL:1 == NAME_TO_CHARA("ぬえ")
		CFLAG:(NAME_TO_CHARA("マミゾウ")):1 = LOCAL:4
	ENDIF


	;離反元所属武将の一部をかすめ取る処理。
	;LOCAL 1:離反者 , 2:離反元勢力君主 , 3:離反元勢力 , 5:離反元の未陥落者数 , 6:離反元の陥落済人数（プレイヤーが離反元勢力にいなければ5に併合）
	;      7:離反元から引きぬく人数 , 10:離反勧誘の返答
	;
	LOCAL:5 = 0
	LOCAL:6 = 0
	;所属武将の数を調べる
	FOR LOCAL:0, 0, CHARANUM
		;離反元所属で、捕虜でなく、プレイヤーでも離反者でも君主でないキャラ
		IF CFLAG:(LOCAL:0):1 == LOCAL:3 && CFLAG:(LOCAL:0):9 == 0 && !GROUPMATCH(LOCAL:0 , MASTER , LOCAL:1 , LOCAL:2)
		;DEBUGPRINTFORML CHARAMATCH:{LOCAL:0}
			;恋慕系か隷属系でないなら組み込み、恋慕なら拉致、プレイヤーのいない勢力では組み込み
			;(陥落済かつ「離反に同調」か「離反せず離反元に残る」)
			IF (IS_LOVER(LOCAL:0) || IS_SLAVE(LOCAL:0)) && (!LOCAL:10 || (LOCAL:10 && CFLAG:MASTER:1 == LOCAL:3))
				LOCAL:6 ++
			ELSE
				LOCAL:5 ++
			ENDIF
		ENDIF
	NEXT
	;DEBUGPRINTFORML PICK :{LOCAL:5}
	;DEBUGPRINTFORML STEAL:{LOCAL:6}


	;引き抜き・拉致対象武将が0より大きいなら、ループ回しながらランダムにもっていく
	;拉致は多くて1/3まで。ただしいずれも候補が一人以上いるなら最低一人は持っていく可能性がある
	IF LOCAL:5 > 0 || LOCAL:6 > 0
		LOCAL:5 = LOCAL:5 ? MAX(LOCAL:5 / 3 , 1) # 0
		;あなたが裏切るなら恋慕・隷属は全員付いてくる
		IF LOCAL:10 == 1
			LOCAL:6 = LOCAL:6 ? MAX(RAND:(LOCAL:6 + 1) / 3 , 1) # 0
		;怒らせると陥落済の人を余分に拉致して行きます。これは後でおしおきですね
		ELSEIF LOCAL:10 == 2
			LOCAL:6 = LOCAL:6 ? MAX(RAND:(LOCAL:6 + 1) * 2 / 3 , 1) # 0
		ENDIF
		;LOCAL:7に引抜き及び拉致する人数を合計しておき、合計人数が75％以上（残選択数が25％以下）であればそこで諦める
		LOCAL:7 = LOCAL:5 + LOCAL:6
		;最大周回を5回に設定
		LOCAL:11 = 5
		WHILE (100 - ((LOCAL:5 + LOCAL:6) * 100 / LOCAL:7) < 75 && LOCAL:11 > 0)
			;判定するキャラ順をシャッフル、再挑戦するたびに順番は変わります
			CALL FISHER_YATES_SHAFFLE(CHARANUM)
			FOR LOCAL:99, 0, CHARANUM
				LOCAL:0 = SHAFFLE_ARRAY:(LOCAL:99)
				;離反元所属で、捕虜でなく、プレイヤーでも離反者でも君主でないキャラ
				IF CFLAG:(LOCAL:0):1 == LOCAL:3 && CFLAG:(LOCAL:0):9 == 0 && !GROUPMATCH(LOCAL:0 , MASTER , LOCAL:1 , LOCAL:2)
					;陥落済かつ「離反に同調」か「離反せず離反元に残る」ではないなら1/2で引き抜かれる
					IF !((IS_LOVER(LOCAL:0) || IS_SLAVE(LOCAL:0)) && (!LOCAL:10 || (LOCAL:10 && CFLAG:MASTER:1 == LOCAL:3))) && RAND:2 == 0  && LOCAL:5 > 0
						CFLAG:(LOCAL:0):1 = LOCAL:4
						LOCAL:5 --
					;離反せず離反元に残るなら陥落済みキャラは1/2で拉致される
					ELSEIF RAND:2 == 0 && (IS_LOVER(LOCAL:0) || IS_SLAVE(LOCAL:0)) && LOCAL:6 > 0 && INRANGE(LOCAL:10 , 1 , 2)
						CFLAG:(LOCAL:0):9 = LOCAL:4
						LOCAL:6 --
					;離反に同調すれば陥落済キャラは同行
					ELSEIF (IS_LOVER(LOCAL:0) || IS_SLAVE(LOCAL:0)) && LOCAL:6 > 0 && LOCAL:10 == 0
						CFLAG:(LOCAL:0):1 = LOCAL:4
						LOCAL:6 --
					ENDIF
				ENDIF
			NEXT
			LOCAL:11 --
		WEND
	ENDIF
	;離反元勢力の部隊を解散
	CALL CLEAR_ALL_UNIT(LOCAL:3, 1)

	;仲はまぁ、悪くもなりますわな
	CALL CHANGE_RELATION_C_TO_C(LOCAL:3, LOCAL:4, -200, 600)
	CALL CHANGE_RELATION_C_TO_C(LOCAL:4, LOCAL:3, -200, 600)
	
	;反乱勢力の都市を表示
	FOR LOCAL:0, 0, MAX_CITY
		IF CITY_OWNER:(LOCAL:0) == LOCAL:4
			PRINTFORML %GET_CITYNAME(LOCAL:0)%が%ANAME(LOCAL:1)%の支配下におかれました
		ENDIF
	NEXT
	;反乱勢力に流れた人材
	FOR LOCAL:0, 0, CHARANUM
		IF CFLAG:(LOCAL:0):1 == LOCAL:4 && LOCAL:0 != LOCAL:1
			PRINTFORML %ANAME(LOCAL:0)%が%ANAME(LOCAL:1)%の下につきました
		ELSEIF CFLAG:(LOCAL:0):9 == LOCAL:4
			SETCOLOR COLOR("注意")
			;性処理用云々は消しました
			PRINTFORML %ANAME(LOCAL:0)%が%ANAME(LOCAL:1)%に拉致されました
			RESETCOLOR
		ENDIF
	NEXT


ENDIF

