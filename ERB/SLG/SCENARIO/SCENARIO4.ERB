;-------------------------------------------------
;シナリオ4
;作品対抗幻想郷大戦（暫定）
;-------------------------------------------------
@SCENARIO_NAME_4
RESULTS = 幻想郷内戦
RETURN

@SCENARIO_INTRO_4
PRINTFORML
PRINTFORMW 幻想郷は分裂した！
PRINTFORMW 各勢力が様々な思惑を絡め、争いあう！
PRINTFORMW こんどのスローガンは「忠誠心？　なにそれおいしいの？」
PRINTFORMW 幻想郷は野心家がいっぱい！　隙あらば自分が覇権を握ろうとしているぞ！
PRINTFORMW 君はこの戦いを生き残り、幻想郷の覇者となれるのか！
PRINTL

;ランダムキャラは選択に委ねる
FLAG:OPランダムキャラ使用 = 0


@SCENARIO_PLACEMENT_4

;勢力設定
COUNTRY_BOSS:0 = 0
COUNTRY_COLOR:0 = GETDEFCOLOR()



;;--------霊夢;--------
COUNTRY_BOSS:1 = GET_ID(NAME_TO_CHARA("霊夢"))
COUNTRY_COLOR:1 = 0x757575
COUNTRY_AI_TYPE:1 = AI_外交

CITY_OWNER:GET_CITYNUMBER("博麗神社") = 1
CITY_OWNER:GET_CITYNUMBER("博麗大結界") = 1
CITY_OWNER:GET_CITYNUMBER("ミズナラの木") = 1
CITY_OWNER:GET_CITYNUMBER("裏手の池") = 1
;三妖精に萃香 あと華扇
;おーい誰か魅魔様の行方を(ry
CFLAG:(NAME_TO_CHARA("霊夢")):1 = 1
CFLAG:(NAME_TO_CHARA("サニーミルク")):1 = 1
CFLAG:(NAME_TO_CHARA("ルナチャイルド")):1 = 1
CFLAG:(NAME_TO_CHARA("スターサファイア")):1 = 1
CFLAG:(NAME_TO_CHARA("萃香")):1 = 1
CFLAG:(NAME_TO_CHARA("華扇")):1 = 1
CFLAG:(NAME_TO_CHARA("菫子")):1 = 1

;--------レミリア--------
COUNTRY_BOSS:2 = GET_ID(NAME_TO_CHARA("レミリア"))
COUNTRY_COLOR:2 = 0xFF0000
COUNTRY_AI_TYPE:2 = AI_好戦

CITY_OWNER:GET_CITYNUMBER("紅魔館") = 2
CITY_OWNER:GET_CITYNUMBER("地下図書館") = 2
;紅魔館組
CFLAG:(NAME_TO_CHARA("レミリア")):1 = 2
CFLAG:(NAME_TO_CHARA("美鈴")):1 = 2
CFLAG:(NAME_TO_CHARA("咲夜")):1 = 2
CFLAG:(NAME_TO_CHARA("小悪魔")):1 = 2
CFLAG:(NAME_TO_CHARA("パチュリー")):1 = 2
CFLAG:(NAME_TO_CHARA("フランドール")):1 = 2

;--------魔理沙--------
COUNTRY_BOSS:3 = GET_ID(NAME_TO_CHARA("魔理沙"))
COUNTRY_COLOR:3 = 0xE1D200
CITY_OWNER:GET_CITYNUMBER("マーガトロイド館") = 3
CITY_OWNER:GET_CITYNUMBER("霧雨魔法店") = 3
;アリスと人形たち　あと朱鷺子
CFLAG:(NAME_TO_CHARA("魔理沙")):1 = 3
CFLAG:(NAME_TO_CHARA("アリス")):1 = 3
CFLAG:(NAME_TO_CHARA("上海人形")):1 = 3
CFLAG:(NAME_TO_CHARA("蓬莱人形")):1 = 3
CFLAG:(NAME_TO_CHARA("大江戸人形")):1 = 3
CFLAG:(NAME_TO_CHARA("ゴリアテ人形")):1 = 3
CFLAG:(NAME_TO_CHARA("朱鷺子")):1 = 3
CFLAG:(NAME_TO_CHARA("霖之助")):1 = 3
;--------幽々子--------
COUNTRY_BOSS:4 = GET_ID(NAME_TO_CHARA("幽々子"))
COUNTRY_COLOR:4 = 0xF5A9F2
COUNTRY_AI_TYPE:4 = AI_内政

CITY_OWNER:GET_CITYNUMBER("白玉楼") = 4
CITY_OWNER:GET_CITYNUMBER("七千階段") = 4
CITY_OWNER:GET_CITYNUMBER("西行妖") = 4
;アリスと橙以外の妖々夢組
CFLAG:(NAME_TO_CHARA("幽々子")):1 = 4
CFLAG:(NAME_TO_CHARA("妖夢")):1 = 4
CFLAG:(NAME_TO_CHARA("半霊")):1 = 4


;--------紫--------
COUNTRY_BOSS:5 = GET_ID(NAME_TO_CHARA("紫"))
COUNTRY_COLOR:5 = 0x792B90
COUNTRY_AI_TYPE:5 = AI_内政

CITY_OWNER:GET_CITYNUMBER("八雲屋敷") = 5
CITY_OWNER:GET_CITYNUMBER("マヨヒガ") = 5
;八雲家
CFLAG:(NAME_TO_CHARA("紫")):1 = 5
CFLAG:(NAME_TO_CHARA("藍")):1 = 5
CFLAG:(NAME_TO_CHARA("橙")):1 = 5
CFLAG:(NAME_TO_CHARA("妖忌")):1 = 5

;--------永琳--------
COUNTRY_BOSS:6 = GET_ID(NAME_TO_CHARA("永琳"))
COUNTRY_COLOR:6 = 0x4466FF
COUNTRY_AI_TYPE:6 = AI_防衛

CITY_OWNER:GET_CITYNUMBER("永遠亭") = 6
CITY_OWNER:GET_CITYNUMBER("素兎の集落") = 6
CITY_OWNER:GET_CITYNUMBER("迷いの竹林東部") = 6
CITY_OWNER:GET_CITYNUMBER("迷いの竹林西部") = 6

;永遠亭組
CFLAG:(NAME_TO_CHARA("永琳")):1 = 6
CFLAG:(NAME_TO_CHARA("てゐ")):1 = 6
CFLAG:(NAME_TO_CHARA("鈴仙")):1 = 6
CFLAG:(NAME_TO_CHARA("輝夜")):1 = 6


;--------映姫--------
COUNTRY_BOSS:7 = GET_ID(NAME_TO_CHARA("四季映姫"))
COUNTRY_COLOR:7 = 0x088A08
CITY_OWNER:GET_CITYNUMBER("彼岸") = 7
CITY_OWNER:GET_CITYNUMBER("是非曲直庁") = 7
CITY_OWNER:GET_CITYNUMBER("渡し舟処") = 7
;ヅカ組
CFLAG:(NAME_TO_CHARA("四季映姫")):1 = 7
CFLAG:(NAME_TO_CHARA("小町")):1 = 7



;--------神奈子--------
COUNTRY_BOSS:8 = GET_ID(NAME_TO_CHARA("神奈子"))
COUNTRY_COLOR:8 = 0x79FF4B
COUNTRY_AI_TYPE:8 = AI_好戦

CITY_OWNER:GET_CITYNUMBER("守矢神社") = 8
CITY_OWNER:GET_CITYNUMBER("風神の湖") = 8
CITY_OWNER:GET_CITYNUMBER("間欠泉地下センター") = 8
;風神録組とはたて

CFLAG:(NAME_TO_CHARA("早苗")):1 = 8
CFLAG:(NAME_TO_CHARA("諏訪子")):1 = 8
CFLAG:(NAME_TO_CHARA("神奈子")):1 = 8

;--------天子--------
COUNTRY_BOSS:9 = GET_ID(NAME_TO_CHARA("天子"))
COUNTRY_COLOR:9 = 0x002FFF
COUNTRY_AI_TYPE:9 = AI_好戦

CITY_OWNER:GET_CITYNUMBER("桃園") = 9
CITY_OWNER:GET_CITYNUMBER("天人の都") = 9
CITY_OWNER:GET_CITYNUMBER("有頂天") = 9
CITY_OWNER:GET_CITYNUMBER("竜宮の遣い専用宿舎") = 9
CITY_OWNER:GET_CITYNUMBER("比那名居家総領娘屋敷") = 9
;天子衣玖
CFLAG:(NAME_TO_CHARA("天子")):1 = 9
CFLAG:(NAME_TO_CHARA("衣玖")):1 = 9


;--------さとり--------
COUNTRY_BOSS:10 = GET_ID(NAME_TO_CHARA("さとり"))
COUNTRY_COLOR:10 = 0xFA5882
COUNTRY_AI_TYPE:10 = AI_防衛

CITY_OWNER:GET_CITYNUMBER("地霊殿") = 10
CITY_OWNER:GET_CITYNUMBER("灼熱地獄跡") = 10
CITY_OWNER:GET_CITYNUMBER("旧都温泉街") = 10
;地霊殿組
CFLAG:(NAME_TO_CHARA("さとり")):1 = 10
CFLAG:(NAME_TO_CHARA("燐")):1 = 10
CFLAG:(NAME_TO_CHARA("空")):1 = 10
CFLAG:(NAME_TO_CHARA("こいし")):1 = 10


;--------白蓮--------
COUNTRY_BOSS:11 = GET_ID(NAME_TO_CHARA("白蓮"))
COUNTRY_COLOR:11 = 0xDF01D7
COUNTRY_AI_TYPE:11 = AI_外交

CITY_OWNER:GET_CITYNUMBER("命蓮寺") = 11
CITY_OWNER:GET_CITYNUMBER("墓地") = 11
;響子と小傘含む寺
CFLAG:(NAME_TO_CHARA("響子")):1 = 11
CFLAG:(NAME_TO_CHARA("ナズーリン")):1 = 11
CFLAG:(NAME_TO_CHARA("一輪")):1 = 11
CFLAG:(NAME_TO_CHARA("雲山")):1 = 11
CFLAG:(NAME_TO_CHARA("水蜜")):1 = 11
CFLAG:(NAME_TO_CHARA("星")):1 = 11
CFLAG:(NAME_TO_CHARA("白蓮")):1 = 11

;--------神子--------
COUNTRY_BOSS:12 = GET_ID(NAME_TO_CHARA("神子"))
COUNTRY_COLOR:12 = 0xFF8000
COUNTRY_AI_TYPE:12 = AI_外交

CITY_OWNER:GET_CITYNUMBER("夢殿大祀廟") = 12
CITY_OWNER:GET_CITYNUMBER("神霊廟") = 12
;廟＋こころ
CFLAG:(NAME_TO_CHARA("神子")):1 = 12
CFLAG:(NAME_TO_CHARA("芳香")):1 = 12
CFLAG:(NAME_TO_CHARA("青娥")):1 = 12
CFLAG:(NAME_TO_CHARA("布都")):1 = 12
CFLAG:(NAME_TO_CHARA("屠自古")):1 = 12
CFLAG:(NAME_TO_CHARA("こころ")):1 = 12


;--------針妙丸--------
COUNTRY_BOSS:13 = GET_ID(NAME_TO_CHARA("針妙丸"))
COUNTRY_COLOR:13 = 0x00BFFF
CITY_OWNER:GET_CITYNUMBER("輝針城") = 13
COUNTRY_AI_TYPE:13 = AI_防衛
;輝針城組
CFLAG:(NAME_TO_CHARA("弁々")):1 = 13
CFLAG:(NAME_TO_CHARA("八橋")):1 = 13
CFLAG:(NAME_TO_CHARA("正邪")):1 = 13
CFLAG:(NAME_TO_CHARA("針妙丸")):1 = 13
CFLAG:(NAME_TO_CHARA("雷鼓")):1 = 13


;--------慧音（人里）--------
COUNTRY_BOSS:14 = GET_ID(NAME_TO_CHARA("慧音"))
COUNTRY_COLOR:14 = 0x974E00
COUNTRY_AI_TYPE:14 = AI_防衛

CITY_OWNER:GET_CITYNUMBER("妹紅宅") = 14
CITY_OWNER:GET_CITYNUMBER("寺子屋") = 14
;慧音と妹紅
CFLAG:(NAME_TO_CHARA("慧音")):1 = 14
CFLAG:(NAME_TO_CHARA("妹紅")):1 = 14

;--------依姫--------
COUNTRY_BOSS:15 = GET_ID(NAME_TO_CHARA("依姫"))
COUNTRY_COLOR:15 = 0xFFF999
COUNTRY_AI_TYPE:15 = AI_好戦

CITY_OWNER:GET_CITYNUMBER("月の都") = 15
CITY_OWNER:GET_CITYNUMBER("桃源郷") = 15
CITY_OWNER:GET_CITYNUMBER("綿月亭") = 15
CITY_OWNER:GET_CITYNUMBER("薬搗場") = 15

;月組
CFLAG:(NAME_TO_CHARA("依姫")):1 = 15
CFLAG:(NAME_TO_CHARA("豊姫")):1 = 15
CFLAG:(NAME_TO_CHARA("レイセン")):1 = 15


;--------チルノら--------
COUNTRY_BOSS:16 = GET_ID(NAME_TO_CHARA("チルノ"))
COUNTRY_COLOR:16 = 0x00FFF7
CITY_OWNER:GET_CITYNUMBER("霧の湖の畔") = 16
;たぶんここが一番キツいと思います まともなのいねぇ
CFLAG:(NAME_TO_CHARA("大妖精")):1 = 16
CFLAG:(NAME_TO_CHARA("チルノ")):1 = 16
CFLAG:(NAME_TO_CHARA("レティ")):1 = 16
CFLAG:(NAME_TO_CHARA("リリーホワイト")):1 = 16
CFLAG:(NAME_TO_CHARA("リリーブラック")):1 = 16

;--------スターベア--------
COUNTRY_BOSS:17 = GET_ID(NAME_TO_CHARA("勇儀"))
COUNTRY_COLOR:17 = 0XFACC2E
CITY_OWNER:GET_CITYNUMBER("旧都歓楽街") = 17
CITY_OWNER:GET_CITYNUMBER("旧地獄街道") = 17
CITY_OWNER:GET_CITYNUMBER("渡る者の途絶えた橋") = 17
CFLAG:(NAME_TO_CHARA("キスメ")):1 = 17
CFLAG:(NAME_TO_CHARA("ヤマメ")):1 = 17
CFLAG:(NAME_TO_CHARA("パルスィ")):1 = 17
CFLAG:(NAME_TO_CHARA("勇儀")):1 = 17

;--------夢美教授--------
COUNTRY_BOSS:18 = GET_ID(NAME_TO_CHARA("夢美"))
COUNTRY_COLOR:18 = 0XB5495B
COUNTRY_AI_TYPE:23 = AI_防衛
CITY_OWNER:GET_CITYNUMBER("夢幻遺跡") = 18
CITY_OWNER:GET_CITYNUMBER("岡崎研究室") = 18
;チート教授とその助手と神社から返品されたメイドロボ
CFLAG:(NAME_TO_CHARA("ちゆり")):1 = 18
CFLAG:(NAME_TO_CHARA("夢美")):1 = 18
CFLAG:(NAME_TO_CHARA("る～こと")):1 = 18


;--------ちんき様--------
COUNTRY_BOSS:19 = GET_ID(NAME_TO_CHARA("蓮子"))
COUNTRY_COLOR:19 = 0XA6D6DB
COUNTRY_AI_TYPE:19 = AI_防衛
CITY_OWNER:GET_CITYNUMBER("最果て") = 19
CITY_OWNER:GET_CITYNUMBER("魔界庁") = 19
CITY_OWNER:GET_CITYNUMBER("魔界大都会") = 19
CITY_OWNER:GET_CITYNUMBER("魔界旅行会社") = 19
;怪綺談－アリス
CFLAG:(NAME_TO_CHARA("菫子")):1 = 19
CFLAG:(NAME_TO_CHARA("マエリベリー")):1 = 19
CFLAG:(NAME_TO_CHARA("蓮子")):1 = 19

;おい・・・
;おい！！！！！！！１！！！１！！１１
;おい嫦娥！！！！１１！１１１フグ田移転の敵！１１
;嫦娥みてるか！！！！！１１！！１１！１
;月の民の弄した愚策を！！１１１欲に溺れ生死を貪る穢れた人間の姿を！！！！！１１
COUNTRY_BOSS:21 = GET_ID(NAME_TO_CHARA("純狐"))
COUNTRY_COLOR:21 = 0XB40404
COUNTRY_AI_TYPE:21 = AI_好戦

CITY_OWNER:GET_CITYNUMBER("静かな海") = 21
CITY_OWNER:GET_CITYNUMBER("表の月面") = 21
;むげんげつ
CFLAG:(NAME_TO_CHARA("純狐")):1 = 21
CFLAG:(NAME_TO_CHARA("ヘカーティア")):1 = 21
CFLAG:(NAME_TO_CHARA("クラウンピース")):1 = 21

;--------鷹兎--------
COUNTRY_BOSS:22 = GET_ID(NAME_TO_CHARA("サグメ"))
COUNTRY_COLOR:22 = 0x00FF99
COUNTRY_AI_TYPE:22 = AI_防衛

CITY_OWNER:GET_CITYNUMBER("月の都") = 22
CITY_OWNER:GET_CITYNUMBER("月兎街") = 22
CITY_OWNER:GET_CITYNUMBER("豊かな海") = 22
CITY_OWNER:GET_CITYNUMBER("夢世界") = 22

;月勢も一枚岩ではないからな

CFLAG:(NAME_TO_CHARA("鈴瑚")):1 = 22
CFLAG:(NAME_TO_CHARA("清蘭")):1 = 22
CFLAG:(NAME_TO_CHARA("サグメ")):1 = 22
CFLAG:(NAME_TO_CHARA("ドレミー")):1 = 22

;--------小鈴（人里）--------
COUNTRY_BOSS:23 = GET_ID(NAME_TO_CHARA("マミゾウ"))
COUNTRY_COLOR:23 = 0x990010
COUNTRY_AI_TYPE:23 = AI_外交

CITY_OWNER:GET_CITYNUMBER("阿求屋敷") = 23
CITY_OWNER:GET_CITYNUMBER("鈴奈庵") = 23
;あきゅこす

CFLAG:(NAME_TO_CHARA("マミゾウ")):1 = 23
CFLAG:(NAME_TO_CHARA("阿求")):1 = 23
CFLAG:(NAME_TO_CHARA("小鈴")):1 = 23



;--------草の根--------
COUNTRY_BOSS:24 = GET_ID(NAME_TO_CHARA("赤蛮奇"))
COUNTRY_COLOR:24 = 0x99CC20

CITY_OWNER:GET_CITYNUMBER("八目鰻の屋台") = 24
CITY_OWNER:GET_CITYNUMBER("迷いの竹林南部") = 24

;たぶんここが一番キツいと思います まともなのいねぇ
CFLAG:(NAME_TO_CHARA("ルーミア")):1 = 24
CFLAG:(NAME_TO_CHARA("リグル")):1 = 24
CFLAG:(NAME_TO_CHARA("ミスティア")):1 = 24
CFLAG:(NAME_TO_CHARA("小傘")):1 = 24
CFLAG:(NAME_TO_CHARA("わかさぎ姫")):1 = 24
CFLAG:(NAME_TO_CHARA("赤蛮奇")):1 = 24
CFLAG:(NAME_TO_CHARA("影狼")):1 = 24

;--------妖怪の山--------
COUNTRY_BOSS:25 = GET_ID(NAME_TO_CHARA("文"))
COUNTRY_COLOR:25 = 0XFF7050
COUNTRY_AI_TYPE:25 = AI_外交

CITY_OWNER:GET_CITYNUMBER("未踏の渓谷") = 25
CITY_OWNER:GET_CITYNUMBER("九天の滝") = 25
CITY_OWNER:GET_CITYNUMBER("妖怪の山麓") = 25
;風神録組とはたて
CFLAG:(NAME_TO_CHARA("静葉")):1 = 25
CFLAG:(NAME_TO_CHARA("穣子")):1 = 25
CFLAG:(NAME_TO_CHARA("雛")):1 = 25
CFLAG:(NAME_TO_CHARA("にとり")):1 = 25
CFLAG:(NAME_TO_CHARA("椛")):1 = 25
CFLAG:(NAME_TO_CHARA("はたて")):1 = 25
CFLAG:(NAME_TO_CHARA("文")):1 = 25



;--------草の根--------
COUNTRY_BOSS:26 = GET_ID(NAME_TO_CHARA("ルナサ"))
COUNTRY_COLOR:26 = 0xFF9922
COUNTRY_AI_TYPE:26 = AI_防衛

CITY_OWNER:GET_CITYNUMBER("廃洋館") = 26

;たぶんここが一番キツいと思います まともなのいねぇ
CFLAG:(NAME_TO_CHARA("リリカ")):1 = 26
CFLAG:(NAME_TO_CHARA("メルラン")):1 = 26
CFLAG:(NAME_TO_CHARA("ルナサ")):1 = 26


;--------草の根--------
COUNTRY_BOSS:27 = GET_ID(NAME_TO_CHARA("幽香"))
COUNTRY_COLOR:27 = 0x998811
COUNTRY_AI_TYPE:27 = AI_防衛

CITY_OWNER:GET_CITYNUMBER("太陽の畑") = 27


CFLAG:(NAME_TO_CHARA("メディスン")):1 = 27
CFLAG:(NAME_TO_CHARA("幽香")):1 = 27



;指定されなかったキャラは放浪 ただし霖之助は後から手動で指定するので除外する。あと「あなた」も（MASTER入れ替えたときに放浪するのを防ぐ）。
FOR LOCAL:0, 1, CHARANUM
	SIF CFLAG:(LOCAL:0):1 == 0 && CSTR:(LOCAL:0):99 != "霖之助" && CSTR:(LOCAL:0):99 != "あなた" && CSTR:(LOCAL:0):99 != "夢月" && CSTR:(LOCAL:0):99 != "幻月" && CSTR:(LOCAL:0):99 != "サラ" && CSTR:(LOCAL:0):99 != "ルイズ" && CSTR:(LOCAL:0):99 != "ユキ" && CSTR:(LOCAL:0):99 != "マイ" && CSTR:(LOCAL:0):99 != "夢子" && CSTR:(LOCAL:0):99 != "神綺"
		CFLAG:(LOCAL:0):特殊状態 = 1
NEXT

;兵力の初期配置
CALL INIT_ARMY

;純狐勢力にゲタ
COUNTRY_SOLDIER:21 = 10000
COUNTRY_SOLDIER:22 = 5000

;無所属都市の兵数は経済の7.5%
FOR LOCAL:0, 0, MAX_CITY
	SIF CITY_OWNER:(LOCAL:0) == 0
		CITY_SOLDIER:(LOCAL:0) = CITY_ECONOMY:(LOCAL:0) * 75 / 1000
NEXT

;■関係設定
CALL SHARED_SETTING_RELATION

;暫定　とりあえず君主だけ設定
CALL INIT_RELATION("霊夢", "魔理沙", 400, 0)
CALL INIT_RELATION("霊夢", "紫", 500, 0)
CALL INIT_RELATION("霊夢", "慧音", 300, 0)
CALL INIT_RELATION("霊夢", "神奈子", 0, 300)
CALL INIT_RELATION("霊夢", "針妙丸", 300, 0)
CALL INIT_RELATION("霊夢", "白蓮", 300, 300)
CALL INIT_RELATION("霊夢", "神子", 300, 300)
CALL INIT_RELATION("霊夢", "依姫", 0, 300)
CALL INIT_RELATION("霊夢", "夢美", 300, 300)

CALL INIT_RELATION("魔理沙", "霊夢", 500, 0)
CALL INIT_RELATION("魔理沙", "慧音", 300, 0)
CALL INIT_RELATION("魔理沙", "チルノ", 300, 0)
CALL INIT_RELATION("魔理沙", "依姫", 0, 300)

CALL INIT_RELATION("レミリア", "霊夢", 400, 0)
CALL INIT_RELATION("レミリア", "紫", 0, 500)
CALL INIT_RELATION("レミリア", "幽々子", 0, 400)
CALL INIT_RELATION("レミリア", "永琳", 0, 700)
CALL INIT_RELATION("レミリア", "天子", 0, 400)
CALL INIT_RELATION("レミリア", "チルノ", 300, 0)
CALL INIT_RELATION("レミリア", "依姫", 0, 800)
;面白そうな存在
CALL INIT_RELATION("レミリア", "マミゾウ", 300, 0)

CALL INIT_RELATION("幽々子", "紫", 500, 0)
CALL INIT_RELATION("幽々子", "永琳", 0, 1000)
CALL INIT_RELATION("幽々子", "四季映姫", 300, 0)
CALL INIT_RELATION("幽々子", "さとり", 0, 500)
CALL INIT_RELATION("幽々子", "依姫", 0, 1000)

CALL INIT_RELATION("紫", "霊夢", 1000, 0)
CALL INIT_RELATION("紫", "幽々子", 500, 0)
CALL INIT_RELATION("紫", "四季映姫", 0, 1000)
CALL INIT_RELATION("紫", "天子", 0, 1500)
CALL INIT_RELATION("紫", "さとり", 0, 500)
CALL INIT_RELATION("紫", "針妙丸", 0, 1000)
CALL INIT_RELATION("紫", "慧音", 500, 0)
CALL INIT_RELATION("紫", "依姫", 0, 1500)
;結界ぶち破れる存在ですしおすし
CALL INIT_RELATION("紫", "サグメ", 700, 0)

CALL INIT_RELATION("永琳", "レミリア", 0, 400)
CALL INIT_RELATION("永琳", "幽々子", 0, 1000)
CALL INIT_RELATION("永琳", "紫", 0, 1000)
CALL INIT_RELATION("永琳", "四季映姫", 0, 1000)
CALL INIT_RELATION("永琳", "慧音", 500, 300)
CALL INIT_RELATION("永琳", "依姫", 1500, 0)

CALL INIT_RELATION("四季映姫", "幽々子", 300, 0)
CALL INIT_RELATION("四季映姫", "紫", 0, 1000)
CALL INIT_RELATION("四季映姫", "永琳", 0, 1500)
CALL INIT_RELATION("四季映姫", "天子", 0, 500)
CALL INIT_RELATION("四季映姫", "永琳", 0, 1000)
CALL INIT_RELATION("四季映姫", "さとり", 300, 500)


CALL INIT_RELATION("神奈子", "文", 500, 300)
CALL INIT_RELATION("神奈子", "紫", 0, 400)
CALL INIT_RELATION("神奈子", "慧音", 300, 0)
CALL INIT_RELATION("神奈子", "さとり", 300, 0)

CALL INIT_RELATION("天子", "霊夢", 300, 0)
CALL INIT_RELATION("天子", "紫", 0, 1500)

CALL INIT_RELATION("さとり", "紫", 0, 400)
CALL INIT_RELATION("さとり", "神奈子", 300, 300)
CALL INIT_RELATION("さとり", "四季映姫", 300, 300)
CALL INIT_RELATION("さとり", "勇儀", 300, 0)
CALL INIT_RELATION("さとり", "夢美", 0, 500)

CALL INIT_RELATION("白蓮", "霊夢", 300, 0)
CALL INIT_RELATION("白蓮", "神子", 500, 1500)
CALL INIT_RELATION("白蓮", "慧音", 300, 0)
CALL INIT_RELATION("白蓮", "さとり", 300, 300)
CALL INIT_RELATION("白蓮", "神綺", 300, 0)

CALL INIT_RELATION("神子", "霊夢", 300, 0)
CALL INIT_RELATION("神子", "白蓮", 500, 1500)
CALL INIT_RELATION("神子", "慧音", 300, 0)

;霊夢以外の強そうな連中にけんかを売っていくスタイル
CALL INIT_RELATION("針妙丸", "霊夢", 500, 0)
CALL INIT_RELATION("針妙丸", "魔理沙", 0, 500)
CALL INIT_RELATION("針妙丸", "レミリア", 0, 500)
CALL INIT_RELATION("針妙丸", "幽々子", 0, 500)
CALL INIT_RELATION("針妙丸", "紫", 0, 500)
CALL INIT_RELATION("針妙丸", "永琳", 0, 500)
CALL INIT_RELATION("針妙丸", "四季映姫", 0, 500)
CALL INIT_RELATION("針妙丸", "神奈子", 0, 500)
CALL INIT_RELATION("針妙丸", "天子", 0, 500)
CALL INIT_RELATION("針妙丸", "さとり", 0, 500)
CALL INIT_RELATION("針妙丸", "白蓮", 0, 500)
CALL INIT_RELATION("針妙丸", "神子", 0, 500)
CALL INIT_RELATION("針妙丸", "勇儀", 0, 500)
;チルノのとこはなんとか取り込めないかな……って思ってる
CALL INIT_RELATION("針妙丸", "チルノ", 300, 0)
CALL INIT_RELATION("針妙丸", "夢美", 0, 500)
CALL INIT_RELATION("針妙丸", "神綺", 0, 500)
CALL INIT_RELATION("針妙丸", "幻月", 0, 500)

CALL INIT_RELATION("慧音", "霊夢", 300, 0)
CALL INIT_RELATION("慧音", "魔理沙", 300, 0)
CALL INIT_RELATION("慧音", "紫", 300, 300)
CALL INIT_RELATION("慧音", "永琳", 500, 300)
CALL INIT_RELATION("慧音", "さとり", 0, 300)
CALL INIT_RELATION("慧音", "白蓮", 300, 300)
CALL INIT_RELATION("慧音", "神子", 300, 300)
CALL INIT_RELATION("慧音", "チルノ", 0, 200)
CALL INIT_RELATION("慧音", "針妙丸", 0, 200)
CALL INIT_RELATION("慧音", "マミゾウ", 500, 500)

CALL INIT_RELATION("チルノ", "霊夢", 300, 300)
CALL INIT_RELATION("チルノ", "魔理沙", 300, 300)
CALL INIT_RELATION("チルノ", "レミリア", 300, 300)
CALL INIT_RELATION("チルノ", "紫", 300, 0)
CALL INIT_RELATION("チルノ", "四季映姫", 0, 300)
CALL INIT_RELATION("チルノ", "針妙丸", 0, 500)

CALL INIT_RELATION("勇儀", "霊夢", 300, 0)
CALL INIT_RELATION("勇儀", "魔理沙", 300, 0)
CALL INIT_RELATION("勇儀", "さとり", 300, 500)


CALL INIT_RELATION("依姫", "サグメ", 1500, 0)
CALL INIT_RELATION("依姫", "純狐", 0, 1500)


;おい・・・
;おい！！！！！！！１！！！１！！１１
;おい嫦娥！！！！１１！１１１フグ田移転の敵！１１
;嫦娥みてるか！！！！！１１！！１１！１
;月の民の弄した愚策を！！１１１欲に溺れ生死を貪る穢れた人間の姿を！！！！！１１
CALL INIT_RELATION("純狐", "依姫", 0, 1500)

;↑これすき
CALL INIT_RELATION("サグメ", "依姫", 1500, 0)
CALL INIT_RELATION("サグメ", "永琳", 1500, 0)



CALL INIT_RELATION("マミゾウ", "慧音", 400, 200)
CALL INIT_RELATION("マミゾウ", "神奈子", 0, 200)
CALL INIT_RELATION("マミゾウ", "チルノ", 0, 200)
CALL INIT_RELATION("マミゾウ", "針妙丸", 500, 0)
CALL INIT_RELATION("マミゾウ", "白蓮", 0, 200)
CALL INIT_RELATION("マミゾウ", "さとり", 100, 500)
CALL INIT_RELATION("マミゾウ", "レミリア", 0, 200)
CALL INIT_RELATION("マミゾウ", "霊夢", 200, 200)


CALL INIT_RELATION("文", "神奈子", 500, 300)

;-------------------------------------------------
;定例イベント
;ターンエンド時に呼び出される
;SCVAR:0 外来人侵攻済みフラグ
;SCVAR:2 謎の薬売り前回どれだったフラグ
;ここから
;SCVAR:20 封獣ぬえ離反済みフラグ
;SCVAR:21 正邪離反済みフラグ
;SCVAR;22 フラン離反済みフラグ
;SCVAR;23 文
;SCVAR;24 鈴仙
;SCVAR;25 サニーミルク
;SCVAR;26 椛
;SCVAR;27 パチュリー
;SCVAR;28 美鈴
;SCVAR;29 てゐ
;SCVAR;30 幽香
;SCVAR;31 空
;SCVAR;32 小傘
;SCVAR;33 響子
;SCVAR;34 青娥
;SCVAR;35 こころ
;SCVAR;36 赤蛮奇
;SCVAR;37 妹紅
;SCVAR;38 レイセン
;SCVAR;39 ルーミア
;SCVAR;40 ミスティア
;SCVAR;41 ヤマメ
;SCVAR;42 ルナサ
;SCVAR;43 アリス
;ここまで、SCVAR:20でまとめました（ビット処理の活用例）
;-------------------------------------------------
@SCENARIO_EVENT_4
#DIM UNIFY




;特定キャラの離反イベント
;キャラに応じた条件で離反が発生します（正邪から順に行い離反者が決まれば実行、１期に１人まで）
;REBELLION_FLAGの引数は("キャラ名", 離反開始ターン数, 離反を諦めるターン数, 離反元の最低支配都市数, 離反元の最大離反都市数, 離反確率)です
;またREBELLION_FLAG側で「無所属でない」「捕虜でない」「スキマ送りされていない」「プレイヤーではない」「君主ではない」を判定しています
;他の条件については頑張って解読してください（ぉ
LOCAL:1 = 0
;正邪優先、ただし君主が針妙丸の時は起こらない
IF !GETBIT(SCVAR:20,0) && REBELLION_FLAG("正邪", 30) && CFLAG:(NAME_TO_CHARA("正邪")):1 != GET_COUNTRY_FROM_ID(SP_COUNTRY_ID:(特殊勢力_外来人)) && GET_COUNTRY_BOSS(CFLAG:(NAME_TO_CHARA("正邪")):1) != FINDCHARA(CSTR:99, "針妙丸")
	LOCAL:1 = FINDCHARA(CSTR:99, "正邪")
ELSEIF !GETBIT(SCVAR:20,1) && REBELLION_FLAG("ぬえ", 30) && CFLAG:(NAME_TO_CHARA("ぬえ")):1 != GET_COUNTRY_FROM_ID(SP_COUNTRY_ID:(特殊勢力_外来人))
	LOCAL:1 = FINDCHARA(CSTR:99, "ぬえ")
ELSEIF !GETBIT(SCVAR:20,2) && REBELLION_FLAG("フランドール", 10, , 3, 4, 100) && CFLAG:(NAME_TO_CHARA("フランドール")):1 != GET_COUNTRY_FROM_ID(SP_COUNTRY_ID:(特殊勢力_外来人)) && GET_COUNTRY_BOSS(CFLAG:(NAME_TO_CHARA("フランドール")):1) == FINDCHARA(CSTR:99, "レミリア")
	LOCAL:1 = FINDCHARA(CSTR:99, "フランドール")
ELSEIF !GETBIT(SCVAR:20,3) && REBELLION_FLAG("文", 90, , 10, 45, 60) && CFLAG:(NAME_TO_CHARA("文")):1 != GET_COUNTRY_FROM_ID(SP_COUNTRY_ID:(特殊勢力_外来人)) && GET_COUNTRY_BOSS(CFLAG:(NAME_TO_CHARA("椛")):1) != FINDCHARA(CSTR:99, "文")
	LOCAL:1 = FINDCHARA(CSTR:99, "文")
ELSEIF !GETBIT(SCVAR:20,4) && REBELLION_FLAG("鈴仙", 30, , 3, 10, 30) && CFLAG:(NAME_TO_CHARA("鈴仙")):1 != GET_COUNTRY_FROM_ID(SP_COUNTRY_ID:(特殊勢力_外来人))
	LOCAL:1 = FINDCHARA(CSTR:99, "鈴仙")
ELSEIF !GETBIT(SCVAR:20,5) && REBELLION_FLAG("サニーミルク", 10, , 3, 5, 100) && CFLAG:(NAME_TO_CHARA("サニーミルク")):1 != GET_COUNTRY_FROM_ID(SP_COUNTRY_ID:(特殊勢力_外来人)) && GET_COUNTRY_BOSS(CFLAG:(NAME_TO_CHARA("サニーミルク")):1) != FINDCHARA(CSTR:99, "霊夢")　 && GET_COUNTRY_BOSS(CFLAG:(NAME_TO_CHARA("サニーミルク")):1) != FINDCHARA(CSTR:99, "チルノ")
	LOCAL:1 = FINDCHARA(CSTR:99, "サニーミルク")
ELSEIF !GETBIT(SCVAR:20,6) && REBELLION_FLAG("椛", 140, , 10, 45, 100) && CFLAG:(NAME_TO_CHARA("椛")):1 != GET_COUNTRY_FROM_ID(SP_COUNTRY_ID:(特殊勢力_外来人))
	LOCAL:1 = FINDCHARA(CSTR:99, "椛")
ELSEIF !GETBIT(SCVAR:20,7) && REBELLION_FLAG("パチュリー", 10, , 3, 7, 100) && CFLAG:(NAME_TO_CHARA("パチュリー")):1 != GET_COUNTRY_FROM_ID(SP_COUNTRY_ID:(特殊勢力_外来人)) && GET_COUNTRY_BOSS(CFLAG:(NAME_TO_CHARA("パチュリー")):1) != FINDCHARA(CSTR:99, "レミリア")
	LOCAL:1 = FINDCHARA(CSTR:99, "パチュリー")
ELSEIF !GETBIT(SCVAR:20,8) && REBELLION_FLAG("美鈴", 10, , 3, 7, 50) && CFLAG:(NAME_TO_CHARA("美鈴")):1 != GET_COUNTRY_FROM_ID(SP_COUNTRY_ID:(特殊勢力_外来人)) && GET_COUNTRY_BOSS(CFLAG:(NAME_TO_CHARA("美鈴")):1) != FINDCHARA(CSTR:99, "レミリア")
	LOCAL:1 = FINDCHARA(CSTR:99, "美鈴")
ELSEIF !GETBIT(SCVAR:20,9) && REBELLION_FLAG("てゐ", 10, , 3, 5, 30) && CFLAG:(NAME_TO_CHARA("てゐ")):1 != GET_COUNTRY_FROM_ID(SP_COUNTRY_ID:(特殊勢力_外来人))
	LOCAL:1 = FINDCHARA(CSTR:99, "てゐ")
ELSEIF !GETBIT(SCVAR:20,10) && REBELLION_FLAG("幽香", 50, , 10, 45, 100) && CFLAG:(NAME_TO_CHARA("幽香")):1 != GET_COUNTRY_FROM_ID(SP_COUNTRY_ID:(特殊勢力_外来人))
	LOCAL:1 = FINDCHARA(CSTR:99, "幽香")
ELSEIF !GETBIT(SCVAR:20,11) && REBELLION_FLAG("空", 30, , 5, 25, 30) && CFLAG:(NAME_TO_CHARA("空")):1 != GET_COUNTRY_FROM_ID(SP_COUNTRY_ID:(特殊勢力_外来人))
	LOCAL:1 = FINDCHARA(CSTR:99, "空")
ELSEIF !GETBIT(SCVAR:20,12) && REBELLION_FLAG("小傘", 10, , 5, 20, 30) && CFLAG:(NAME_TO_CHARA("小傘")):1 != GET_COUNTRY_FROM_ID(SP_COUNTRY_ID:(特殊勢力_外来人))
	LOCAL:1 = FINDCHARA(CSTR:99, "小傘")
ELSEIF !GETBIT(SCVAR:20,13) && REBELLION_FLAG("響子", 10, , 5, 20, 30) && CFLAG:(NAME_TO_CHARA("響子")):1 != GET_COUNTRY_FROM_ID(SP_COUNTRY_ID:(特殊勢力_外来人)) && GET_COUNTRY_BOSS(CFLAG:(NAME_TO_CHARA("響子")):1) != FINDCHARA(CSTR:99, "聖")
	LOCAL:1 = FINDCHARA(CSTR:99, "響子")
ELSEIF !GETBIT(SCVAR:20,14) && REBELLION_FLAG("青娥", 80, , 3, 5, 100) && CFLAG:(NAME_TO_CHARA("青娥")):1 != GET_COUNTRY_FROM_ID(SP_COUNTRY_ID:(特殊勢力_外来人))
	LOCAL:1 = FINDCHARA(CSTR:99, "青娥")
ELSEIF !GETBIT(SCVAR:20,15) && REBELLION_FLAG("こころ", 30, , 5, 20, 50) && CFLAG:(NAME_TO_CHARA("こころ")):1 != GET_COUNTRY_FROM_ID(SP_COUNTRY_ID:(特殊勢力_外来人))
	LOCAL:1 = FINDCHARA(CSTR:99, "こころ")
ELSEIF !GETBIT(SCVAR:20,16) && REBELLION_FLAG("赤蛮奇", 10, , 3, 5, 100) && CFLAG:(NAME_TO_CHARA("赤蛮奇")):1 != GET_COUNTRY_FROM_ID(SP_COUNTRY_ID:(特殊勢力_外来人))
	LOCAL:1 = FINDCHARA(CSTR:99, "赤蛮奇")
ELSEIF !GETBIT(SCVAR:20,17) && REBELLION_FLAG("妹紅", 90, , 3, 10, 100) && CFLAG:(NAME_TO_CHARA("妹紅")):1 != GET_COUNTRY_FROM_ID(SP_COUNTRY_ID:(特殊勢力_外来人))
	LOCAL:1 = FINDCHARA(CSTR:99, "妹紅")
ELSEIF !GETBIT(SCVAR:20,18) && REBELLION_FLAG("レイセン", 30, , 5, 20, 30) && CFLAG:(NAME_TO_CHARA("レイセン")):1 != GET_COUNTRY_FROM_ID(SP_COUNTRY_ID:(特殊勢力_外来人))
	LOCAL:1 = FINDCHARA(CSTR:99, "レイセン")
ELSEIF !GETBIT(SCVAR:20,19) && REBELLION_FLAG("ルーミア", 40, , 3, 7, 70) && CFLAG:(NAME_TO_CHARA("ルーミア")):1 != GET_COUNTRY_FROM_ID(SP_COUNTRY_ID:(特殊勢力_外来人))
	LOCAL:1 = FINDCHARA(CSTR:99, "ルーミア")
ELSEIF !GETBIT(SCVAR:20,20) && REBELLION_FLAG("ミスティア", 50, , 3, 7, 50) && CFLAG:(NAME_TO_CHARA("ミスティア")):1 != GET_COUNTRY_FROM_ID(SP_COUNTRY_ID:(特殊勢力_外来人))
	LOCAL:1 = FINDCHARA(CSTR:99, "ミスティア")
ELSEIF !GETBIT(SCVAR:20,21) && REBELLION_FLAG("ヤマメ", 30, , 3, 10, 50) && CFLAG:(NAME_TO_CHARA("ヤマメ")):1 != GET_COUNTRY_FROM_ID(SP_COUNTRY_ID:(特殊勢力_外来人))
	LOCAL:1 = FINDCHARA(CSTR:99, "ヤマメ")
ELSEIF !GETBIT(SCVAR:20,22) && REBELLION_FLAG("ルナサ", 10, , 3, 5, 40) && CFLAG:(NAME_TO_CHARA("ルナサ")):1 != GET_COUNTRY_FROM_ID(SP_COUNTRY_ID:(特殊勢力_外来人))
	LOCAL:1 = FINDCHARA(CSTR:99, "ルナサ")
ELSEIF !GETBIT(SCVAR:20,23) && REBELLION_FLAG("アリス", 90, , 3, 7, 50) && CFLAG:(NAME_TO_CHARA("アリス")):1 != GET_COUNTRY_FROM_ID(SP_COUNTRY_ID:(特殊勢力_外来人))
	LOCAL:1 = FINDCHARA(CSTR:99, "アリス")
ELSEIF !GETBIT(SCVAR:20,24) && REBELLION_FLAG("清蘭", 30, ,3, 20, 100) && CFLAG:(NAME_TO_CHARA("清蘭")):1 != GET_COUNTRY_FROM_ID(SP_COUNTRY_ID:(特殊勢力_外来人)) && GET_COUNTRY_BOSS(CFLAG:(NAME_TO_CHARA("サグメ")):1) == FINDCHARA(CSTR:99, "サグメ") && GET_COUNTRY_BOSS(CFLAG:(NAME_TO_CHARA("清蘭")):1) == FINDCHARA(CSTR:99, "サグメ")
	LOCAL:1 = FINDCHARA(CSTR:99, "清蘭")
ELSEIF !GETBIT(SCVAR:20,25) && REBELLION_FLAG("純狐", 10, 3, 60, 100) && CFLAG:(NAME_TO_CHARA("純狐")):1 != GET_COUNTRY_FROM_ID(SP_COUNTRY_ID:(特殊勢力_外来人)) && GET_COUNTRY_BOSS(CFLAG:(NAME_TO_CHARA("純狐")):1) == FINDCHARA(CSTR:99, "依姫")
	LOCAL:1 = FINDCHARA(CSTR:99, "純狐")

ENDIF
IF LOCAL:1 != 0
	;離反元君主のキャラ番号
	LOCAL:2 = GET_COUNTRY_BOSS(CFLAG:(LOCAL:1):1)
	;離反元国家の番号
	LOCAL:3 = CFLAG:(LOCAL:1):1
	;新しい勢力を取得
	LOCAL:4 = GET_NEW_COUNTRY()
	;反乱フラグをビット処理。これで同一周回でふたりとも謀反できるよ、やったね
	;本命は当然反乱予定者を増やすためにございます（とは言っても64人が限界ですが。TWのビット処理を引用すると汎用でない全キャラ巻き込めますが）
	;勢力発生後に移動させたのは反乱かやらごとの一部設定をここで設定しやすいように。具体的には勢力カラーとか（イメージに合う色が思いつかないのでそのままにしておく）。
	SELECTCASE LOCAL:1
	CASE FINDCHARA(CSTR:99, "正邪")
		SETBIT SCVAR:20 , 0
		COUNTRY_COLOR:(LOCAL:4) = 0x55FFFF
	CASE FINDCHARA(CSTR:99, "ぬえ")
		SETBIT SCVAR:20 , 1
		COUNTRY_COLOR:(LOCAL:4) = 0x800000
	CASE FINDCHARA(CSTR:99, "フランドール")
		SETBIT SCVAR:20 , 2
		COUNTRY_COLOR:(LOCAL:4) = COLOR("注意")
	CASE FINDCHARA(CSTR:99, "文")
		SETBIT SCVAR:20 , 3
		COUNTRY_COLOR:(LOCAL:4) = 0xFF9999
	CASE FINDCHARA(CSTR:99, "鈴仙")
		SETBIT SCVAR:20 , 4
		COUNTRY_COLOR:(LOCAL:4) = 0x663399
	CASE FINDCHARA(CSTR:99, "サニーミルク")
		SETBIT SCVAR:20 , 5
		COUNTRY_COLOR:(LOCAL:4) = 0xFFE4E1
	CASE FINDCHARA(CSTR:99, "椛")
		SETBIT SCVAR:20 , 6
		COUNTRY_COLOR:(LOCAL:4) = 0xCD853F
	CASE FINDCHARA(CSTR:99, "パチュリー")
		SETBIT SCVAR:20 , 7
		COUNTRY_COLOR:(LOCAL:4) = 0xFF1493
	CASE FINDCHARA(CSTR:99, "美鈴")
		SETBIT SCVAR:20 , 8
		COUNTRY_COLOR:(LOCAL:4) = 0x228B22
	CASE FINDCHARA(CSTR:99, "てゐ")
		SETBIT SCVAR:20 , 9
		COUNTRY_COLOR:(LOCAL:4) = 0xFAEBD7
	CASE FINDCHARA(CSTR:99, "幽香")
		SETBIT SCVAR:20 , 10
		COUNTRY_COLOR:(LOCAL:4) = 0xC71585
	CASE FINDCHARA(CSTR:99, "空")
		SETBIT SCVAR:20 , 11
		COUNTRY_COLOR:(LOCAL:4) = 0xFF4500
	CASE FINDCHARA(CSTR:99, "小傘")
		SETBIT SCVAR:20 , 12
		COUNTRY_COLOR:(LOCAL:4) = 0x5F9EA0
	CASE FINDCHARA(CSTR:99, "響子")
		SETBIT SCVAR:20 , 13
		COUNTRY_COLOR:(LOCAL:4) = 0x8B4513
	CASE FINDCHARA(CSTR:99, "青娥")
		SETBIT SCVAR:20 , 14
		COUNTRY_COLOR:(LOCAL:4) = 0x1E90FF
	CASE FINDCHARA(CSTR:99, "こころ")
		SETBIT SCVAR:20 , 15
		COUNTRY_COLOR:(LOCAL:4) = 0xAFEEEE
	CASE FINDCHARA(CSTR:99, "赤蛮奇")
		SETBIT SCVAR:20 , 16
		COUNTRY_COLOR:(LOCAL:4) = 0xB22222
	CASE FINDCHARA(CSTR:99, "妹紅")
		SETBIT SCVAR:20 , 17
		COUNTRY_COLOR:(LOCAL:4) = 0xFF7F50
	CASE FINDCHARA(CSTR:99, "レイセン")
		SETBIT SCVAR:20 , 18
		COUNTRY_COLOR:(LOCAL:4) = 0x6A5ACD  
	CASE FINDCHARA(CSTR:99, "ルーミア")
		SETBIT SCVAR:20 , 19
		COUNTRY_COLOR:(LOCAL:4) = 0xFFD700
	CASE FINDCHARA(CSTR:99, "ミスティア")
		SETBIT SCVAR:20 , 20
		COUNTRY_COLOR:(LOCAL:4) = 0xDA70D6
	CASE FINDCHARA(CSTR:99, "ヤマメ")
		SETBIT SCVAR:20 , 21
		COUNTRY_COLOR:(LOCAL:4) = 0xCD5C5C
	CASE FINDCHARA(CSTR:99, "ルナサ")
		SETBIT SCVAR:20 , 22
		COUNTRY_COLOR:(LOCAL:4) = 0xB0C4DE
	CASE FINDCHARA(CSTR:99, "アリス")
		SETBIT SCVAR:20 , 23
		COUNTRY_COLOR:(LOCAL:4) = 0x9932CC
	CASE FINDCHARA(CSTR:99, "清蘭")
		SETBIT SCVAR:20 , 24
		COUNTRY_COLOR:(LOCAL:4) = 0x00bfff
	CASE FINDCHARA(CSTR:99, "純狐")
		SETBIT SCVAR:20 , 25
		COUNTRY_COLOR:(LOCAL:4) = 0xa0522d
	ENDSELECT
	;プレイヤーの態度をLOCAL:10に格納
	;出力 0:離反について出奔,1:元君主のもとに留まる,2:説得を行うも失敗
	LOCAL:10 = 1
	;プレイヤーが離反者の所属国家の君主でなく、かつ離反者の同僚である
	IF LOCAL:2 != MASTER && CFLAG:MASTER:1 == CFLAG:(LOCAL:1):1
		;それなりに仲が良いと、一緒に来ないかと尋ねられる
		;正邪用のセリフは用意してません。共通です。一応正体不明云々はぬえの時だけ表示されるはず
		IF CFLAG:(LOCAL:1):2 >= 300
			DRAWLINE
			PRINTFORMW ある日、%ANAME(LOCAL:1)%に急に呼び出された
			PRINTFORMW 人払いをした彼女の部屋で、%ANAME(LOCAL:1)%に告げられる
			PRINTFORMW 「じつはさぁ……%ANAME(LOCAL:2)%のとこを出ようと思うんだよね」
			PRINTFORMW 「つまり離反ってやつ。で、あんた見たところ使えそうだし、なんならウチに来ない？　って相談なんだけど。どう？」
			PRINTFORMW 「迷うと思うんだけど、できればすぐ返事が欲しいんだよね……アンタが%ANAME(LOCAL:2)%にチクらないとも限らないし」
			PRINTFORMW すぐに返事しろと言われても困る。だが%ANAME(LOCAL:1)%は、ともかく何かしら応えるまで返すつもりはないようだ……
			$INPUT_LOOP_NUE_INVITATION
			PRINTFORML [0] %ANAME(LOCAL:1)%につく
			PRINTFORML [1] %ANAME(LOCAL:2)%側に残る
			PRINTFORML [2] バカなことはやめろという
			INPUT
			IF RESULT == 0
				CFLAG:MASTER:1 = LOCAL:4
				PRINTFORMW 「くくっ、あんたならそう言ってくれると思ってたよ」
				PRINTFORMW %ANAME(LOCAL:1)%は凶悪な笑みをにやりと浮かべてみせた。
				PRINTFORMW 「じゃあ、いっちょやってやろうじゃないか。私とあんたで、この幻想郷を恐怖の底に沈めてやるのさ」
				IF LOCAL:1 == NAME_TO_CHARA("ぬえ")
					PRINTFORMW 「……正体不明の恐怖にね！　くくく！」
				ENDIF
				PRINTFORMW なんだかえらいことに首を突っ込んでしまった気がする。大丈夫だろうか……。
				;ぬえちゃん強キャラだけどぶっちゃけ他に誰連れてこれるか次第だねこれね。
				;チート級あなたが味方ならそりゃまぁ心強いけど、途中何回孕まされるか分かったもんじゃないね？？
				LOCAL:10 = 0
			ELSEIF RESULT == 1
				PRINTFORMW %ANAME(LOCAL:2)%を裏切るわけにはいかない……そう告げると、%ANAME(LOCAL:1)%は露骨に失望した表情を浮かべた
				PRINTFORMW 「……はあ。あっそ、じゃあとっとと出ていきな」
				PRINTFORMW 「後悔しないことだね。私の国は、あんたんとこなんて一瞬で食い尽くすよ」
				PRINTFORMW それっきり%ANAME(LOCAL:1)%はこちらに興味を失ったのか、そっぽを向いてしまった
				PRINTFORMW ここで%ANAME(MASTER)%に危害を加えるつもりはないようだが、次に会うときは敵としてになるだろう……
				PRINTL
				LOCAL:10 = 1
			ELSEIF RESULT == 2 && (IS_LOVER(LOCAL:1) || IS_SLAVE(LOCAL:1))
				PRINTFORMW バカなことはやめろ……%ANAME(MASTER)%が必死に説得すると、%ANAME(LOCAL:1)%はため息をついた
				PRINTFORMW 「……はあ。あんたにそんなこと言われちゃうなんてね」
				PRINTFORMW 「まあ、分かったよ。あんたの言うことは断りたくないから。我慢してあげる：
				PRINTFORMW 「……その代わり、私のこと、色々満足させてよね？」
				PRINTFORMW どうやら%ANAME(LOCAL:1)%は離反をあきらめてくれたようだ……
				RETURN
			ELSEIF RESULT == 2
				PRINTFORMW バカなことはやめろ……%ANAME(MASTER)%が必死に説得すると、%ANAME(LOCAL:1)%は逆上した
				PRINTFORMW 「あ？　なんであんたにそんなこと言われなきゃいけないわけ？」
				PRINTFORMW 「もういい。分かった。あんたは要らない。私が作る新しい国に、呑まれて消えちまえばいいんだ
				PRINTFORMW それっきり%ANAME(LOCAL:1)%はこちらに興味を失ったのか、そっぽを向いてしまった
				PRINTFORMW ここで%ANAME(MASTER)%に危害を加えるつもりはないようだが、次に会うときは敵としてになるだろう……
				LOCAL:10 = 2
			ENDIF
		ENDIF
	ENDIF
	DRAWLINE

	SETCOLOR COLOR("注意")
	PRINTFORMW ！%NAME_FORMAL(LOCAL:1)%が挙兵し、%NAME_FORMAL(LOCAL:2)%の勢力から独立しました！
	RESETCOLOR
	WAIT
	
	COUNTRY_BOSS:(LOCAL:4) = GET_ID(LOCAL:1)
	CFLAG:(LOCAL:1):1 = LOCAL:4

	;離反元勢力の都市の守将を解除
	FOR LOCAL:0, 0, MAX_CITY
		IF CITY_OWNER:(LOCAL:0) == LOCAL:3
			CITY_COMMANDER:(LOCAL:0) = 0
		ENDIF
	NEXT

	;DEBUGPRINTFORML DISARM:{LOCAL:3}

	;都市を二つかすめ取る
	;隣接する二都市を確実に奪うように。なお離反元が分断されても致し方なし
	;隣接前提で三都市以上となると判定が面倒なのでやめておくといいと思います。
	;LOCAL 3:離反元の勢力 , 4:離反勢力 , 6:仮の離反都市A , 7:仮の離反都市B , 8:離反都市確定フラグ
	LOCAL:8 = 0
	CALL FISHER_YATES_SHAFFLE(MAX_CITY)
	FOR LOCAL:5, 0, MAX_CITY
		LOCAL:0 = SHAFFLE_ARRAY:(LOCAL:5)
		;都市が離反元勢力のものか
		IF CITY_OWNER:(LOCAL:0) == LOCAL:3
			;仮の離反都市Aの設定
			LOCAL:6 = LOCAL:5
			;残りの都市から隣接している離反元勢力の都市を検索
			FOR LOCAL:7 , LOCAL:6 , MAX_CITY
				;離反元勢力かつ接続している
				IF CITY_OWNER:(LOCAL:7) == LOCAL:3 && IS_ROOT(LOCAL:0 , LOCAL:7)
					;二都市の勢力を離反勢力のものに変えフラグを立てる
					CITY_OWNER:(LOCAL:0) = LOCAL:4
					CITY_OWNER:(LOCAL:7) = LOCAL:4
					LOCAL:8 = 1
					BREAK
				ENDIF
			NEXT
		ENDIF
		SIF LOCAL:8
			BREAK
	NEXT
	;離反元勢力の全都市が孤立していた場合、ランダムに二都市奪う
	IF !LOCAL:8
		CALL STEAL_CITIES(LOCAL:3, LOCAL:4, 2)
		;DEBUGPRINTFORML KEEP CITY:RANDAM
	ELSE
		;DEBUGPRINTFORML KEEP CITY:CONNECT
	ENDIF


	;マミゾウは（ぬえの離反の時、離反元にいて、捕虜でなく、君主でもなければ）必ず奪う
	IF CFLAG:(NAME_TO_CHARA("マミゾウ")):1 == LOCAL:3 && CFLAG:(NAME_TO_CHARA("マミゾウ")):捕虜先 == 0 && LOCAL:2 != NAME_TO_CHARA("マミゾウ") && LOCAL:1 == NAME_TO_CHARA("ぬえ")
		CFLAG:(NAME_TO_CHARA("マミゾウ")):1 = LOCAL:4
	ELSEIF CFLAG:(NAME_TO_CHARA("椛")):1 == LOCAL:3 && CFLAG:(NAME_TO_CHARA("椛")):捕虜先 == 0 && LOCAL:2 != NAME_TO_CHARA("椛") && LOCAL:1 == NAME_TO_CHARA("文")
		CFLAG:(NAME_TO_CHARA("椛")):1 = LOCAL:4
	ELSEIF CFLAG:(NAME_TO_CHARA("にとり")):1 == LOCAL:3 && CFLAG:(NAME_TO_CHARA("にとり")):捕虜先 == 0 && LOCAL:2 != NAME_TO_CHARA("にとり") && LOCAL:1 == NAME_TO_CHARA("椛")
		CFLAG:(NAME_TO_CHARA("にとり")):1 = LOCAL:4
	ELSEIF CFLAG:(NAME_TO_CHARA("燐")):1 == LOCAL:3 && CFLAG:(NAME_TO_CHARA("燐")):捕虜先 == 0 && LOCAL:2 != NAME_TO_CHARA("燐") && LOCAL:1 == NAME_TO_CHARA("空")
		CFLAG:(NAME_TO_CHARA("燐")):1 = LOCAL:4
	ELSEIF CFLAG:(NAME_TO_CHARA("ミスティア")):1 == LOCAL:3 && CFLAG:(NAME_TO_CHARA("ミスティア")):捕虜先 == 0 && LOCAL:2 != NAME_TO_CHARA("ミスティア") && LOCAL:1 == NAME_TO_CHARA("響子")
		CFLAG:(NAME_TO_CHARA("ミスティア")):1 = LOCAL:4
	ELSEIF CFLAG:(NAME_TO_CHARA("芳香")):1 == LOCAL:3 && CFLAG:(NAME_TO_CHARA("芳香")):捕虜先 == 0 && LOCAL:2 != NAME_TO_CHARA("芳香") && LOCAL:1 == NAME_TO_CHARA("青娥")
		CFLAG:(NAME_TO_CHARA("芳香")):1 = LOCAL:4
	ELSEIF CFLAG:(NAME_TO_CHARA("響子")):1 == LOCAL:3 && CFLAG:(NAME_TO_CHARA("響子")):捕虜先 == 0 && LOCAL:2 != NAME_TO_CHARA("響子") && LOCAL:1 == NAME_TO_CHARA("ミスティア")
		CFLAG:(NAME_TO_CHARA("響子")):1 = LOCAL:4
	ELSEIF CFLAG:(NAME_TO_CHARA("慧音")):1 == LOCAL:3 && CFLAG:(NAME_TO_CHARA("慧音")):捕虜先 == 0 && LOCAL:2 != NAME_TO_CHARA("慧音") && LOCAL:1 == NAME_TO_CHARA("妹紅")
		CFLAG:(NAME_TO_CHARA("慧音")):1 = LOCAL:4
	ELSEIF CFLAG:(NAME_TO_CHARA("清蘭")):1 == LOCAL:3 && CFLAG:(NAME_TO_CHARA("清蘭")):捕虜先 == 0 && LOCAL:2 != NAME_TO_CHARA("清蘭") && LOCAL:1 == NAME_TO_CHARA("鈴瑚")
		CFLAG:(NAME_TO_CHARA("清蘭")):1 = LOCAL:4
	ENDIF


	;離反元所属武将の一部をかすめ取る処理。
	;LOCAL 1:離反者 , 2:離反元勢力君主 , 3:離反元勢力 , 5:離反元の未陥落者数 , 6:離反元の陥落済人数（プレイヤーが離反元勢力にいなければ5に併合）
	;      7:離反元から引きぬく人数 , 10:離反勧誘の返答
	;
	LOCAL:5 = 0
	LOCAL:6 = 0
	;所属武将の数を調べる
	FOR LOCAL:0, 0, CHARANUM
		;離反元所属で、捕虜でなく、プレイヤーでも離反者でも君主でないキャラ
		IF CFLAG:(LOCAL:0):1 == LOCAL:3 && CFLAG:(LOCAL:0):捕虜先 == 0 && !GROUPMATCH(LOCAL:0 , MASTER , LOCAL:1 , LOCAL:2)
		;DEBUGPRINTFORML CHARAMATCH:{LOCAL:0}
			;恋慕系か隷属系でないなら組み込み、恋慕なら拉致、プレイヤーのいない勢力では組み込み
			;(陥落済かつ「離反に同調」か「離反せず離反元に残る」)
			IF (IS_LOVER(LOCAL:0) || IS_SLAVE(LOCAL:0)) && (!LOCAL:10 || (LOCAL:10 && CFLAG:MASTER:1 == LOCAL:3))
				LOCAL:6 ++
			ELSE
				LOCAL:5 ++
			ENDIF
		ENDIF
	NEXT
	;DEBUGPRINTFORML PICK :{LOCAL:5}
	;DEBUGPRINTFORML STEAL:{LOCAL:6}


	;引き抜き・拉致対象武将が0より大きいなら、ループ回しながらランダムにもっていく
	;拉致は多くて1/3まで。ただしいずれも候補が一人以上いるなら最低一人は持っていく可能性がある
	IF LOCAL:5 > 0 || LOCAL:6 > 0
		LOCAL:5 = LOCAL:5 ? MAX(LOCAL:5 / 3 , 1) # 0
		;あなたが裏切るなら恋慕・隷属は全員付いてくる
		IF LOCAL:10 == 1
			LOCAL:6 = LOCAL:6 ? MAX(RAND:(LOCAL:6 + 1) / 3 , 1) # 0
		;怒らせると陥落済の人を余分に拉致して行きます。これは後でおしおきですね
		ELSEIF LOCAL:10 == 2
			LOCAL:6 = LOCAL:6 ? MAX(RAND:(LOCAL:6 + 1) * 2 / 3 , 1) # 0
		ENDIF
		;LOCAL:7に引抜き及び拉致する人数を合計しておき、合計人数が75％以上（残選択数が25％以下）であればそこで諦める
		LOCAL:7 = LOCAL:5 + LOCAL:6
		;最大周回を5回に設定
		LOCAL:11 = 5
		WHILE (100 - ((LOCAL:5 + LOCAL:6) * 100 / LOCAL:7) < 75 && LOCAL:11 > 0)
			;判定するキャラ順をシャッフル、再挑戦するたびに順番は変わります
			CALL FISHER_YATES_SHAFFLE(CHARANUM)
			FOR LOCAL:99, 0, CHARANUM
				LOCAL:0 = SHAFFLE_ARRAY:(LOCAL:99)
				;離反元所属で、捕虜でなく、プレイヤーでも離反者でも君主でないキャラ
				IF CFLAG:(LOCAL:0):1 == LOCAL:3 && CFLAG:(LOCAL:0):捕虜先 == 0 && !GROUPMATCH(LOCAL:0 , MASTER , LOCAL:1 , LOCAL:2)
					;陥落済かつ「離反に同調」か「離反せず離反元に残る」ではないなら1/2で引き抜かれる
					IF !((IS_LOVER(LOCAL:0) || IS_SLAVE(LOCAL:0)) && (!LOCAL:10 || (LOCAL:10 && CFLAG:MASTER:1 == LOCAL:3))) && RAND:2 == 0  && LOCAL:5 > 0
						CFLAG:(LOCAL:0):1 = LOCAL:4
						LOCAL:5 --
					;離反せず離反元に残るなら陥落済みキャラは1/2で拉致される
					ELSEIF RAND:2 == 0 && (IS_LOVER(LOCAL:0) || IS_SLAVE(LOCAL:0)) && LOCAL:6 > 0 && INRANGE(LOCAL:10 , 1 , 2)
						CFLAG:(LOCAL:0):捕虜先 = LOCAL:4
						LOCAL:6 --
					;離反に同調すれば陥落済キャラは同行
					ELSEIF (IS_LOVER(LOCAL:0) || IS_SLAVE(LOCAL:0)) && LOCAL:6 > 0 && LOCAL:10 == 0
						CFLAG:(LOCAL:0):1 = LOCAL:4
						LOCAL:6 --
					ENDIF
				ENDIF
			NEXT
			LOCAL:11 --
		WEND
	ENDIF
	;離反元勢力の部隊を解散
	CALL CLEAR_ALL_UNIT(LOCAL:3, 1)

	;仲はまぁ、悪くもなりますわな
	CALL CHANGE_RELATION_C_TO_C(LOCAL:3, LOCAL:4, -200, 600)
	CALL CHANGE_RELATION_C_TO_C(LOCAL:4, LOCAL:3, -200, 600)
	
	;反乱勢力の都市を表示
	FOR LOCAL:0, 0, MAX_CITY
		IF CITY_OWNER:(LOCAL:0) == LOCAL:4
			PRINTFORML %GET_CITYNAME(LOCAL:0)%が%ANAME(LOCAL:1)%の支配下におかれました
		ENDIF
	NEXT
	;反乱勢力に流れた人材
	FOR LOCAL:0, 0, CHARANUM
		IF CFLAG:(LOCAL:0):1 == LOCAL:4 && LOCAL:0 != LOCAL:1
			PRINTFORML %ANAME(LOCAL:0)%が%ANAME(LOCAL:1)%の下につきました
		ELSEIF CFLAG:(LOCAL:0):捕虜先 == LOCAL:4
			SETCOLOR COLOR("注意")
			;性処理用云々は消しました
			PRINTFORML %ANAME(LOCAL:0)%が%ANAME(LOCAL:1)%に拉致されました
			RESETCOLOR
		ENDIF
	NEXT


ENDIF

