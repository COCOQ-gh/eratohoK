;-------------------------------------------------
;セーブデータのアップデート処理
;-------------------------------------------------
@UPDATE
IF LASTLOAD_VERSION <= 161
	CONFIG:319 = 0
	FOR LOCAL, 0, 200
		IF EXISTCSV(LOCAL) && NO_TO_CHARA(LOCAL) != -1
			CSVTALENT LOCAL, 334
			TALENT:LOCAL:性的嗜好 = RESULT
		ENDIF
	NEXT
ENDIF

;易者、門番追加
IF LASTLOAD_VERSION <= 163
	FOR LOCAL, 0, 200
			IF NO_TO_CHARA(LOCAL) == -1 && EXISTCSV(LOCAL)
				ADDCHARA LOCAL
				CALL NEWCHARA_INIT(CHARANUM -1)
				CFLAG:(CHARANUM -1):12 = 1
			ENDIF
	NEXT
ENDIF

IF LASTLOAD_VERSION <= 164
	PRINTFORML 登録キャラパッチの不具合修正処理中……
	FOR LOCAL, 0, CHARANUM
		;登録キャラの不具合を修正
		IF GET_ID(LOCAL) == 0
			SETCOLOR COLOR("注意")
			PRINTFORML %ANAME(LOCAL)%に該当する不具合あり
			CALL NEWCHARA_INIT(LOCAL)
		ENDIF
	NEXT
	RESETCOLOR
	PRINTFORML 修正しました
	PRINTFORML これで多分ちゃんと動くんじゃね？
	
	;蓬莱人
	FOR LOCAL, 0, 200
		IF EXISTCSV(LOCAL) && NO_TO_CHARA(LOCAL) != -1
			CSVTALENT LOCAL, GETNUM(TALENT, "蓬莱人")
			TALENT:LOCAL:蓬莱人 = RESULT
		ENDIF
	NEXT
	
	CALL COLORPRINTFORM("デイリーイベントがコンフィグ保存/読み込みに対応しました", COLOR("注意"), "W")
	CALL COLORPRINTFORM("引き換えに、旧VERのコンフィグを読み込むとデイリーのフィルタ状況が吹き飛ぶ（多分）ので気をつけて下さい", COLOR("注意"), "W")
	
	SP_COUNTRY_APPEARED:特殊勢力出現_ホフゴブリン = ゴブリン出現済み
	SP_COUNTRY_APPEARED:特殊勢力出現_外来人 = 外来勢力出現済み
ENDIF

IF LASTLOAD_VERSION <= 166
	PRINTFORML IDのないキャラがいないか確認中……

	FOR LOCAL, 0, CHARANUM
		;登録キャラの不具合を修正
		IF GET_ID(LOCAL) == 0
			SETCOLOR COLOR("注意")
			PRINTFORML %ANAME(LOCAL)%に該当する不具合あり
			CALL NEWCHARA_INIT(LOCAL)
			PRINTFORML 修正しました
		ENDIF
	NEXT
	RESETCOLOR
	PRINTFORMW IDの不具合を修正しました
	PRINTFORML

	PRINTFORMW 全員に性的嗜好を設定します
	FOR LOCAL, 0, 200
		IF EXISTCSV(LOCAL) && NO_TO_CHARA(LOCAL) != -1
			CSVTALENT LOCAL, GETNUM(TALENT, "性的嗜好")
			TALENT:LOCAL:性的嗜好 = RESULT
		ENDIF
	NEXT
	PRINTFORMW 全員に性的嗜好を設定しました	
	SHOP_TIME = 0
	PRINTFORML
	PRINTFORMW 犬と豚を行動回数の計算に含めないようにしました
	PRINTFORMW 拠点フェイズにてセーブしていた場合、残行動回数が全回復します
ENDIF

IF LASTLOAD_VERSION <= 167
	SETCOLOR COLOR("注意")
	PRINTFORMW ！ver167対応パッチで追加されたデイリーイベントについて、コンフィグの割り当てが変更されました！
	PRINTFORMW ！ver167にパッチを自分で導入していた人は、デイリーイベントのフィルタが外れているかもしれません！
	PRINTFORMW ！確認してみてね！
	RESETCOLOR
ENDIF