;-------------------------------------------------
;「会いに行く」の名称
;　名称の有無はメニューの存在判定にも使用される
;-------------------------------------------------
@SHOP_LIFE_NAME11
IF CFLAG:MASTER:行動不能状態 == 2
	RESULTS:0 '= "子育てする"
ELSE
	RESULTS:0 '= "会いに行く"
ENDIF

;-------------------------------------------------
;「会いに行く」の選択可否
;　メニューの選択可否判定は@CHECK_CHECKCHARA_SAVEで行われ
;　SHOP_AVAIL:(メニュー番号)に 0:選択不可 1:選択可 で保存される
;　選択可能キャラ存在判定で 1:選択可 のキャラが存在し
;　この判定でも 1:選択可 なら SHOP_AVAIL:(メニュー番号)=1:選択可
;
;　RETURN 0:選択不可（キャラ存在判定に上書きして表示を阻止する）
;　RETURN 1:選択可
;-------------------------------------------------
@SHOP_LIFE_CHECK11
SIF CFLAG:MASTER:行動不能状態 == 1 || COOLTIME:MASTER:0 > 1
	RETURN 0
RETURN 1

;-------------------------------------------------
;「会いに行く」の選択可能キャラ存在判定
;　RETURN 0:このキャラは選択不可（リストに載らない）
;　RETURN 1:このキャラは選択可
;　RETURN 2:このキャラは灰色でリストに載るが選択不可
;-------------------------------------------------
@SHOP_LIFE_CHECKCHARA11(ARG:0)
;※使用前に TMP_CREATE_RELATION_MAP 関数を呼び出す必要あり
;　現在 TMP_CREATE_RELATION_MAP は SHOP.ERB で呼び出されている
LOCAL:0 = TMP_COUNTRY_RELATION:(CFLAG:MASTER:所属):(CFLAG:(ARG:0):所属)
;捕虜として捕まえている場合
IF CFLAG:(ARG:0):捕虜先
	;非主人公、主人公勢力の捕虜かつ軟禁中
	RETURN CHECK91(ARG:0, 2, ARG:0 != MASTER && CFLAG:(ARG:0):捕虜先 == CFLAG:MASTER:所属 && CFLAG:(ARG:0):監禁状態 == 1 && !IS_ANIMAL(ARG:0))
ENDIF
;捕虜でない、非主人公、同一勢力or共闘勢力
RETURN CHECK91(ARG:0, 2, ARG:0 != MASTER && LOCAL:0 >= 2 && !IS_ANIMAL(ARG:0))

;-------------------------------------------------
;「会いに行く」の選択可能キャラ存在判定補佐
;　リスト２が存在する場合、こちらで判定を行う
;-------------------------------------------------
;@SHOP_LIFE_CHECKCHARA_SUB11(ARG:0)

;-------------------------------------------------
;「会いに行く」の左カラムメニューの入力処理
;　RETURN 0:CLEARLINE LINECOUNT - LINES_SHOPする
;　RETURN 1:CLEARLINE LINECOUNT - LINES_SHOPしない
;-------------------------------------------------
@SHOP_LIFE_EVENTBUY11
FLAG:拠点フェイズページ = 1
FLAG:夜這い = 0
RETURN 0

;-------------------------------------------------
;「会いに行く」の右カラムオフ判定
;　通常は右カラムに何らかの表示があるが
;　右カラムに何も表示しないメニューならこの関数をセットしておく
;　するとメイン画面に戻ったとき最新の右カラム（ひとつ前に選択したメニュー等）を表示する
;-------------------------------------------------
;@SHOP_LIFE_EVENTBUY_COLUMN_RIGHT_OFF_CHECK11

;-------------------------------------------------
;「会いに行く」の右カラムボタン入力値をキャラ番号に変換する処理のオフ判定
;　入力値をそのまま指定したいときに使用
;-------------------------------------------------
;@SHOP_LIFE_USERSHOP_COLUMN_RIGHT_CONVERT_CHARANUM_OFF_CHECK11

;-------------------------------------------------
;「会いに行く」の右カラムキャラリスト１のボタン
;　選択中色のフラグをどの変数で立てるかによって
;　ボタン指定を変えるために使用する
;　この関数が未指定なら選択中色がない（トグル式でない）ボタンを表示する
;　ARG:1はリスト関数からCHECKCHARAの判定が渡されているのでそのまま返せばＯＫ
;-------------------------------------------------
;@SHOP_LIFE_LIST1_BUTTON11(ARG:0, ARG:1)
;CALL COLUMN_RIGHT_CHARALIST_BUTTON(キャラ（ARG:0）, 選択中カラー表示フラグ, ボタン番号に追加する数値（100）, CHECKCHARAの戻り値（ARG:1）, 行動済みマークをオフにするフラグ)
;RETURN 0

;-------------------------------------------------
;「会いに行く」の右カラムキャラリスト２のボタン
;　上に同じ
;-------------------------------------------------
;@SHOP_LIFE_LIST2_BUTTON11(ARG:0, ARG:1)
;RETURN 0

;-------------------------------------------------
;「会いに行く」の右カラムキャラリストボタン表示に追尾させる情報
;　デフォルトの情報を表示しない場合はRETURN 1
;-------------------------------------------------
;@SHOP_LIFE_BUTTON_ADD11(ARG:0)
;ここにボタンの後ろに表示したい情報
;RETURN 1

;-------------------------------------------------
;「会いに行く」の右カラム表示処理
;　この欄は改行PRINTL等の代わりにCALL COLUMN_RIGHT_PRINTLを
;　DRAWLINEの代わりにCALL COLUMN_RIGHT_LINEを使用する
;
;　@COLUMN_RIGHT_PRINTL　改行と行番号の指定と左カラムボタン表示
;　@COLUMN_RIGHT_LINE　　右カラム用の幅に設定されたラインを表示
;
;　ループ処理では改行されないほうが処理しやすいので線は改行していない
;　線を表示したらCALL COLUMN_RIGHT_PRINTLで改行する必要あり
;-------------------------------------------------
@SHOP_LIFE_EVENTBUY_SHOW11
;タイトル表示
CALL COLUMN_RIGHT_TITLE("対象者選択", "0", "1", "1", "0")
CALL COLUMN_RIGHT_PRINTL
CALL COLUMN_RIGHT_LINE
CALL COLUMN_RIGHT_PRINTL
;標準的なキャラリストとページ移動
CALL COLUMN_RIGHT_CHARALIST
RETURN 0

;-------------------------------------------------
;「会いに行く」の右カラムボタンの入力処理補佐
;　入力値0～9を想定している
;　RETURN 0:CLEARLINE LINECOUNT - LINES_SHOPする
;　RETURN 1:CLEARLINE LINECOUNT - LINES_SHOPしない
;-------------------------------------------------
;@SHOP_LIFE_EVENTBUY_SUB11(ARG:0)

;-------------------------------------------------
;「会いに行く」のリスト１入力処理
;　ARG:0=NO_TO_CHARA(入力値-100)
;-------------------------------------------------
@SHOP_LIFE_USERSHOP11(ARG:0)

;SHOW_INFOの初期画面を基本情報にする
FLAG:能力表示モード = 0

$SHOW_LOOP_INFO_A

;対象キャラの情報を表示
DRAWLINE
CALL SHOW_INFO(ARG:0)
DRAWLINE

;捕虜の場合
IF CFLAG:(ARG:0):捕虜先
	PRINTFORML %ANAME(ARG:0)%をどうしますか？
	PRINTPLAIN  
	PRINTBUTTON " 0[会いに行く]", 0
	PRINTPLAIN  
	PRINTBUTTON " 1[投獄する]", 1
	PRINTPLAIN  
	;クリア後ではない
	IF !FLAG:クリアフラグ
		PRINTBUTTON " 2[解放する]", 2
	ELSE
		SETCOLOR COLOR("選択不可")
		PRINTPLAIN  2[解放する]
		RESETCOLOR
	ENDIF
	PRINTL 
	PRINTPLAIN  
	PRINTBUTTON " 9[キャンセル]", 9
	PRINTL 

	REDRAW 0

	$INPUT_LOOP_PRISONER
	INPUT

	IF RESULT == 0
		;調教初期設定
		CALL TRAIN_TARGET_SETTING(ARG:0)
		;初期のウフフフラグはＯＦＦにする
		FLAG:ウフフフラグ = 0
		;会いに行くモード
		FLAG:調教モード = 0
		;行動開始時の共通処理
		CALL START_TRAIN_COMMON
		REDRAW 1
		RETURN 1
	ELSEIF RESULT == 1
		PRINTFORMW %ANAME(ARG:0)%を投獄しました
		CFLAG:(ARG:0):監禁状態 = 0
		REDRAW 1
		RETURN 1
	ELSEIF RESULT == 2 && !FLAG:クリアフラグ
		PRINTFORML 本当に%ANAME(ARG:0)%を解放しますか？
		CALL ASK_YN
		IF RESULT == 0
			CALL KOJO_EVENT(ARG:0, 340)
			PRINTFORMW %ANAME(ARG:0)%を解放しました
			CALL CAPTURE(ARG:0, 0, TALENT:(ARG:0):崩壊)
			REDRAW 1
			RETURN 1
		ENDIF
		REDRAW 1
		GOTO SHOW_LOOP_INFO_A
	ELSEIF RESULT != 9
		CLEARLINE 1
		GOTO INPUT_LOOP_PRISONER
	ENDIF
	REDRAW 1
ELSE
	IF CFLAG:(ARG:0):行動不能状態 == 1
		PRINTFORML %ANAME(ARG:0)%は出産を控え行動が制限されています
		PRINTFORML %ANAME(ARG:0)%に会いに行きますか？
	ELSEIF CFLAG:(ARG:0):行動不能状態 == 2
		PRINTFORML %ANAME(ARG:0)%は育児中につき行動が制限されています
		PRINTFORML %ANAME(ARG:0)%に会いに行きますか？
	ELSEIF CFLAG:(ARG:0):行動不能状態 == 3
		PRINTFORML %ANAME(ARG:0)%は重症につき行動が制限されています
		PRINTFORML %ANAME(ARG:0)%のお見舞いに行きますか？
	ELSEIF CFLAG:(ARG:0):行動不能状態 == 4
		PRINTFORML %ANAME(ARG:0)%はまだ幼いため育児モードで開始します
		PRINTFORML %ANAME(ARG:0)%に会いに行きますか？
	ELSE
		PRINTFORML %ANAME(ARG:0)%に会いに行きますか？
	ENDIF
	IF CFLAG:(ARG:0):行動不能状態 == 4
		LOCALS = %EDUCATION(CFLAG:ARG:教育方針)%
		PRINTL [0] 普通に会う [1] 集中教育を実行 [2] やっぱりやめる
		PRINTFORM 　現在の教育方針 -  
		PRINTBUTTON "["+LOCALS+"]",10
		INPUT
		IF RESULT == 1 && CFLAG:ARG:教育方針 >= 10 && CFLAG:ARG:教育方針 <= 15
			CFLAG:ARG:行動済み = 1
			SHOP_TIME ++
			CALL 教育(ARG, MASTER, CFLAG:ARG:教育方針)
			LINES_SHOP = LINECOUNT
			BEGIN TURNEND
		ELSEIF  RESULT == 2
		;処理なしで戻れる？
		ELSEIF RESULT == 10
			IF CFLAG:ARG:教育方針 < 10 || CFLAG:ARG:教育方針 >= 15
				CFLAG:ARG:教育方針 = 10
			ELSE
				CFLAG:ARG:教育方針 ++
			ENDIF
			GOTO SHOW_LOOP_INFO_A
		ELSE
			GOTO NORMAL_MEET
		ENDIF
	ELSEIF TALENT:(ARG:0):幼児
		LOCALS = %EDUCATION(CFLAG:ARG:教育方針)%
		PRINTL [0] 普通に会う [1] やっぱりやめる
		PRINTL
		INPUT
		IF  RESULT == 1
		ELSE
			GOTO NORMAL_MEET
		ENDIF
	ELSE
		CALL ASK_YN
		IF RESULT == 0
			$NORMAL_MEET
			;調教初期設定
			CALL TRAIN_TARGET_SETTING(ARG:0)
			;初期のウフフフラグはＯＦＦにする
			FLAG:ウフフフラグ = 0
			;相手が子供なら子育てモード
			IF CFLAG:(ARG:0):行動不能状態 == 4
				FLAG:調教モード = 3
			;それ以外は通常の会いに行くモード
			ELSE
				FLAG:調教モード = 0
			ENDIF
			;行動開始時の共通処理
			CALL START_TRAIN_COMMON
		ENDIF
	ENDIF
ENDIF
RETURN 1

;-------------------------------------------------
;「会いに行く」のリスト２入力処理
;　ARG:0=NO_TO_CHARA(入力値-1100)
;-------------------------------------------------
;@SHOP_LIFE_USERSHOP_SUB11(ARG:0)

