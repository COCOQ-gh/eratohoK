@SHOP_FAVORITE(ARG:0)
#DIM FIRST_LINE
#DIM 元の能力, 5
#DIM 選択項目,1
#DIM 選択詳細,1
#DIM 変化量,1
#DIM ポイント, 1
#DIM 振り分け後, 5
#DIM LOOPCOUNT, 1
#DIM LOOPMAX, 1
VARSET ポイント
VARSET 振り分け後
元の能力:0 = ABL:(ARG:0):武闘
元の能力:1 = ABL:(ARG:0):知略
元の能力:2 = ABL:(ARG:0):政治
元の能力:3 = ABL:(ARG:0):歌唱
元の能力:4 = ABL:(ARG:0):料理
FOR LOOPCOUNT, 0, 5
	ポイント += 元の能力:LOOPCOUNT
NEXT
FIRST_LINE = LINECOUNT
REDRAW 0
$SHOW_LOOP
DRAWLINE
PRINTFORML %ANAME(ARG:0)%を推しメンにし、元の能力値の範囲内で、能力値を振り直すことができます
PRINTFORML 設定出来る最大値は110、ただし元々90に届いていない能力を90以上にはできません
PRINTFORML また、元の能力値より大きくする場合には、ポイントを2消費します
PRINTFORML 推しメン設定は一度しかできません。よく考えましょう
PRINTFORML どうしますか？
PRINTFORML 残りポイント:{ポイント}
DRAWLINE
PRINTFORM 武闘:{振り分け後:0, 3} 元:{元の能力:0, 3} -- 
IF FAVORITE_CAN_CHOOSE(振り分け後:0, ポイント, 1, 元の能力:0)
	PRINTBUTTON "[ +1]", 200
ELSE
	SETCOLOR COLOR("選択不可")
	PRINTPLAIN [ +1]
	RESETCOLOR
ENDIF
IF FAVORITE_CAN_CHOOSE(振り分け後:0, ポイント, -1, 元の能力:0)
	PRINTBUTTON "[ -1]", 201
ELSE
	SETCOLOR COLOR("選択不可")
	PRINTPLAIN [ -1]
	RESETCOLOR
ENDIF
IF FAVORITE_CAN_CHOOSE(振り分け後:0, ポイント, 10, 元の能力:0)
	PRINTBUTTON "[ +10]", 202
ELSE
	SETCOLOR COLOR("選択不可")
	PRINTPLAIN [ +10]
	RESETCOLOR
ENDIF
IF FAVORITE_CAN_CHOOSE(振り分け後:0, ポイント, -10, 元の能力:0)
	PRINTBUTTON "[ -10]", 203
ELSE
	SETCOLOR COLOR("選択不可")
	PRINTPLAIN [ -10]
	RESETCOLOR
ENDIF
PRINTL

PRINTFORM 知略:{振り分け後:1, 3} 元:{元の能力:1, 3} -- 
IF FAVORITE_CAN_CHOOSE(振り分け後:1, ポイント, 1, 元の能力:1)
	PRINTBUTTON "[ +1]", 210
ELSE
	SETCOLOR COLOR("選択不可")
	PRINTPLAIN [ +1]
	RESETCOLOR
ENDIF
IF FAVORITE_CAN_CHOOSE(振り分け後:1, ポイント, -1, 元の能力:1)
	PRINTBUTTON "[ -1]", 211
ELSE
	SETCOLOR COLOR("選択不可")
	PRINTPLAIN [ -1]
	RESETCOLOR
ENDIF
IF FAVORITE_CAN_CHOOSE(振り分け後:1, ポイント, 10, 元の能力:1)
	PRINTBUTTON "[ +10]", 212
ELSE
	SETCOLOR COLOR("選択不可")
	PRINTPLAIN [ +10]
	RESETCOLOR
ENDIF
IF FAVORITE_CAN_CHOOSE(振り分け後:1, ポイント, -10, 元の能力:1)
	PRINTBUTTON "[ -10]", 213
ELSE
	SETCOLOR COLOR("選択不可")
	PRINTPLAIN [ -10]
	RESETCOLOR
ENDIF
PRINTL

PRINTFORM 政治:{振り分け後:2, 3} 元:{元の能力:2, 3} -- 
IF FAVORITE_CAN_CHOOSE(振り分け後:2, ポイント, 1, 元の能力:2)
	PRINTBUTTON "[ +1]", 220
ELSE
	SETCOLOR COLOR("選択不可")
	PRINTPLAIN [ +1]
	RESETCOLOR
ENDIF
IF FAVORITE_CAN_CHOOSE(振り分け後:2, ポイント, -1, 元の能力:2)
	PRINTBUTTON "[ -1]", 221
ELSE
	SETCOLOR COLOR("選択不可")
	PRINTPLAIN [ -1]
	RESETCOLOR
ENDIF
IF FAVORITE_CAN_CHOOSE(振り分け後:2, ポイント, 10, 元の能力:2)
	PRINTBUTTON "[ +10]", 222
ELSE
	SETCOLOR COLOR("選択不可")
	PRINTPLAIN [ +10]
	RESETCOLOR
ENDIF
IF FAVORITE_CAN_CHOOSE(振り分け後:2, ポイント, -10, 元の能力:2)
	PRINTBUTTON "[ -10]", 223
ELSE
	SETCOLOR COLOR("選択不可")
	PRINTPLAIN [ -10]
	RESETCOLOR
ENDIF
PRINTL

PRINTFORM 歌唱:{振り分け後:3, 3} 元:{元の能力:3, 3} -- 
IF FAVORITE_CAN_CHOOSE(振り分け後:3, ポイント, 1, 元の能力:3)
	PRINTBUTTON "[ +1]", 230
ELSE
	SETCOLOR COLOR("選択不可")
	PRINTPLAIN [ +1]
	RESETCOLOR
ENDIF
IF FAVORITE_CAN_CHOOSE(振り分け後:3, ポイント, -1, 元の能力:3)
	PRINTBUTTON "[ -1]", 231
ELSE
	SETCOLOR COLOR("選択不可")
	PRINTPLAIN [ -1]
	RESETCOLOR
ENDIF
IF FAVORITE_CAN_CHOOSE(振り分け後:3, ポイント, 10, 元の能力:3)
	PRINTBUTTON "[ +10]", 232
ELSE
	SETCOLOR COLOR("選択不可")
	PRINTPLAIN [ +10]
	RESETCOLOR
ENDIF
IF FAVORITE_CAN_CHOOSE(振り分け後:3, ポイント, -10, 元の能力:3)
	PRINTBUTTON "[ -10]", 233
ELSE
	SETCOLOR COLOR("選択不可")
	PRINTPLAIN [ -10]
	RESETCOLOR
ENDIF
PRINTL

PRINTFORM 料理:{振り分け後:4, 3} 元:{元の能力:4, 3} -- 
IF FAVORITE_CAN_CHOOSE(振り分け後:4, ポイント, 1, 元の能力:4)
	PRINTBUTTON "[ +1]", 240
ELSE
	SETCOLOR COLOR("選択不可")
	PRINTPLAIN [ +1]
	RESETCOLOR
ENDIF
IF FAVORITE_CAN_CHOOSE(振り分け後:4, ポイント, -1, 元の能力:4)
	PRINTBUTTON "[ -1]", 241
ELSE
	SETCOLOR COLOR("選択不可")
	PRINTPLAIN [ -1]
	RESETCOLOR
ENDIF
IF FAVORITE_CAN_CHOOSE(振り分け後:4, ポイント, 10, 元の能力:4)
	PRINTBUTTON "[ +10]", 242
ELSE
	SETCOLOR COLOR("選択不可")
	PRINTPLAIN [ +10]
	RESETCOLOR
ENDIF
IF FAVORITE_CAN_CHOOSE(振り分け後:4, ポイント, -10, 元の能力:4)
	PRINTBUTTON "[ -10]", 243
ELSE
	SETCOLOR COLOR("選択不可")
	PRINTPLAIN [ -10]
	RESETCOLOR
ENDIF
PRINTL
DRAWLINE
PRINTFORML [0] 決定
DRAWLINE
PRINTFORML [999] 戻る
$INPUT_LOOP_1
INPUT
IF RESULT == 999
	REDRAW 1
	RETURN 0
ELSEIF RESULT == 0
	REDRAW 1
	PRINTFORML 以上で推しメン設定を終えますか？
	SIF ポイント
		PRINTFORML ポイントが残ってますよ？　残してても何もいいことないですよ？
	$INPUT_LOOP_2
	CALL ASK_YN
	IF RESULT == 0
		ABL:(ARG:0):武闘 = 振り分け後:0
		ABL:(ARG:0):知略 = 振り分け後:1
		ABL:(ARG:0):政治 = 振り分け後:2
		ABL:(ARG:0):歌唱 = 振り分け後:3
		ABL:(ARG:0):料理 = 振り分け後:4
		PRINTFORMW %ANAME(ARG:0)%を推しメンにしました！
		FLAG:7 = 1000
		FLAG:100 = 1
		RETURN 0
	ELSEIF RESULT == 1
		CLEARLINE LINECOUNT - FIRST_LINE
		GOTO SHOW_LOOP
	ELSE
		CLEARLINE 3
		GOTO INPUT_LOOP_2
	ENDIF
ELSEIF 200 <= RESULT && RESULT < 300
	選択項目 = (RESULT - 200) / 10
	選択詳細 = RESULT % 10
	IF 選択項目 >= 0 && 選択項目 <= 5
	SELECTCASE 選択詳細
			CASE 0
				IF FAVORITE_CAN_CHOOSE(振り分け後:選択項目, ポイント, 1, 元の能力:選択項目)
					変化量 = 1
				ELSE
					CLEARLINE 1
					GOTO INPUT_LOOP_1
				ENDIF
			CASE 1
				IF FAVORITE_CAN_CHOOSE(振り分け後:選択項目, ポイント, -1, 元の能力:選択項目)
					変化量 = -1
				ELSE
					CLEARLINE 1
					GOTO INPUT_LOOP_1
				ENDIF
			CASE 2
				IF FAVORITE_CAN_CHOOSE(振り分け後:選択項目, ポイント, 10, 元の能力:選択項目)
					変化量 = 10
				ELSE
					CLEARLINE 1
					GOTO INPUT_LOOP_1
				ENDIF
			CASE 3
				IF FAVORITE_CAN_CHOOSE(振り分け後:選択項目, ポイント, -10, 元の能力:選択項目)
					変化量 = -10
				ELSE
					CLEARLINE 1
					GOTO INPUT_LOOP_1
				ENDIF
			CASEELSE
				CLEARLINE 1
				GOTO INPUT_LOOP_1
		ENDSELECT
		LOOPMAX = ABS(変化量)
		FOR LOOPCOUNT, 0, LOOPMAX
			IF 変化量 > 0
				振り分け後:選択項目 ++
				IF 振り分け後:選択項目 > 元の能力:選択項目
					ポイント -= 2
				ELSE
					ポイント -= 1
				ENDIF
			ELSE
				IF 振り分け後:選択項目 > 元の能力:選択項目
					ポイント += 2
				ELSE
					ポイント += 1
				ENDIF
				振り分け後:選択項目 --
			ENDIF
		NEXT
		CLEARLINE LINECOUNT - FIRST_LINE
		GOTO SHOW_LOOP
	ENDIF
ELSE
	CLEARLINE 1
	GOTO INPUT_LOOP_1
ENDIF

;0 現在値
;1 ポイント
;2 ボタンの加算値
;3 元の能力
@FAVORITE_CAN_CHOOSE(ARG:0, ARG:1, ARG:2, ARG:3)
#FUNCTION
#DIM LOOPCOUNT, 1
#DIM LOOPMAX, 1
LOOPMAX = ABS(ARG:2)
FOR LOOPCOUNT, 0, LOOPMAX
	;加算ならポイントを減算
	IF ARG:2 > 0
		IF ARG:0 >= ARG:3
			ARG:1 -= 2
		ELSE
			ARG:1 -= 1
		ENDIF
		ARG:0 ++
	ELSE
		ARG:0 --
	ENDIF
	;加算/減算結果として
	IF ARG:0 < 0
		RETURNF 0
	ELSEIF ARG:0 > 110 && ARG:2 > 0
		RETURNF 0
	ELSEIF ARG:3 < 90 && ARG:0 >= 90 && ARG:2 > 0
		RETURNF 0
	ELSEIF ARG:1 < 0
		RETURNF 0
	ENDIF
NEXT
RETURNF 1