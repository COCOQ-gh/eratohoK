;-------------------------------------------------
;CHECK_SELECTABLE{n}関数の呼び出し関数
;ARG:0 呼び出し番号
;ARG:1 キャラ番号
;
;返り値の意味は以下
;0:通常の選択不可（リストに載らない）
;1:選択可能
;2:灰色でリストに載るが選択不可能
;-------------------------------------------------
@CHECK_SELECTABLE(ARG:0, ARG:1)
RESULT = 0
TRYCALLFORM CHECK_SELECTABLE%TOSTR(ARG:0)%(ARG:1)
RETURN RESULT

;-------------------------------------------------
;[会いに行く]の選択可否判定
;※使用前に TMP_CREATE_RELATION_MAP 関数を呼び出しておくこと！
;-------------------------------------------------
@CHECK_SELECTABLE1000(ARG:0)
LOCAL:0 = TMP_COUNTRY_RELATION:(CFLAG:MASTER:所属):(CFLAG:(ARG:0):所属)
;捕虜として捕まっている場合
IF CFLAG:(ARG:0):捕虜先
	;非主人公、主人公勢力の捕虜かつ軟禁中
	RETURN CHECK91(ARG:0, 2, ARG:0 != MASTER && CFLAG:(ARG:0):捕虜先 == CFLAG:MASTER:所属 && CFLAG:(ARG:0):監禁状態 == 1 && !IS_ANIMAL(ARG:0))
ENDIF
;捕虜でない、非主人公、同一勢力or共闘勢力
RETURN CHECK91(ARG:0, 2, ARG:0 != MASTER && LOCAL:0 >= 2 && !IS_ANIMAL(ARG:0))

;-------------------------------------------------
;[閨に呼ぶ]の選択可否判定
;-------------------------------------------------
@CHECK_SELECTABLE1001(ARG:0)
	;捕虜として捕まっている場合
	IF CFLAG:(ARG:0):捕虜先
		;非主人公、通常状態または育児中、合意、主人公勢力の捕虜かつ軟禁中
		RETURN CHECK91(ARG:0, 2, ARG:0 != MASTER && GROUPMATCH(CFLAG:(ARG:0):行動不能状態, 0, 2) && (TALENT:(ARG:0):合意 || TALENT:(ARG:0):親友) && CFLAG:(ARG:0):捕虜先 == CFLAG:MASTER:所属 && CFLAG:(ARG:0):監禁状態 == 1)
	ENDIF
	;捕虜でない、非主人公、通常状態または育児中、合意か親友ないし所属が特殊勢力なら対応する特殊勢力陥落素質持ち、同一勢力
	RETURN CHECK91(ARG:0, 2, ARG:0 != MASTER && GROUPMATCH(CFLAG:(ARG:0):行動不能状態, 0, 2) && (TALENT:(ARG:0):合意 || TALENT:(ARG:0):親友 || (IS_SP_COUNTRY(CFLAG:(ARG:0):所属) && GETBIT(TALENT:(ARG:0):特殊勢力陥落系, SP_COUNTRY_TO_CONST(CFLAG:(ARG:0):所属)))) && CFLAG:(ARG:0):所属 == CFLAG:MASTER:所属)
RETURN 0

;-------------------------------------------------
;[夜這い]の選択可否判定
;-------------------------------------------------
@CHECK_SELECTABLE1002(ARG:0)
	;非主人公、捕虜ではない、別勢力、君主ではない、どこかの勢力に所属している（放浪、未登場、死亡済みではない）
	IF (ARG:0 != MASTER && !CFLAG:(ARG:0):捕虜先 && CFLAG:MASTER:所属 != CFLAG:(ARG:0):所属 && GET_ID(ARG:0) != COUNTRY_BOSS:(CFLAG:(ARG:0):所属) && CFLAG:(ARG:0):所属)
		SIF YOBAI_ABLE(ARG:0)
			RETURN CHECK91(ARG:0, 2, 1)
		RETURN 2
	ENDIF
	RETURN 0
RETURN 0

;-------------------------------------------------
;[手引きさせる]の選択可否判定
;-------------------------------------------------
@CHECK_SELECTABLE1003(ARG:0)
IF TMP_COUNTRY_IS_NEIBORING:(CFLAG:MASTER:所属):(CFLAG:(ARG:0):所属)
	;非主人公、捕虜ではない、別勢力、君主ではない、どこかの勢力に所属している（放浪、未登場、死亡済みではない）
	IF (ARG:0 != MASTER && !CFLAG:(ARG:0):捕虜先 && CFLAG:MASTER:所属 != CFLAG:(ARG:0):所属 && GET_ID(ARG:0) != COUNTRY_BOSS:(CFLAG:(ARG:0):所属) && CFLAG:(ARG:0):所属 )
		SIF TEBIKI_ABLE(ARG:0)
			RETURN CHECK91(ARG:0, 2, 1)
		RETURN 2
	ENDIF
	RETURN 0
ENDIF
RETURN 0

;-------------------------------------------------
;[手引きさせる]の内通者の選択可否判定
;-------------------------------------------------
@CHECK_SELECTABLE_NAITSU(ARG:0)
	;捕虜でない、非主人公、通常状態または育児中、烙印、別勢力
	SIF TMP_COUNTRY_IS_NEIBORING:(CFLAG:MASTER:所属):(CFLAG:(ARG:0):所属)
		RETURN CHECK91(ARG:0, 2, ARG:0 != MASTER && !CFLAG:(ARG:0):捕虜先 && GROUPMATCH(CFLAG:(ARG:0):行動不能状態, 0, 2) && TALENT:(ARG:0):烙印) && CFLAG:MASTER:所属 != CFLAG:(ARG:0):所属
RETURN 0


;-------------------------------------------------
;[慰安]でヤられる側の選択可否判定
;-------------------------------------------------
@CHECK_SELECTABLE1004(ARG:0)
	;閨に呼べる、または主人公
	IF ARG:0 == MASTER
		SIF COOLTIME:MASTER:0 < 2
			RETURN CHECK91(ARG:0, 2, 1)
	ELSE
		CALL CHECK_SELECTABLE1001(ARG:0)
		RETURN CHECK91(ARG:0, 2, RESULT)
	ENDIF
RETURN 0

;-------------------------------------------------
;[あてがう]でヤられる側の選択可否判定
;-------------------------------------------------
@CHECK_SELECTABLE1005(ARG:0)
;閨に呼べること　ただし主人公はダメ
SIF ARG:0 == MASTER
	RETURN 0
SIF CFLAG:(ARG:0):慰安モブ
	RETURN 0
CALL CHECK_SELECTABLE1001(ARG:0)
RETURN CHECK91(ARG:0, 2, RESULT)

;-------------------------------------------------
;[あてがう]であてがう先になる可否判定
;無限ループ回避のため性知識が必要
;-------------------------------------------------
@CHECK_SELECTABLE_ATEGAU(ARG:0)
SIF CFLAG:(ARG:0):閨に呼ぶで選択中
	RETURN 0
LOCAL:0 = TMP_COUNTRY_RELATION:(CFLAG:MASTER:所属):(CFLAG:(ARG:0):所属)
;捕虜でない、非主人公、同一勢力or共闘勢力、性知識1以上
RETURN CHECK91(ARG:0, 2, ARG:0 != MASTER && LOCAL:0 >= 2 && ABL:(ARG:0):性知識 > 0
RETURN 0


;-------------------------------------------------
;[捕虜の調教]の選択可否判定
;-------------------------------------------------
@CHECK_SELECTABLE1010(ARG:0)
	;非主人公、主人公勢力の捕虜、牢獄で監禁中
	RETURN CHECK91(ARG:0, 2, (ARG:0 != MASTER && CFLAG:(ARG:0):捕虜先 == CFLAG:MASTER:所属 && CFLAG:(ARG:0):監禁状態 == 0) || CFLAG:(ARG:0):外交調教経過ターン)
RETURN 0


;-------------------------------------------------
;[捕虜の調教]の助手の選択可否判定
;-------------------------------------------------
@CHECK_SELECTABLE_ASSI(ARG:0)
;[閨に呼ぶ]の選択条件を満たしている

	CALL CHECK_SELECTABLE1001(ARG:0)
	RETURN CHECK91(ARG:0, 2, RESULT)

RETURN 0

;-------------------------------------------------
;[投獄する]の選択可否判定
;-------------------------------------------------
@CHECK_SELECTABLE1011(ARG:0)
;主人公より政治が低い、君主でない、捕虜でない、動物でない、育児されている子供でない、特殊キャラでない
{
RETURN CFLAG:(ARG:0):所属 == CFLAG:MASTER:所属 && ABL:(ARG:0):政治 < ABL:(MASTER):政治 && CFLAG:ARG:捕虜先 == 0 && ARG:0 != GET_COUNTRY_BOSS(CFLAG:MASTER:所属) && !IS_ANIMAL(ARG:0) &&
 CFLAG:(ARG:0):行動不能状態 != 4 && !IS_SP_CHARA(ARG:0)
}
;-------------------------------------------------
;[説得させる]の選択可否判定
;-------------------------------------------------
;説得を受ける側
@CHECK_SELECTABLE1012(ARG:0)
;非主人公、主人公勢力に所属していない、主人公勢力の捕虜、牢獄で軟禁中
RETURN ARG:0 != MASTER && CFLAG:(ARG:0):所属 != CFLAG:MASTER:所属 && CFLAG:(ARG:0):捕虜先 == CFLAG:MASTER:所属 && CFLAG:(ARG:0):監禁状態 == 1

;説得する側
@CHECK_SELECTABLE_SETTOKU(ARG:0)
;捕虜でない、非主人公、通常状態または育児中、同一勢力
RETURN CFLAG:(ARG:0):捕虜先 == 0 && ARG:0 != MASTER && GROUPMATCH(CFLAG:(ARG:0):行動不能状態, 0, 2) && CFLAG:(ARG:0):所属 == CFLAG:MASTER:所属


;-------------------------------------------------
;[捕虜の扱い]の選択可否判定
;-------------------------------------------------
@CHECK_SELECTABLE1013(ARG:0)
	;非主人公、主人公勢力の捕虜、牢獄で監禁中
	RETURN ARG:0, 2, (ARG:0 != MASTER && CFLAG:(ARG:0):捕虜先 == CFLAG:MASTER:所属 && CFLAG:(ARG:0):監禁状態 == 0) || CFLAG:(ARG:0):外交調教経過ターン
RETURN 0

;-------------------------------------------------
;[労働]の選択可否判定
;-------------------------------------------------
@CHECK_SELECTABLE1015(ARG:0)
;捕虜でない、同一勢力、通常状態または育児中
RETURN CHECK91(ARG:0, 2, CFLAG:(ARG:0):所属 == CFLAG:MASTER:所属 && !CFLAG:(ARG:0):捕虜先 && !IS_ANIMAL(ARG:0) && GROUPMATCH(CFLAG:(ARG:0):行動不能状態, 0, 2))


;-------------------------------------------------
;[地方へ派遣]の選択可否判定
;-------------------------------------------------
@CHECK_SELECTABLE1017(ARG:0)
;非主人公、同一勢力、汎用キャラ、君主でない、捕虜でない、部隊に所属していない、借り物でない、好感度300必要
{
RETURN ARG:0 != MASTER && CFLAG:(ARG:0):所属 == CFLAG:MASTER:所属 && (IS_CHILD(ARG:0) || IS_RANDOM_CHARA(ARG:0)) && GET_COUNTRY_BOSS(CFLAG:(ARG:0):所属) != ARG:0 &&
CFLAG:(ARG:0):捕虜先 == 0 && TMP_IS_FREE:(ARG:0):0 == 0 && CFLAG:(ARG:0):2 >= 300 && !GETBIT(TALENT:(ARG:0):デイリー系, 素質_デイリー_借り物) && !IS_ANIMAL(ARG:0)
}
;-------------------------------------------------
;[デート]に誘うキャラの選択可否判定
;-------------------------------------------------
@CHECK_SELECTABLE1019(ARG:0)
;同一勢力、捕虜でない、動物でない、通常状態または育児中
RETURN (ARG:0) != MASTER && CFLAG:(ARG:0):所属 == CFLAG:MASTER:所属 && CFLAG:(ARG:0):捕虜先 == 0 && !IS_ANIMAL(ARG:0) && GROUPMATCH(CFLAG:(ARG:0):行動不能状態, 0, 2)

;-------------------------------------------------
;諸国訪問で行ける先
;-------------------------------------------------
@CHECK_SELECTABLE1020(ARG:0)
;どこかの勢力のえらいひと(自勢力以外)
RETURN GET_COUNTRY_BOSS(CFLAG:(ARG:0):所属) == ARG:0 && CFLAG:(ARG:0):所属 != CFLAG:MASTER:所属

;-------------------------------------------------
;[婚姻の儀]の選択可否判定
;-------------------------------------------------
@CHECK_SELECTABLE1025(ARG:0)
;非主人公、同一勢力、捕虜でない、好感度3000以上、[恋人]or[烙印]、特殊状態が立っていない
RETURN ARG:0 != MASTER && CFLAG:(ARG:0):所属 == CFLAG:MASTER:所属 && CFLAG:(ARG:0):捕虜先 == 0 && CFLAG:(ARG:0):2 >= 3000 && (TALENT:(ARG:0):恋人 || TALENT:(ARG:0):烙印) && CFLAG:(ARG:0):特殊状態 == 0 && !IS_ANIMAL(ARG:0)

;-------------------------------------------------
;[服を替える]の選択可否判定
;-------------------------------------------------
@CHECK_SELECTABLE1025(ARG:0)
;非主人公(主人公は別処理)、同一勢力or自国の捕虜
RETURN ARG:0 != MASTER && (CFLAG:(ARG:0):所属 == CFLAG:MASTER:所属 || CFLAG:(ARG:0):捕虜先 == CFLAG:MASTER:所属) && !IS_ANIMAL(ARG:0)

;-------------------------------------------------
;[料理長]の選択可否判定
;-------------------------------------------------
@CHECK_SELECTABLE1026(ARG:0)
;非主人公、捕虜でない、イベキャラでない、育児されている子供でない
RETURN ARG:0 != MASTER && CFLAG:(ARG:0):所属 == CFLAG:MASTER:所属 && CFLAG:(ARG:0):捕虜先 == 0 && !IS_SP_CHARA(ARG:0) && CFLAG:(ARG:0):行動不能状態 != 4

;-------------------------------------------------
;[推しメン]の選択可否判定
;-------------------------------------------------
@CHECK_SELECTABLE1029(ARG:0)
;非主人公、捕虜でない
RETURN ARG:0 != MASTER && CFLAG:(ARG:0):所属 == CFLAG:MASTER:所属 && CFLAG:(ARG:0):捕虜先 == 0 && !IS_ANIMAL(ARG:0)


;-------------------------------------------------
;[能力表示]の選択可否判定
;-------------------------------------------------
@CHECK_SELECTABLE1021(ARG:0)
;非主人公(主人公は別処理)、外来勢力の士官or外来勢力の捕虜、イベントキャラでない
RETURN ARG:0 != MASTER && (CFLAG:(ARG:0):所属 == CFLAG:MASTER:捕虜先 || CFLAG:(ARG:0):捕虜先 == CFLAG:MASTER:捕虜先) && !IS_SP_CHARA(ARG:0)

;-------------------------------------------------
;[能力表示]の選択可否判定
;-------------------------------------------------
@CHECK_SELECTABLE1040(ARG:0)
;同一勢力or共闘勢力or自国の捕虜
;最後に&& CFLAG:(ARG:0):捕虜先としてるのは、マスターが未所属捕虜で能力表示を開いた場合、「どこの勢力の捕虜にもなっていない」キャラが引っかかるから
SIF ARG:0 == MASTER
	RETURN 1
SELECTCASE FLAG:能力表示フィルタ
	;従来
	CASE 0
		RETURN TMP_COUNTRY_RELATION:(CFLAG:MASTER:所属):(CFLAG:(ARG:0):所属) >= 2 || (CFLAG:(ARG:0):捕虜先 == CFLAG:MASTER:所属 && CFLAG:(ARG:0):捕虜先)
	;自国のみ
	CASE 1
		RETURN (CFLAG:MASTER:所属 && CFLAG:MASTER:所属 == CFLAG:ARG:所属)
	;捕虜も
	CASE 2
		RETURN CFLAG:MASTER:所属 && (CFLAG:MASTER:所属 == CFLAG:ARG:所属 || CFLAG:MASTER:所属 == CFLAG:ARG:捕虜先)
	;ぜんぶ
	CASE 3
		RETURN 1
ENDSELECT
RETURN 1
;-------------------------------------------------
;[関係一覧]の選択可否判定
;-------------------------------------------------
@CHECK_SELECTABLE1041(ARG:0)
;非主人公(主人公は別処理)、同一勢力or共闘勢力or自国の捕虜
CALL CHECK_SELECTABLE1040(ARG:0)
RETURN RESULT

;-------------------------------------------------
;[スキル習得]の選択可否判定
;-------------------------------------------------
@CHECK_SELECTABLE1051(ARG:0)
;捕虜でない、同一勢力、通常状態または育児中
RETURN CHECK91(ARG:0, 2, CFLAG:(ARG:0):所属 == CFLAG:MASTER:所属 && !CFLAG:(ARG:0):捕虜先 && !IS_ANIMAL(ARG:0) && GROUPMATCH(CFLAG:(ARG:0):行動不能状態 && COOLTIME:(ARG:0):0 == 0, 0, 2))

;-------------------------------------------------
;行動済みチェック
;ARG:0　対象キャラ
;ARG:1　ARG:2が真だった時に返す値
;ARG:2　行動済み以外の条件式
;-------------------------------------------------
@CHECK91(ARG:0, ARG:1, ARG:2)
#FUNCTION
SIF ARG:2 <= 0
	RETURNF ARG:2
IF !CFLAG:(ARG:0):行動済み
	RETURNF ARG:2
ELSE
	IF CONFIG:13 == 1
		RETURNF 0
	ELSEIF ARG:2 == 1
		RETURNF ARG:1
	ELSE
		RETURNF ARG:2
	ENDIF
ENDIF

