;-------------------------------------------------
;ゴブリンによる調教
;-------------------------------------------------
@TRAIN_BY_GOBLIN
#DIM ゴブリン
#DIM 対象

ゴブリン = GET_COUNTRY_FROM_ID(SP_COUNTRY_ID:(特殊勢力_ホフゴブリン))
LOCAL:1 = 0

SIF ゴブリン == -1 || CONFIG:200
	RETURN -1

FOR 対象, 0, CHARANUM
	SIF !IS_TRAIN_BY_SP_COUNTRY(対象, ゴブリン)
		CONTINUE
	IF !LOCAL:1
		LOCAL:1 = 1
		DRAWLINE
		PRINTFORMW ホフゴブリンに捕らえられた士官が陵辱されているようです…
		PRINTFORML 
	ENDIF
	
	CALL GOBLINS_TRAIN_MSG(対象)
	CFLAG:対象:調教カウンタ++

	;あまり長く捕らえられていると寝返る
	IF IS_BETRAY_TO_SP_COUNTRY(対象, ゴブリン)
		PRINTL
		SETCOLOR COLOR("警告")
		IF !GETBIT(TALENT:対象:特殊勢力陥落系, 特殊勢力_ホフゴブリン)
			PRINTFORMW ホフゴブリンたちの容赦ない陵辱で%ANAME(対象)%の心は折れ、彼らのための肉便器へとなりはててしまった
			PRINTFORMW もっと彼らに犯して「いただく」ため、一生を便器として過ごすことに同意してしまった……
			IF TALENT:対象:烙印
				PRINTFORML %ANAME(対象)%が%ANAME(MASTER)%専用であることを示す烙印の上から、
				PRINTFORMW 新たに%ANAME(対象)%がホフゴブリン専属の肉便器となったことを示す焼き印が施された
				TALENT:対象:烙印 = 0
			ELSE
				PRINTFORMW %ANAME(対象)%の体に、ホフゴブリン専属の肉便器となったことを示す焼き印が施された
			ENDIF
			SIF IS_LOVER(対象)
				PRINTFORMW %ANAME(対象)%の頭の中から、かつて愛していた%ANAME(MASTER)%のことが、綺麗さっぱり消え失せた……
		ELSE
			PRINTFORMW ホフゴブリンたちの容赦ない陵辱で、%ANAME(対象)%は便器として扱われることの悦びを思い出した
			PRINTFORMW 彼らの肉便器としての「仕事」をこなすため、%ANAME(対象)%は再び彼らの下につくことにした……
		ENDIF
		RESETCOLOR
		
		CALL KOJO_SPECIAL_FALLEN_EVENT(対象, SP_COUNTRY_ID:(特殊勢力_ホフゴブリン))

		CFLAG:対象:所属 = ゴブリン
		CFLAG:対象:捕虜先 = 0
		SETBIT TALENT:対象:特殊勢力陥落系, 特殊勢力_ホフゴブリン
		SIF SP_TRAIN_IS_DECREASE_CFLAG(対象, ゴブリン)
			CALL LOSE_RELATION_TALENT(対象)

		$HUKUJU_LOOP
		SELECTCASE RAND:10
			CASE IS < 5
				CALL SET_PIERCE_RANDOM(対象, 0)
				SIF RESULT != -1
					CALL COLORPRINTFORM(@"%ANAME(対象)%の%GET_PIERCE_NAME(RESULT)%に、服従の証のピアスが取り付けられた……", COLOR("桃"), "W")
			CASE IS < 6
				SIF IS_MALE(対象)
					GOTO HUKUJU_LOOP
				CALL SET_TATOO_RANDOM(対象, STR_FOR_TATOO(-1), 0)
				SIF RESULT != -1
					CALL COLORPRINTFORM(@"%ANAME(対象)%の%GET_TATOO_NAME(RESULT)%に、「%TATOO:対象:RESULT%」とタトゥーが刻まれた……", COLOR("桃"), "W")
			CASEELSE
				IF GET_INMOU(対象) >= 陰毛_標準
				CALL COLORPRINTFORM(@"服従の証として、%ANAME(対象)%の陰毛はハート型に整えられた……", COLOR("桃"), "W")
				TALENT:対象:陰毛目標値 = 陰毛_ハート型
				TALENT:対象:陰毛現在値 = 陰毛_ハート型
			ELSE
				CALL COLORPRINTFORM(@"服従の証として、%ANAME(対象)%の陰毛は永久脱毛された……", COLOR("桃"), "W")
				TALENT:対象:陰毛目標値 = 陰毛_パイパン
				TALENT:対象:陰毛現在値 = 陰毛_パイパン
			ENDIF
		ENDSELECT
	ENDIF
	PRINTL
	WAIT
NEXT
