;-----------------------------------------
;捕虜にされているときの逆調教関数へのハブ
;-----------------------------------------
@SP_TRAIN_IN_PRISON
SELECTCASE CFLAG:MASTER:9
	CASE GET_COUNTRY_FROM_ID(SP_COUNTRY_ID:(特殊勢力_野盗))
		CALL REV_TRAIN_BANDIT
	CASE GET_COUNTRY_FROM_ID(SP_COUNTRY_ID:(特殊勢力_ホフゴブリン))
		CALL REV_TRAIN_GOBLIN
	CASE GET_COUNTRY_FROM_ID(SP_COUNTRY_ID:(特殊勢力_外来人))
		CALL REV_TRAIN_GAIRAI
	CASE GET_COUNTRY_FROM_ID(SP_COUNTRY_ID:(特殊勢力_触手))
		CALL REV_TRAIN_TENTACLE
ENDSELECT
SIF !RESULT
;行動開始時の共通処理
	CALL START_TRAIN_COMMON
RETURN 1


;---------------------------------------
;ターンエンド時の各勢力のイベントのハブ
;---------------------------------------
@SP_TURNEND
;野盗による調教
CALL TRAIN_BY_BANDIT
	
;外来人ターンエンド処理
CALL TURNEND_GAIRAI

;ホフゴブリンターンエンド処理
CALL TURNEND_GOBLIN

;触手ターンエンド処理
CALL TURNEND_TENTACLE



;-------------------------------------------------
;主人公が捕らえられた際の特殊処理
;ARG:0 捕らえた国家
;戻り値 0=処刑 1=部下になる 2=解放される 3=投獄される
;-------------------------------------------------
@SP_MASTER_CAPTURED(ARG:0)
PRINTW ………………
PRINTW ……
RESULT = -1
SELECTCASE ARG:0
	CASE SP_COUNTRY_ID:(特殊勢力_野盗)
		CALL MASTER_CAPTURED_BANDIT(ARG:0)
	CASE SP_COUNTRY_ID:(特殊勢力_外来人)
		CALL MASTER_CAPTURED_GAIRAI(ARG:0)
	CASE SP_COUNTRY_ID:(特殊勢力_ホフゴブリン)
		CALL MASTER_CAPTURED_GOBILIN(ARG:0)
	CASE SP_COUNTRY_ID:(特殊勢力_触手)
		CALL MASTER_CAPTURED_TENTACLE(ARG:0)
ENDSELECT
RETURN RESULT

;---------------------------
;ARG:0番のキャラがEVENT_IDがARG:1である勢力による調教でFORCE_FUCKされたときに、CFLAGが減少するか
;減少「しない」場合、1を返す（@FORCE_FUCKの「CFLAG減少させないフラグ」に対応する）
;---------------------------
@SP_TRAIN_IS_DECREASE_CFLAG(ARG:0, ARG:1)
#FUNCTION
SELECTCASE ARG:1
	;野盗の場合
	CASE SP_COUNTRY_ID:(特殊勢力_野盗)
		;野盗の士官か奴隷としてスタートし、対象が堕ちている
		IF GROUPMATCH(BANDIT_START, 1, 2) && GETBIT(TALENT:(ARG:0):特殊勢力陥落系, 特殊勢力_野盗)
			RETURNF 1
		;MASTERが野盗に所属している
		ELSEIF CFLAG:MASTER:所属 == GET_COUNTRY_FROM_ID(SP_COUNTRY_ID:(特殊勢力_野盗))
			RETURNF 1
		;MASTERが野盗の捕虜で、対象が堕ちている
		ELSEIF CFLAG:MASTER:捕虜先 == GET_COUNTRY_FROM_ID(SP_COUNTRY_ID:(特殊勢力_野盗)) && GETBIT(TALENT:(ARG:0):特殊勢力陥落系, 特殊勢力_野盗)
			RETURNF 1
		ENDIF
	CASE SP_COUNTRY_ID:(特殊勢力_ホフゴブリン)
		;MASTERがホフゴブリン勢力に所属している
		IF CFLAG:MASTER:所属 == GET_COUNTRY_FROM_ID(SP_COUNTRY_ID:(特殊勢力_ホフゴブリン))
			RETURNF 1
		;MASTERがホフゴブリン勢力の捕虜で、対象が堕ちている
		ELSEIF CFLAG:MASTER:捕虜先 == GET_COUNTRY_FROM_ID(SP_COUNTRY_ID:(特殊勢力_ホフゴブリン)) && GETBIT(TALENT:(ARG:0):特殊勢力陥落系, 特殊勢力_ホフゴブリン)
			RETURNF 1
		ENDIF
	CASE SP_COUNTRY_ID:(特殊勢力_外来人)
		;MASTERが外来勢力に所属している
		IF CFLAG:MASTER:所属 == GET_COUNTRY_FROM_ID(SP_COUNTRY_ID:(特殊勢力_外来人))
			RETURNF 1
		;MASTERが外来勢力の捕虜で、対象が堕ちている
		ELSEIF CFLAG:MASTER:捕虜先 == GET_COUNTRY_FROM_ID(SP_COUNTRY_ID:(特殊勢力_外来人)) && GETBIT(TALENT:(ARG:0):特殊勢力陥落系, 特殊勢力_外来人)
			RETURNF 1
		ENDIF
	CASE SP_COUNTRY_ID:(特殊勢力_触手)
		;MASTERが触手勢力に所属している
		IF CFLAG:MASTER:所属 == GET_COUNTRY_FROM_ID(SP_COUNTRY_ID:(特殊勢力_触手))
			RETURNF 1
		;MASTERが触手勢力の捕虜で、対象が堕ちている
		ELSEIF CFLAG:MASTER:捕虜先 == GET_COUNTRY_FROM_ID(SP_COUNTRY_ID:(特殊勢力_触手)) && GETBIT(TALENT:(ARG:0):特殊勢力陥落系, 特殊勢力_触手)
			RETURNF 1
		ENDIF
ENDSELECT

;-------------------------------------------------
;渡された勢力番号が特殊勢力であるかを判断する
;-------------------------------------------------	
@IS_SP_COUNTRY(勢力)
#FUNCTION
#DIM 勢力
SIF 勢力 < 0 || 勢力 >= MAX_COUNTRY
	RETURNF 0
FOR LOCAL, 0, VARSIZE("SP_COUNTRY_ID")
	SIF COUNTRY_EVENT_ID:(勢力) == SP_COUNTRY_ID:LOCAL
		RETURNF 1
NEXT
RETURNF 0


;-------------------------------------------------
;渡されたキャラが特殊勢力の陥落系素質を持っているかを判断する
;-------------------------------------------------	
@IS_FALLEN_TO_SP_COUNTRY(対象)
#FUNCTION
#DIM 対象
RETURNF (TALENT:対象:特殊勢力陥落系 != 0)

;-------------------------------------------------
;渡されたキャラが特殊勢力のキャラであるかどうかを判断する
;-------------------------------------------------	
@IS_SP_COUNTRY_CHARA(対象)
#FUNCTION
#DIM 対象
RETURNF TALENT:対象:特殊勢力素質

;-------------------------------------------------
;渡されたビット番号に対応する陥落素質の文字列を返す
;-------------------------------------------------	
@TOSTR_FALLEN_TALENT(ビット)
#FUNCTIONS
#DIM ビット
SELECTCASE ビット
	CASE 特殊勢力_野盗
		RETURNF "野盗の肉便器"
	CASE 特殊勢力_ホフゴブリン
		RETURNF "ホフゴブリンの性奴隷"
	CASE 特殊勢力_外来人
		RETURNF "研究用奴隷"
	CASE 特殊勢力_触手
		RETURNF "触手による寄生"
	CASEELSE
		RETURNF ""
ENDSELECT
