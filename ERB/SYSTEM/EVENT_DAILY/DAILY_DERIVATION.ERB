;共通デイリーイベント：派生処理
@DAYLY_DERIVATION

;金貸し（返済期限のカウント及び返済とその派生処理）
;---------------------------------------------------------------------
IF DVAR:金貸しフラグ != -1
	;返済期限があればデクリメント
	SIF DVAR:金貸し期限 > 0
		DVAR:金貸し期限 --

	;返済日及び返済完了処理
	SIF !DCONFIG:DCON_金貸し && ((DVAR:金貸し期限 == 0 && DVAR:金貸し総額 > 0) || (DVAR:金貸し期限 == -1 && DVAR:金貸し現在額 <= 0))
		CALL LENDER_REPAYMENT(DVAR:金貸し期限 == -1 ? 1 # 0)

	;身体で返済中（返済完了イベントは次のターンに）
	SIF ID_TO_CHARA(DVAR:金貸し娘) != -1 && DVAR:金貸し現在額 > 0
		CALL TRAIN_BY_LENDER(ID_TO_CHARA(DVAR:金貸し娘))
ENDIF
;---------------------------------------------------------------------

;薬売り（ヤク堕ち及びヤク漬け調教処理）
;---------------------------------------------------------------------
IF DVAR:薬売りフラグ != -1
	;ヤク堕ち
	FOR LOCAL, 0, CHARANUM
		SIF TALENT:LOCAL:薬売りの奴隷 && CFLAG:(LOCAL):12 == 0 && CFLAG:(LOCAL):9 == 0 && !RAND:3
			CALL SMUGGLER_SLAVE_TRAIN_MSG(LOCAL)
	NEXT

	;ヤク漬け調教
	SIF ID_TO_CHARA(DVAR:薬売りターゲット) != -1
		CALL SMUGGLER_TRAIN_MSG
ENDIF
;---------------------------------------------------------------------

;接待（貴族の愛人処理）
;---------------------------------------------------------------------
;貴族の愛人になったキャラがいる場合、確率で犯される描写を挿入
FOR LOCAL, 0, CHARANUM
	SIF TALENT:LOCAL:貴族の虜 == 2 && CFLAG:(LOCAL):12 == 0 && CFLAG:(LOCAL):9 == 0 && !RAND:3
		CALL RECEPTION_SLAVE_TRAIN_MSG(LOCAL)
NEXT
