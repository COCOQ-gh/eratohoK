@KOJO_DAILY_EXIST_K83()

@KOJO_DAILY_K83()
#DIM 発生フラグ
発生フラグ = 0

;死霊術
DAILY_NAME = 死霊術
CALL KOJO_DAILY_K83_NECRO
SIF RESULT != -1
	発生フラグ = 1
SIF DAILY_CANCEL
	RETURN 1
RETURN 発生フラグ


;----------------------------------
;死霊術
;----------------------------------
@KOJO_DAILY_K83_NECRO
#DIM 布都
#DIM 屠自古
#DIM 青娥
#DIM 候補,3

布都 = NAME_TO_CHARA("布都")
屠自古 = NAME_TO_CHARA("屠自古")
青娥 = NAME_TO_CHARA("青娥")

;自勢力に素質[幼児]持ち、布都、屠自古のいずれかが2人以上いるならやる
LOCAL:1 = 0
FOR LOCAL:0, 0, CHARANUM
	SIF (TALENT:(LOCAL:0):幼児 && CFLAG:(LOCAL:0):所属 == CFLAG:MASTER:所属 && CFLAG:(LOCAL:0):特殊状態フラグ != 2)
		LOCAL:1 += 1
NEXT
SIF CHECK_KOJO_DAILY_HAPPEN(布都, 1000, 1, 0, -1)
	LOCAL:1 += 1
SIF CHECK_KOJO_DAILY_HAPPEN(屠自古, 1000, 1, 0, -1)
	LOCAL:1 += 1
SIF LOCAL:1 < 2
	RETURN -1
;そういや死人が1人はいないとダメだ
LOCAL:2 = 0
FOR LOCAL:0, 0, CHARANUM
	SIF CFLAG:(LOCAL:0):特殊状態フラグ == 2
		LOCAL:2 += 1
NEXT
SIF LOCAL:2 < 1
	RETURN -1

;青娥が同一勢力所属で捕虜でなく死んでいないなら5.0%で発生
SIF !CHECK_KOJO_DAILY_HAPPEN(青娥, 50, 1, 0, -1)
	RETURN -1

;面識がないなら顔見知りになる
SIF CFLAG:青娥:面識 == 0
	CFLAG:青娥:面識 = 1

CALL KOJO_DAILY_START

IF (KDVAR:青娥:青娥_死霊術 == 1 && PENIS(MASTER))
	PRINTFORMW 「%ANAME(MASTER)%さん%ANAME(MASTER)%さん」
	PRINTFORML 「またアレ、やりますか？」
	PRINTFORML

	CALL ASK_MULTI("よろしくお願い申し上げます", "おとといきやがれ")
	SELECTCASE RESULT
		CASE 0
			PRINTFORMW 「了解しましたわ」
			PRINTFORML さて、今度は誰を提供しようか……
			;処理がよくわからなかったのでミッドナイトプリスします
			TALENT:布都:幼児 = 1
			TALENT:屠自古:幼児 = 1
			候補:0 = -1
			候補:1 = -1
			WHILE (候補:0 == -1 || 候補:1 == -1)
				CALL SELECT_VICTIM
				FOR LOCAL, 0 ,2
					候補:LOCAL = RESULT:LOCAL
				NEXT
				SIF (候補:0 == -1 || 候補:1 == -1)
					PRINTFORMW 「あら、今更になって罪を自覚されたんですか？　うふふ」
			WEND
			候補:2 = -1
			WHILE (候補:2 == -1)
				CALL REVIVE
				候補:2 = RESULT:0
				SIF (候補:2 == -1)
					PRINTFORMW 「もう一息ですよ、がんばれ♡がんばれ♡」
			WEND
			TALENT:布都:幼児 = 0
			TALENT:屠自古:幼児 = 0
			CFLAG:(候補:0):所属 = 0
			CFLAG:(候補:1):所属 = 0
			CFLAG:(候補:0):特殊状態フラグ = 2
			CFLAG:(候補:1):特殊状態フラグ = 2
			CFLAG:(候補:2):好感度 += 100000
			CFLAG:(候補:2):従属度 += 100000
			CFLAG:(候補:2):依存度 += 100000
			CFLAG:(候補:2):所属 = CFLAG:MASTER:所属
			TALENT:(候補:2):合意 = 1
			TALENT:(候補:2):隷属 = 1

			PRINTFORMW 「おまたせしました」
			PRINTFORMW %ANAME(候補:2)%が蘇りました
		CASE 1
			PRINTFORMW 「あら、もうよろしいんですの？」
			PRINTFORMW 「もう少し楽しめるかと思っていたのですけれど……」
			PRINTFORMW 「嫌われたのでしたら仕方ありませんわね。ごきげんよう」
			PRINTFORMW そう言うと、%ANAME(青娥)%は壁を抜けてどこかへ消えていった……
		CASE 2
			PRINTFORMW 「やぁん♡」
			PRINTFORMW 押し倒されたというのに、%ANAME(青娥)%は余裕の表情だった
			PRINTFORMW 「こちらの方で楽しむのも悪くはありませんわね。ふふ」
			PRINTFORMW あくまで自分のペースを乱さない%ANAME(青娥)%に%ANAME(MASTER)%は挑みかかった……
				EXP:青娥:Ｃ感経験値 += ABL:青娥:Ｃ感 * 5 + 5 + RAND:11
				EXP:青娥:Ｖ感経験値 += ABL:青娥:Ｖ感 * 20 + 15 + RAND:11
				EXP:青娥:Ｂ感経験値 += ABL:青娥:Ｂ感 * 4 + 4 + RAND:9
				EXP:青娥:欲望経験値 += ABL:青娥:欲望 * 3 + 2 + RAND:7
				EXP:青娥:奉仕経験値 += ABL:青娥:奉仕 * 2 + 5 + RAND:11
				EXP:青娥:性交経験値 += ABL:青娥:性交 * 5 + 15 + RAND:11
				EXP:青娥:性技経験値 += ABL:青娥:性技 + 2 + RAND:4
				EXP:青娥:精愛経験値 += ABL:青娥:精愛 * 10 + 30 + RAND:21
				;中出しと妊娠判定
				IF CONFIG:1 == 0 && (VAGINA(青娥) || TALENT:青娥:孕み可能)
					FOR LOCAL:1, 440, 480
						TCVAR:青娥:(LOCAL:1) = 0
					NEXT
					CALL RECORD_INJECTION(青娥, GET_ID(MASTER), 3)
					CALL CHECK_PREGNANT(青娥)
				ENDIF
				;能力上昇はメッセージ表示後
				CALL TRAIN_AUTO_ABLUP(青娥)
				;処女とキス未経験を失う
				IF RAND:4
					;ペニスへのキス
					CALL KISS_COMMON(青娥, @"%ANAME(MASTER)%のペニス")
				ELSE
				;唇へのキス
					CALL KISS_COMMON(青娥, @"%ANAME(MASTER)%の唇")
					CALL KISS_COMMON(MASTER, @"%ANAME(青娥)%の唇")
				ENDIF

				CALL VIRGIN_COMMON(青娥, @"%ANAME(MASTER)%")
				CALL DOUTEI_COMMON(MASTER, @"%ANAME(青娥)%の膣")
			PRINTFORMW 「なかなか楽しめましたわ」
			PRINTFORMW 「それでは、またお会いできることを楽しみにしています」
			PRINTFORMW そう言い残して、%ANAME(青娥)%はどこかへ消えてしまった……
	ENDSELECT
ENDIF

IF KDVAR:青娥:青娥_死霊術 == 0
	PRINTFORMW 「%ANAME(MASTER)%さま%ANAME(MASTER)%さま」
	PRINTFORML 呼ばれて振り返ると、%ANAME(青娥)%が壁を抜けて部屋に入ってくるところだった
	PRINTFORMW 壁を抜けるほど急ぎの用なのか？と声をかけると、%ANAME(青娥)%はふふ、と笑みを浮かべた
	PRINTFORMW 「人に見られたくないような、やましい用事……だったら喜んでくれます？」
	PRINTFORML %ANAME(MASTER)%は%ANAME(青娥)%の目的を知るため、話を続けるように促した
	PRINTFORMW 「興味を持ってくれてうれしいですわ」
	PRINTFORML 「実は、%ANAME(MASTER)%さまが気にかけていた方を失ってしまわれたと耳にしまして」
	PRINTFORMW 「さぞ嘆かれたことでしょう。お悔やみ申し上げますわ」
	PRINTFORML 「まあ、そんなことはどうでもいいことですわね。お悔やみを申しあげても、何にもなりませんもの」
	PRINTFORMW 「本題なのですけれど、もし、死んだ者に会えるなら%ANAME(MASTER)%さまはいかがなさいますか？」
	PRINTFORML 「謝罪を望まれるでしょうか？　それとも抱擁を？　いずれにせよ、死人相手では寂しすぎると思いますわ」
	PRINTFORML %ANAME(MASTER)%は狼狽えた。つまり、%ANAME(青娥)%は死者を蘇らせられると言っているのだ
	PRINTFORML 「お早い理解ですこと。さすが、我が国の誇る優秀な人材というだけのことはありますわ」
	PRINTFORML 「それで……どうされますか？　仙人の術で、あの方にお会いしたいと望まれますか？」
	PRINTFORML 

	CALL ASK_YN("やる", "興味ない")
	IF RESULT == 0
		PRINTFORML 「ふふ、元気の良い方は好きですわよ」
		PRINTFORMW 「それでは、材料を2名連れてきていただけますか？」
		PRINTFORML これは好機だ。チャンスをみすみす逃す訳にはいかない
		PRINTFORML %ANAME(青娥)%が興味を失う前に早く選出しなければ……

		;処理がよくわからなかったのでミッドナイトプリスします
		TALENT:布都:幼児 = 1
		TALENT:屠自古:幼児 = 1
		候補:0 = -1
		候補:1 = -1
		WHILE (候補:0 == -1 || 候補:1 == -1)
			CALL SELECT_VICTIM
			FOR LOCAL, 0 ,2
			候補:LOCAL = RESULT:LOCAL
			NEXT
			SIF (候補:0 == -1 || 候補:1 == -1)
				PRINTFORMW 「あら、逃げようたってそうはいきませんわよ」
		WEND
		候補:2 = -1
		WHILE (候補:2 == -1)
			CALL REVIVE
			候補:2 = RESULT:0
			SIF (候補:2 == -1)
				PRINTFORMW 「あと一息なんですから、頑張ってください♡」
		WEND
		TALENT:布都:幼児 = 0
		TALENT:屠自古:幼児 = 0
		CFLAG:(候補:0):所属 = 0
		CFLAG:(候補:1):所属 = 0
		CFLAG:(候補:0):特殊状態フラグ = 2
		CFLAG:(候補:1):特殊状態フラグ = 2
		CFLAG:(候補:2):好感度 += 100000
		CFLAG:(候補:2):従属度 += 100000
		CFLAG:(候補:2):依存度 += 100000
		CFLAG:(候補:2):所属 = CFLAG:MASTER:所属
		TALENT:(候補:2):合意 = 1
		TALENT:(候補:2):隷属 = 1

	PRINTFORMW 「承りましたわ。……それでは、今しばらくお待ちください」
	CALL KOJO_DAILY_START
	PRINTFORMW 「おまたせしました」
	PRINTFORMW %ANAME(青娥)%は%ANAME(候補:2)%を連れてきた
	PRINTFORMW 夢や幻ではない。本物の%ANAME(候補:2)%がそこにいたのだ
	PRINTFORMW %ANAME(MASTER)%は%ANAME(候補:2)%にかける言葉が見つからず、ただ涙を流すことしかできなかった
	PRINTFORMW 「素晴らしいですわ……これこそ、定義の枠を超えた、美しい愛ですわ」
	PRINTFORML %ANAME(青娥)%は歓喜に打ち震える%ANAME(MASTER)%を満足げに眺め
	PRINTFORMW 壁を抜けて何処かに消えた……
	PRINTFORMW %ANAME(候補:2)%が蘇りました。よかったですね
	KDVAR:青娥:青娥_死霊術 = 1
	ELSE
		PRINTFORMW 「うう、そう邪険に扱われると涙が出ちゃいますわ」
		PRINTFORMW 「……まあいいですわ。こんな時代ですもの。いくらでもツテはありますわね」
		PRINTFORMW 「では、ごきげんよう」
		PRINTFORMW %ANAME(MASTER)%が警備を呼ぶ前に%ANAME(青娥)%は何処かへと去ってしまった……
	ENDIF
ENDIF



@SELECT_VICTIM
VARSET LOCAL
;士官が部隊に所属しているかどうかのマップを作成(高速化用)
CALL TMP_CREATE_IS_FREE_MAP
VARSET LOCAL, -1, 10, 13
;ページ数の計算
LOCAL:20 = 0
FOR LOCAL:0, 0, CHARANUM
	;マスターと所属勢力が同じ幼児持ちキャラカウント
	IF (CFLAG:(LOCAL:0):1 == CFLAG:MASTER:1) && TALENT:(LOCAL:0):幼児
		LOCAL:20 ++
	ENDIF
NEXT
LOCAL:20 = (LOCAL:20 - 1) / 40 + 1
LOCAL:21 = 1

$SHOW_LOOP2

DRAWLINE
PRINTFORML ワガママに付き合わせるキャラを選んでください(2人)
PRINTFORML やるといったからには最後までやってくださいね
DRAWLINE
PRINTL 

LOCAL:25 = 10
LOCAL:1 = 0
LOCAL:22 = 0
LOCAL:23 = (LOCAL:21 - 1) * 40
LOCAL:24 = LOCAL:21 * 40
FOR LOCAL:0, 0, CHARANUM
	;マスターと所属勢力が同じキャラで幼児素質持ちのみ
	IF (CFLAG:(LOCAL:0):1 == CFLAG:MASTER:1 && TALENT:(LOCAL:0):幼児)
		IF LOCAL:22 >= LOCAL:23 && LOCAL:22 < LOCAL:24
			IF LOCAL:1 % 2 != 0
				PRINT 　　　
			ELSEIF LOCAL:1 >= 1
				PRINTL 
				LOCAL:25 ++
			ENDIF
			IF MATCH(LOCAL, LOCAL:0, 10, 13)
				SETCOLOR COLOR("選択中")
			ENDIF

			PRINTFORM [{NO:(LOCAL:0) + 99, 3}]%ANAME(LOCAL:0), 16, RIGHT%
			RESETCOLOR
			LOCAL:1 ++
		ENDIF
		LOCAL:22 ++
	ENDIF
NEXT
PRINTL 
DRAWLINE

IF LOCAL:20 >= 2
	LOCAL:25 += 2
	IF LOCAL:21 > 1
		PRINT [  8] 前のページ            
	ELSE
		PRINT                             
	ENDIF
	LOCALS:0 = page{LOCAL:21}/{LOCAL:20}
	PRINTPLAINFORM %LOCALS:0, 28, LEFT%
	IF LOCAL:21 < LOCAL:20
		PRINT [  9] 後のページ
	ENDIF
	PRINTL 
	DRAWLINE
ENDIF

PRINTL [  0] 決定
PRINTL 

REDRAW 0

$INPUT_LOOP2
INPUT

IF RESULT == 8 && LOCAL:21 > 1
	LOCAL:21 --
	CLEARLINE LOCAL:25
	GOTO SHOW_LOOP2
ELSEIF RESULT == 9 && LOCAL:21 < LOCAL:20
	LOCAL:21 ++
	CLEARLINE LOCAL:25
	GOTO SHOW_LOOP2
ELSEIF RESULT == 0
	;将をNoの若い順にソート
	FOR LOCAL:0, 0, 3
		IF LOCAL:(LOCAL:0 + 10) >= 0
			LOCAL:(LOCAL:0 + 20) = NO:(LOCAL:(LOCAL:0 + 10))
		ELSE
			LOCAL:(LOCAL:0 + 20) = 99999
		ENDIF
	NEXT
	LOCAL:15 = 1
	WHILE LOCAL:15
		LOCAL:15 = 0
		FOR LOCAL:0, 0, 1
			IF LOCAL:(LOCAL:0 + 20) > LOCAL:(LOCAL:0 + 21)
				SWAP LOCAL:(LOCAL:0 + 10), LOCAL:(LOCAL:0 + 11)
				SWAP LOCAL:(LOCAL:0 + 20), LOCAL:(LOCAL:0 + 21)
				LOCAL:15 = 1
			ENDIF
		NEXT
	WEND
	REDRAW 1
	RETURN LOCAL:10, LOCAL:11
ELSE
	LOCAL:5 = NO_TO_CHARA(RESULT - 99)
	IF LOCAL:5 < 0 || CFLAG:(LOCAL:5):1 != CFLAG:MASTER:1
		CLEARLINE 1
		GOTO INPUT_LOOP2
	ENDIF

	;既に選択済みのキャラなら選択解除
	FOR LOCAL:0, 10, 12
		IF LOCAL:(LOCAL:0) == LOCAL:5
			LOCAL:(LOCAL:0) = -1
			CLEARLINE LOCAL:25
			GOTO SHOW_LOOP2
		ENDIF
	NEXT

	;未選択のキャラは選択
	FOR LOCAL:0, 10, 12
		IF LOCAL:(LOCAL:0) < 0
			LOCAL:(LOCAL:0) = LOCAL:5
			CLEARLINE LOCAL:25
			GOTO SHOW_LOOP2
		ENDIF
	NEXT

	CLEARLINE 2
	PRINTFORML これ以上いりません
ENDIF
GOTO INPUT_LOOP2



@REVIVE
VARSET LOCAL
;士官が部隊に所属しているかどうかのマップを作成(高速化用)
CALL TMP_CREATE_IS_FREE_MAP
VARSET LOCAL, -1, 10, 13
;ページ数の計算
LOCAL:20 = 0
FOR LOCAL:0, 0, CHARANUM
	;死人をセレクト
	IF CFLAG:(LOCAL:0):特殊状態フラグ == 2
		LOCAL:20 ++
	ENDIF
NEXT
LOCAL:20 = (LOCAL:20 - 1) / 40 + 1
LOCAL:21 = 1

$SHOW_LOOP2

DRAWLINE
PRINTFORML 蘇らせるキャラを選んでください(1人)
DRAWLINE
PRINTL 

LOCAL:25 = 10
LOCAL:1 = 0
LOCAL:22 = 0
LOCAL:23 = (LOCAL:21 - 1) * 40
LOCAL:24 = LOCAL:21 * 40
FOR LOCAL:0, 0, CHARANUM
	;死人のみ
	IF (CFLAG:(LOCAL:0):特殊状態フラグ == 2)
		IF LOCAL:22 >= LOCAL:23 && LOCAL:22 < LOCAL:24
			IF LOCAL:1 % 2 != 0
				PRINT 　　　
			ELSEIF LOCAL:1 >= 1
				PRINTL 
				LOCAL:25 ++
			ENDIF
			IF MATCH(LOCAL, LOCAL:0, 10, 13)
				SETCOLOR COLOR("選択中")
			ENDIF

			PRINTFORM [{NO:(LOCAL:0) + 99, 3}]%ANAME(LOCAL:0), 16, RIGHT%
			RESETCOLOR
			LOCAL:1 ++
		ENDIF
		LOCAL:22 ++
	ENDIF
NEXT
PRINTL 
DRAWLINE

IF LOCAL:20 >= 2
	LOCAL:25 += 2
	IF LOCAL:21 > 1
		PRINT [  8] 前のページ            
	ELSE
		PRINT                             
	ENDIF
	LOCALS:0 = page{LOCAL:21}/{LOCAL:20}
	PRINTPLAINFORM %LOCALS:0, 28, LEFT%
	IF LOCAL:21 < LOCAL:20
		PRINT [  9] 後のページ
	ENDIF
	PRINTL 
	DRAWLINE
ENDIF

PRINTL [  0] 決定
PRINTL 

REDRAW 0

$INPUT_LOOP2
INPUT

IF RESULT == 8 && LOCAL:21 > 1
	LOCAL:21 --
;	CLEARLINE LOCAL:25
	GOTO SHOW_LOOP2
ELSEIF RESULT == 9 && LOCAL:21 < LOCAL:20
	LOCAL:21 ++
;	CLEARLINE LOCAL:25
	GOTO SHOW_LOOP2
ELSEIF RESULT == 0
	;将をNoの若い順にソート
	FOR LOCAL:0, 0, 3
		IF LOCAL:(LOCAL:0 + 10) >= 0
			LOCAL:(LOCAL:0 + 20) = NO:(LOCAL:(LOCAL:0 + 10))
		ELSE
			LOCAL:(LOCAL:0 + 20) = 99999
		ENDIF
	NEXT
	LOCAL:15 = 1
	WHILE LOCAL:15
		LOCAL:15 = 0
		FOR LOCAL:0, 0, 1
			IF LOCAL:(LOCAL:0 + 20) > LOCAL:(LOCAL:0 + 21)
				SWAP LOCAL:(LOCAL:0 + 10), LOCAL:(LOCAL:0 + 11)
				SWAP LOCAL:(LOCAL:0 + 20), LOCAL:(LOCAL:0 + 21)
				LOCAL:15 = 1
			ENDIF
		NEXT
	WEND
	REDRAW 1
	RETURN LOCAL:12
ELSE
	LOCAL:5 = NO_TO_CHARA(RESULT - 99)
	IF LOCAL:5 < 0 || CFLAG:(LOCAL:5):特殊状態フラグ != 2
		CLEARLINE 1
		GOTO INPUT_LOOP2
	ENDIF

	;既に選択済みのキャラなら選択解除
	FOR LOCAL:0, 12, 13
		IF LOCAL:(LOCAL:0) == LOCAL:5
			LOCAL:(LOCAL:0) = -1
;			CLEARLINE LOCAL:25
			GOTO SHOW_LOOP2
		ENDIF
	NEXT

	;未選択のキャラは選択
	FOR LOCAL:0, 12, 13
		IF LOCAL:(LOCAL:0) < 0
			LOCAL:(LOCAL:0) = LOCAL:5
;			CLEARLINE LOCAL:25
			GOTO SHOW_LOOP2
		ENDIF
	NEXT

	CLEARLINE 2
	PRINTFORML 1人だけですよ
ENDIF
GOTO INPUT_LOOP2