2016/05/13
eraTohoK ver0.175用 試作リグル式戦術AIほか改変多数



せつめい

いろいろ好き勝手やったやつ（バニラ用ね）
元々は蟻コロニー最適化使ったらワープ多用戦術をどうにかできるんじゃね？と始めた
ついでになんやかんやと手を入れてたら内容を一言で言い表せなくなった代物

試作したリグル式戦術AIはいい感じに近隣領土に手を広げてくれるが
とかく展開が遅くなる傾向があったため従来形式のAIも併用することにした
だいたいこんな感じ
・攻撃するぞって時は従来式で同盟・連合を利用して飛び地にしてでも領土を広げる
・その他の時は自国領土から部隊を派遣して近隣を攻略してく
・領土がでかくなると気が大きくなって拡大路線（従来式AI）になりやすい
・ホントは勢力同士の友好/敵対関係も利用したかったが参照方法がよくわかんなかったよ
　関数@AI_ACO_SETTARGETで適当に係数を指定してやれば設定自体は容易
　敵対状態に限って関係の悪い勢力に侵攻しやすく、友好的な勢力には侵攻しにくくするとかもできる



やったこと

・バグフィックス、開発者モードでの起動エラーの回避
　適宜書き換えただけ
・バグフィックス、解散直後の部隊同士が地点0（無名）で殴りあう事態の回避
　対決・移動処理で地点0の部隊はスキップするようにした
・スレ210の>>526の修正（>>547コピペしただけ）
・スレ210の>>406の回避
　処理を把握しきってないのでエンバグの可能性あり、確認よろしゅう
・バグフィックス、ホフさんが接収都市を指定で蜂起した際に領土なしになる可能性があるバグの修正
　指定都市の奪取が確率になってたのと指定都市以外の接収処理が行われなかったのを修正
　たぶんこれが意図した動作だと思うのよ
・バグフィックス、以前に報告した純狐の子どもが名無しになるバグが残ってた
　現状だと親の姓なし＆動物耳orしっぽで強制的にカタカナ名になるが
　東方でカナ名ばっかなのは違和感ありありなので
　母親の名前がカタカナだったらカナ名、それ以外なら和名という感じに
・SLGパートの思考ルーチンの改変（「改善」にあらず）
　蟻コロニー最適化を使用したリグル式戦術AIの試作
　軍事政策時と連合参加時を除き、隣接地域以外は狙わない（＋αで確率でも発生）
　軍事政策時や連合参加時は拡大主義路線で従来形式の行動を行う
・主人公勢力が捕虜の処遇の選択で「軟禁」が選択できるように
　野盗、ホフ、外来人は便器系素質のない士官や軟禁中の捕虜を陵辱しないようにした（ただしあなたは除く）
　借り物や移籍士官も陵辱されない（便器系除く）
　軟禁状態から引き込んで士官にすれば綺麗なままで仲間に入れることも可能に
　通常の捕虜にしておけば従来通りに褒美に部下に回すようなプレイングになる
　@TREAT_PRISONERで勝手に戻り値を増設（RESUTL == 4で軟禁を選択）したがどうなるかは未検証（すまぬ）
　
　あなたの扱いについては改良の余地あり
　女あなたなり何なりで陵辱されたい需要もあると思うので野盗の士官スタート以外では陵辱を受けるようにした
　わかりづらい処理なのは確かであなたに関してはCFLAGか何かで陵辱される/されないを管理してもいいかも
　放浪から志願した男あなたが便器化するのも違和感あるし
・部隊の解散条件の改変
　はっきり言って妥当性はわからん
・関数@SLG_AI_RESCUEの手直し
　好き勝手にプライベート変数を使いまくったが改良と呼べるのかどうか？
　以下2点のバグ修正も含む
　切り返しの判定に入った上でキャンセルになった場合、REVERSE_SOLDIERの補填処理が無かった
　複数箇所を攻められた時に防衛部隊が重要度関係なしに最もIDの若い都市に出現するような挙動になっていた
　「同一の重要度の複数の都市を同時に攻撃される」シチュエーションは稀とは思うが一応
・関数@SLG_AI_DEFENSEの改造
　リグル式に合わせて改変



たぶん未解決の問題（棚上げにした不具合）

・連合参加時に討伐対象ではない都市に対して部隊を派遣することがあるっぽい？
　よくわからんが従来式のAIでぽつぽつ見かけた（リグル式AI使用時は発生しない、はず）
・拠点フェイズの「説得させる」のUIが軟禁捕虜が増えまくることを想定していない
　説得担当欄がどんどん圧迫されていきまする
　説得対象欄も表示キャラ数固定してページ送りできるようにするのが理想？
・借り物士官を部隊の将に指定すると返した後も引き続き将に指定されたまま
　原因は見当がつくけれど処理する箇所がよくわかってないので放置決定
　いちおう現状でも解散なり最強指定なりで外せる



試作リグル式戦術AI概要

藍しゃまがうどんちゃんに「最短距離を回りたくば蟻に聞いてみろ」って言ってた
蟻以外の虫が紛れ込んでたらゴメンナサイ

・蟻コロニー最適化を使用した思考ルーチンの試作品
・仮想的な蟻とフェロモンの活用により都市の評価時に戦線の拡大等を網羅的に扱わなくても良いようにした
・が、連合発生時の遠隔地の攻撃の実装方法で詰まって結局は従来式の思考ルーチンも併用したのであまり意味は無い
・難易度普通以下はたぶんアホ

・自勢力以外のフェロモンは影響しない
・各勢力の所持兵力（編成部隊＆守備部隊）を仮想的な蟻の巣とみなす
・蟻の生産＆移動→フェロモンの生産＆拡散→部隊の移動の順番で処理を行う

・蟻＆フェロモンは純粋に戦闘用の数値であり、外交政策には影響しない
・各地の蟻の量は毎ターンリセットされる
・フェロモンは減衰しながら残留する
・だれか改良して

　蟻の生産
　・蟻は各土地の駐在兵力分だけ生産される

　蟻の移動
　・編成兵力による蟻は生産の直後に隣接地（生産地を含む）へ「経済規模に応じて配分」される
　・守備兵力による蟻はその場に滞在する（生産直後には移動しない）

　フェロモンの生産
　・各都市に移動した蟻は蟻の数だけのフェロモンを生産する
　・敵部隊が侵入中の都市は経済規模に応じた警戒フェロモンを生産（生産直後には拡散しない）

　フェロモンの拡散
　・フェロモンは生産地と隣接地に「均等に拡散」する

　部隊の移動
　・存在する兵力はフェロモンの濃度に応じた確率で隣接地に移動する
　・純粋なフェロモン依存ではなく重みづけを行った上で乱数も絡む
　・支配勢力が空白の土地などは狙われやすい
　・難易度が高いと勢力の支配域の広さや兵力差も考慮する
