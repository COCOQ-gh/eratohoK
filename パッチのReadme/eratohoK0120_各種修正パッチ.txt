‰eratohoK ver0.120用各種修正＆調整パッチ

‰‰概要
・依姫の生存する世界線を探していると負傷したキャラが翌ターンに出撃していたので調べて直してみた
 なお、１回乗り切ってもすぐに連合が再編成されて終わる模様（合掌、クールダウン中に他の連合が組まれればワンチャン）
・引きぬき処理周りの変数が上手くやりとりできていないのを修正（シナリオ1限定、問題なければほかシナリオでも使えるように関数化を検討）
・地方派遣を行ったタイミングで最大行動可能数が減ってもそれをチェックできていないのを修正


‰‰変更内容
・SLG_FUNCTION.ERB:1076行を以下のように変更
	SLG_COOLTIME:(LOCAL:(LOCAL:0)):0 = MAX(SLG_COOLTIME:(LOCAL:(LOCAL:0)):0 , 1)
　ついでにTURNEND.ERB:8行目も変更しています
		IF SHOP_TIME == CALC_SHOP_TIME() || CFLAG:MASTER:9

・反乱による引抜き処理はいろいろ触ってます（シナリオ１しか触れていませんのでシナリオ作者は参考にして書きなおしてみてください）
　SORT.ERB:@FISHER_YATES_SHAFFLEにRETURNを設定（念のため）
　LOCAL:10に反乱の誘いに対する返答を格納し、RESULTを見ていた部分はこれを追っていく（誘いがなければ1）
　LOCAL:11で最大周回を設定（現在5回、返答結果が順に険悪化してるのでそれ使ってもいいんじゃないかな）
　LOCAL:7に拉致予定人数の合計値を格納。全員にアクションをした後75％埋まっていなければ再挑戦します
　最終目標：新勢力の武将引き取り処理を関数化する（あくまでも予定。引きぬき対象、引き抜き先、引抜き人数、拉致人数、特殊フラグぐらいの引数を持たせることになるのかな？）
　（関数化に成功すれば特定条件で一部キャラが別の既存勢力に下るというのも可能になりそう）
　シナリオごとに中に書くのも（修正を全部書き直すのが）面倒なので何とかできたらやりたいです。

・ルート選択でおかしなことがあったので修正
　SLG_FUNCTION.ERB:396,418行目を以下の前者、440行目を後者に修正（都市0と接続している判定が出ていたので）
	IF ARG:0 == ARG:1 || !INRANGE(ARG:0 , 1 , 100) || !INRANGE(ARG:1 , 1 , 100)
	IF !INRANGE(ARG:0 , 1 , 100)
　敵と隣接しているかの判定が常に隣接判定を出していた原因がこちらです。
　とは言っても初期状態の兵力にぐらいしか影響はない模様。

・地方派遣処理後最大行動回数が減少し、それで行動回数を使いきった場合拠点フェイズ終了処理に飛ばす
　SHOP_LIFE.ERB:1315行目辺りから以下に変更
	;LOCAL:10に自勢力の士官数を格納、行動回数の監視が目的
	LOCAL:10 = GET_COMMANDER_NUM(CFLAG:MASTER:1)
	PRINTFORML 本当に%ANAME(ARG:0)%を派遣しますか？
	IF !(LOCAL:10 % 5) && (LOCAL:10 / 5) == SHOP_TIME
		SETCOLOR 0xFF0000
		PRINTFORML 派遣を行った場合、最大行動回数減少により直ちに拠点フェイズが終了します！
		RESETCOLOR
	ENDIF
　SHOP_LIFE.ERB:1315行目（派遣によるキャラ削除処理）直後に以下を追記
		IF CALC_SHOP_TIME() == SHOP_TIME
			PRINTFORMW 人数不足による仕事のしわ寄せにより自由時間がなくなったので拠点フェイズを終了します。
			BEGIN TURNEND
		ENDIF

‰‰このパッチの扱い方
このパッチ以前に公開されたパッチを順次適用後、このパッチ内のファイルを上書きしてください

パッチ適用により以前まで発生していなかったバグ、不具合及び怪奇現象についてはeratoho総合スレに上げていただくと
モニター前でごめんなさいを呟きながら修正すると思われます（自分のミス分は最優先で触る方針ですよ）。


‰‰パッチの改変などについて
　ご自由に改変、修正、別処理への流用などしてください。
　別バリアントへの移行もお気軽に行ってください。









‰‰で、イベントどうするの？
↓
○
小
大

（へんじがない、ただのしかばねになってとうひしているようだ）

イベントの勢いでいい加減に過去にどのようなパッチ作ったか白状すべきかなとは思ってますが、
その辺りも含めて今しばらくお待ちを。
