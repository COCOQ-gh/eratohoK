eratohoK0.135+パッチまとめ1011用バグ修正パッチ1016
=================================================

概要
----
* このパッチを導入するとバグが減ります
* あと、疑問点提起が含まれています
* パッチまとめにそのまま上書きできるようにパッチまとめが出てから出してきたパッチがそのまま入ってるんだけどいい加減readmeが長くて面倒になってきた まあ、ERB読むよりは短いんだけど

疑問点
------
+ キスの処理に程度は違えど意見が分かれる仕様をいくつか発見。以下疑問点
    * キスで既成事実を得る条件が「初めての口と口のキスをMASTERに与えること」である
    * キスの既成事実は捕虜調教などの調教時にキスしても得ることはできない
    * キスの意味が場所によって違う
        + キス経験は口と口のキスをした回数を表す
        + [キス未経験]は口と口のキスをしたことが無いことを表す
        + 地の文で表示される「初めてのキス」は口で誰かの性的部位(口以外も含む)にキスしたときに表示される
    * キス周りの初めてを判定する関数を呼び出すときに既成事実を得るかどうかを引数として与えている
        + MASTER相手じゃなくても既成事実を取得するように関数を呼び出すことができる
        + MASTER相手でも既成事実を取得しないように関数を呼び出してしまうことがあり得る
+ 勢力を降伏させたとき、対象勢力に捕虜にされていたキャラを登用、投獄選択することができる。以下疑問点
    * 本来は、戦闘で倒した時のように解放も選択肢としてあってしかるべきでは？
    * 戦闘で倒した時の捕虜では登用を断る選択肢があるのに降伏させて捕虜をかすめ取ると登用できるのはおかしいのではないか？
    * 自勢力の士官が捕虜になっていた場合でも投獄できるのは問題ではないか？

1016パッチ内容解説
------------------
+ 他国の君主に調教を承諾させた後あなたが勢力に所属しなくなった場合あなたの後ろ盾が消えるため君主が調教状態から解放されるように
+ 君主あなたが勢力を放棄して下野し、さらに別の勢力を立ち上げることができることを矯正
+ 妊娠周りで不安定な挙動が多くあったため修正
+ 固有キャラ以外のゲーム開始時の処理で本来は想定されていなかった挙動が有ったため修正
+ その他、表示、構文的な修正

1013パッチ内容解説
------------------
+ 1012にあった誤植を修正
+ 勢力を降伏させた際対象勢力に捕虜にされていたキャラがまともに扱えなかった問題をとりあえず修正
+ キスで既成事実が絶対に取れない問題はとりあえず修正
+ その他構文的な修正

1012パッチ内容解説
------------------
+ 女あなたが出産した子供を子育てしようとしたとき子供の場所を間違えていたせいでエラー落ちするバグを修正
+ 労働基準時間外でも数字を手打ちすることであなたが労働してしまうバグを修正
+ ページ数が変なバグを修正
+ 脱走した際帰る場所がないとショックでエラー落ちするバグを修正
+ 部隊の将をいつでも別の部隊へ強行日程で移転して連続勤務を強いていた事例を修正
+ 義勇兵を募った時部隊番号がユーザーフレンドリーじゃない表示だったので修正
+ 解散の際に行うべき手続きを将が理解せずに兵を待機所に送った後休暇届を出して終わりにしていたバグを修正
+ その他構文的な修正

パッチ内容詳細
--------------
* ERB/
    + R_CHARA/
        - CHILD.ERB
            * @CREATE_CHILD(ARG:0)
                + 子供のデータを作成する関数
                + 返り値で子供の番号を返すように
    + SHOP/
        - SHOP_LIFE.ERB
            * @SHOW_SHOP_LIFE_A
            * @LIFE_MENU_PRISONER(ARG)
            * @LIFE_MENU_TEBIKI(ARG)
                + ページ数が変になるバグを恒久的に修正　マイナスいくつだろうが適切な範囲に収まるように修正されました
            * @EVENTBUY_LIFE_A(ARG:0)
                + MASTERに労働規則を順守させた
            * @CHILD_REARISING
                + MASTERが子育てする際エラーが起きないように子供がいる正しい場所を教えた
    + SLG/
        - DEPLOMACY_EACH.ERB
            * @DIPLOMACY_SURRENDER(ARG:0)
                + 降伏を迫り降伏したら処理を行う関数
                + 一部不安だったところを修正
            * @DIPLOMACY_SURRENDER_SET_TREATMENT(ARG:0)
                + 降伏した勢力の士官と捕虜を取り扱う関数
                + 捕虜がただしく扱えなかった問題を修正
        - DIPLOMACY_REQUEST.ERB
            * @CHECK_DIPLOMACY_TRAIN_FLAG
                + ターン経過時の君主調教が継続するかをチェックする関数
                + あなたが勢力から抜け出したらあなたのいうことを聞いてくれなくなる
        - SLG_FUNCTION.ERB
            * @RELEASE_PRISONERS()
                + 脱走した際帰る場所がなく途方に暮れているキャラはエラーを起こさず放浪するように誘導
            * その他いっぱい
                + エラーが起きないことは確認した
                + 寝ぼけ頭で気に入らない構文を片っ端から書き換えた覚えがある
        - SLG_SHOP.ERB
            * @EVENTBUY_SLG(ARG:0)
                + SHOPでの入力を受け付ける関数
                + 君主が勢力を捨てて下野できなくなった
        - SLG_SHOP_SUB.ERB
            * @UNIT_SETTING(ARG:0, ARG:1)
                + 解散の手続きを代行する窓口を将に紹介するように修正
            * @SELECT_UNIT_COMMANDER(ARG:0, ARG:1)
                + 将が部隊から離れる際手続き、移動などのための時間を与え連続で勤務できないように修正
            * その他いっぱい
                + たぶんあとで説明すると思うな
        - SLG_TURNEND.ERB
            * @IDOL_GATHER_SOLDIER(ARG:0, ARG:1)
                + 義勇兵を募ったさい表示される部隊番号がずれていたため修正
        - SLG_VARIABLE.ERH
            * Add #DIM CONST MAX_UNIT_COMMANDER
                + 一つの部隊に所属できる将の最大数
            * Add #DIM CONST MAX_CITY_COMMANDER
                + 一つの都市に所属できる守将の最大数
            * 上について注意
                + ほかの定数も同じであるが　ここを変更しただけではそれを増やしたり減らしたりできないことに注意
                + マジックナンバーが全て定数化されてるわけでもなければ最大数が一定の条件を持っていることが前提の処理もある
    + SYSTEM/
        - EVENT_PRISONER.ERB
            * @SETSTATE_PRISONER
                + 捕虜の扱いを決める関数
                + 表示を調整
        - NEWGAME.ERB
            * @NEWLOOP(ARG:0=0)
                + 新しいゲームが始まった時に処理を行う関数
                + 引継ぎキャラの範囲が引継ぎの処理で想定されていたものとずれていたため修正
        - STORY.ERB
            * @ENDING_CHECK
                + 比較演算子で代入していたのを修正
        - _FUNCTION.ERB
            * Add Func@ERROR(ARGS)
                + ARGSをエラーメッセージとして表示する関数
                + THROWに関して強い抵抗が存在するためそれを解消するためDEBUGかどうかで挙動が変わるエラー関数を用意
                + 本当はFORCEWAITしたかったんだけど式中関数だとFORCEWAITできないのよね困った
            * @KISS_COMMON(ARG:0, ARG:1, ARG:2, ARG:3 = -1, ARG:4 = -1)
                + キス周りの初めてを処理する関数
                + 既成事実が取得できなかった問題をとりあえず場当たり的に解消
                + ただし事前に書いた問題あり
    + TRAIN/
        - Add CREAMPIE_HISTORY.ERB
            * 中だし履歴がCFLAGで枠をとっていて変な処理になっているため将来的に#DIMに置き換えるために関係する処理をまとめようと目についた範囲で集めたもの
            * ただし、まだ中だし履歴関係の処理を全部集めたわけじゃないため注意
            * Add Func@UPDATE_CREAMPIE_HISTORY(ARG)
                + Turnend内で時間経過による中だし履歴の更新を行う関数
            * Add @GET_FATHER_CONDIDATE_FROM_CREAMPIE_HISTORY(ARG)
                + 中だし履歴から妊娠発覚時に予測される父親候補を取得する関数
            * Add @CLEAR_CREAMPIE_HISTORY(ARG:0)
                + 妊娠したなどで中だし履歴を忘れるときの処理
        - PREGNANT.ERB
            * バグを探すうえで処理が長くて読みにくかったためある程度処理を意味ごとに関数に切り分けてから弄っていったのでひどいことになってる
            * 様子を見て関数の中身を呼び出し側で展開とかするかもしれない　後で
            * @TURNEND_PREGNANT_CHECK
                + この関数の母親側の処理にバグがあるのだろうと予測されたため見通しをよくするためこの関数を切り分け
                + メモ何だけど　この処理だと母親の番号＜子供の番号に必ずなるはずだからこの二つのループは一つにまとめることができるはず だからナニというわけじゃないが
            * Add @TURNEND_PREGNANT_CHECK_MOTHER(ARG:0)
                + 上の関数の母親用
                + 長くて読みにくい処理だけを関数に切り分けたため関数の長さが中途半端
            * Add @DETECT_PREGNANCY(ARG:0)
                * 妊娠が発覚したときの処理を行う関数
                * 同上の関数のリストの2行目
            * Add @RECORD_FATHER_FROM_CREAMPIE_HISTORY(ARG:0)
                + 父親候補を中だし履歴から取得してそれを適切に記録する関数
            * @BIRTH_CHILD(ARG:0)
                + 子供を出産したときに発生する処理をまとめた関数
                + いろいろ書きこんだメモが残ってるけど役に立たない
            * @NORMAL_BIRTH_CHILD(MOTHER)
                + 特殊な勢力に捕虜になっている、金貸しにつかまっているなどの特殊な事情のない通常の出産を扱う
            * @TURNEND_PREGNANT_CHECK_CHILD(ARG:0)
                + さっき言った切り分けた関数の子供用
                + 関数にしたけどインデントを直した以外何も手を付けてない
            * @RESET_MOTHER_STATE(ARG:0, ARG:1 = 1)
                + 母親が出産後一定の日数がたったらよばれる妊娠の影響から完全に回復する関数
                + 子供周りの処理でエラーが出ていたため修正
    + VARIABLE.ERH
        - Add #DIM CONST MAX_CHARANAME_LENGTH
            * 名前が長いことが原因でずれているときこの長さのスペースをとると表示がきれいになる定数
            * 今はスターサファイアの名前が使われている
