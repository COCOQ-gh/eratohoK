#SHOP_SLGの整理テスト

##ご注意
	※フォルダやファイルの構造を大きく変えるパッチなので
	※上書きではなく差し替えが必要な部分があります。
	※必ずバックアップを取って作業を行ってください。

	１．「1_この中身を上書きしてください」というフォルダの中身を
		eratohoK0.250.1に上書きしてください。

	２．「2_この中身をERB_SLGフォルダと差し替えてください」というフォルダの中身を
		eratohoK0.250.1のERBフォルダ内のSLGフォルダと差し替えしてください。

	整理パッチです。プレイ時の変化はさほど感じられないと思います。
	元のファイルを探して消す作業が大変そうなので、
	触っていないところも多いのですがフォルダごと差し替え用でUPします。

	まだ確認が甘いのですが見直すたびに気になることが増えるのでひとまずまとめ。

	SHOPフォルダのファイルの一部上書きもついていますが、
	こちらは後から追加したファイルのSHOP_LIFE_BUTTON.ERBに
	キャラリストのボタン関数COLUMN_RIGHT_CHARALIST_BUTTONを移したほうが
	わかりやすいかもしれないと思って移動したとか、少し整理しただけです。


##権利
	eratohoK本体規約に準じます。
	本体に取り込まれた場合、このパッチの製作者は権利を放棄します。


##謝辞
	era開発に携わる皆様に感謝。


##概要
	SHOP_SLGもLIFEと同様の整理を行ってみました。
	こちらはMAP表示が基本なので効果が薄そうです。

	拠点フェイズに揃えたところ
		メニューコマンド１につきファイル１にまとめ（選択可否判定と処理を移動）
		SHOP_AVAILのチェックを各メニューコマンドの選択可否判定呼び出しに変更
		カテゴリ保存用配列を追加
		選択可能なカテゴリとメニューを配列に保存
		可変メニューの表示自動化
		右カラム改行時の行番号指定を不要に
		ページ移動に使用する番号の定数化

	SLG側は右カラムの存在するメニューは都市管理のみ、
	メニューコマンドごとに関数が整理されていたので
	左カラムメニューの入力処理がただのラッパ状態になりました。
	LIFEより量が多いので中身の移し替えはしていません。

	説明文と抱き合わせで表示していた
	一部のメニュー（オート設定・政策変更・特別訓練）で
	直接番号指定が分岐に使われているものがまだあります。


##ファイル構造の整理

	###変更されているファイル
		+SLG_CITY.ER　					区切り線とメニュー表示ボタン名の入れ替え
		+MAP_EU2.ERB MAP_LIBRARY.ERB	メニュー表示ボタン名の入れ替え
		+SYSTEM\TURNEND.ERB　FLAG:200	FLAG:201のリセットを変更
		+DONFIG_DATA_EDIT_SLG.ER　		コマンドの選択可否判定関数名変更
		+SLG_AI_DIPLOMACY.ERB			全角スペースのエラー１修正

	###メニューコマンド毎にファイル分けしました
		他削除されているファイルの中身はSHOP_SLG内メニューファイルへ移動しています。
		MAP.ERBから関数を移動させ、拠点と同じ構成に。
			+SHOP_SLG.ERB
			+SHOP_SLG_CHECK.ERB（１関数しかないのでファイルを分けるほどじゃなかったかもしれない）
			+SHOP_SLG_COLUMN_LEFT.ERB
		SHOP_SLGフォルダ作成。
		その中に分割したメニューコマンドのファイルを入れ、表示上の日本語名で名づけました。
		メニュー名が長いものは少し略しています。
		外交はかなり量があるので関係を結ぶや交渉などのカテゴリでもファイル名を分類しました。


##FLAG.CSVに戦略フェイズ選択コマンドを追加
	FLAG.CSV

	14,戦略フェイズ選択コマンド,;2017/03/12追加
	→SHOP_SLG.ERB @EVENTBUY_SLG でメニュー番号の保存に使用

	15,戦略フェイズページ,		;2017/03/12追加
	→FLAG:201と差し替え（都市管理で使用されていたページ番号）
		TURNEND.ERBのリセット・都市管理で差し替え

	SLG版をひとまず用意しました。
	別の番号に変更する場合は入れ替えてください。

	grepして確認してみたところ、
	FLAG:14はgrepで見当たらず
	FLAG:15はコメントアウトされたERB\TRAIN\EVENT_OTHERSLOVE_霖之助.ERB
	の処理に使用されていたようです。


##SLG_VARIABLE.ERH末尾に定数や変数を追加
	名前や用途は拠点とほぼ同じです。

	#DIMS COLUMN_LEFT_CATEGORY_NAME_SLG, 10
	#DIM COLUMN_LEFT_CATEGORY_NUM_SLG, 40
	#DIM COLUMN_LEFT_MENU_NUM_SLG, 40
	#DIM CONST SHOP_SLG_LIST1_PAGE_BACK = 98
	#DIM CONST SHOP_SLG_LIST1_PAGE_NEXT = 99
	#DIM CONST SHOP_SLG_LIST1_PAGE_RESET = 96
	#DIM CONST SHOP_SLG_LIST1_PAGE_MAX = 97
	#DIM SHOP_SLG_LIST1_MAXPAGE

	COLUMN_LEFT_MENU_START_VALUE
	COLUMN_LEFT_MENU_END_VALUEは共有した（使用場所が限定されてるので）
	が位置はSHOP_LIFE_VARIABLE.ERHのままでちょっとわかりにくそうです。


##REPEAT_DASHをCOLUMN_RIGHT_LINEに
	SLG側のCALL REPEAT_DASHをCALL COLUMN_RIGHT_LINEに入れ換えました。
	（おそらく微妙なずれで使えなかったのではと思い、ずれを調整）
		ERB\SLG\SLG_CITY.ERB(17)			CALL COLUMN_RIGHT_LINE
		→ARG:1が未指定(1)なので次行にPRINTL 
		ERB\DEBUGMENU\MAP\MAPDEBUG.ERB(34)	CALL COLUMN_RIGHT_LINE
		ERB\DEBUGMENU\MAP\MAPDEBUG.ERB(134)	CALL COLUMN_RIGHT_LINE
	ARG:0は0のものしか見当たらず。

	備考
	@COLUMN_RIGHT_LINEの置き場は
	_FUNCTION.ERBのREPEAT_DASHのそばの方が良くなったかもしれません。
	カラム整理関連の関数はまとめておきたいが処理の構造的には
		SHOP┬SHOP_LIFE
			└SHOP_SLG
	で、SHOPとSLGで共有する関数の置き場が悩ましかったのでそのままです。


##メニューの並び順の整理
	色々考えていてこの並び順になりましたが、
	自動が上にきたりで慣れるまで使いにくいかもしれないので、
	問題がありましたら差し替えてください。
	下記に並び順を差し替える場合の注意があります。


##並び順やカテゴリーを変更する場合のご注意（直接メニュー番号の指定をした場所）
	+自動と政策はボタンに色付けするため表示欄で特別扱いしています。
		COLUMN_LEFT_MENU_SHOW_SLGで分岐

	+特別訓練はメニュー次行に割引表示をするためカテゴリとメニューの保存・表示が別枠になっています。
		COLUMN_LEFT_MENULINE_SAVE_SLGで分岐
		COLUMN_LEFT_MENU_SHOW_SLGで分岐

	これらをまとめるためにはメニュー側に
	メニューをカラー表示する用の関数指定や次の行にコメントを添える関数
	を作ってメイン処理側で存在判定するといいかもしれません。未着手です。

	ボタンを着色することについては、
	ほとんどのメニューがトグル式でないことから問題なさそうですが
	コメントについては左カラムのメニューに出すと
	表示が崩れてあまり見た目がよくない気はします。

	特別訓練の割引がわかるのは便利なので、思いついたら改善してみます。


##国譲りとクーデターを別のメニューに
	表示を整えるため同じメニューに詰め込んだように見えたので、
	選択可否で自動的に切り替えるようになった今回からは分けてよさそうに思い、
	ファイルを分けました。


##放浪時・観戦時・通常時の分岐を選択判定側へ
	LIFEの捕虜時と通常時と同様


##EVENTBUY_SLG{メニュー番号}と本体関数の合成は行っていない
	拠点より関数が整理されていて、数が多かったので


##都市管理は右カラムを使用するが選択中色をつけていない
	選択中色のないメニューの方が多いためボタンが未対応になっています。
	オートや政策変更で直接色付けするようにしたのもあり、どうすればいいか迷っています。


##外交の見返り要求がまだ分割しきれていない
	かなり巨大そうです。


##右カラムの改変（都市管理
	SHOPとEVENTBUYを分ける作業、
	FLAG:戦略フェイズページの追加
	改行関数の使用
	ページ移動処理をまとめる
	の辺りを弄っています。

	０オリジンだと表示時にページ番号を足す必要があったので
	１オリジンにして
	現在の番号＝行番号＋１頁に表示できる情報数×ページ番号
	を
	現在の番号＝行番号＋１頁に表示できる情報数×（ページ番号−１）
	にしました（拠点のリストと同じ）

	都市管理を開いた状態でセーブしていた場合のエラー退避に
	SHOP_SLG.ERBのSHOWで１にリセットしています。

	FLAG:200がなくなりFLAG:201がFLAG:戦略フェイズページになりました。
	ページ移動についてはメニューコマンド内にあったほうが
	シンプルに考えられるのですが、
	やはりEVENTBUYやSHOWを通る過程でフラグを立てたりが大変に見えたので
	ひとまず拠点に合わせた形です。


##メニューコマンドファイルで使用している関数
	拠点フェイズでもSLG→LIFEで使用しているもの
	;「メニュー名称」の名称
	;@SHOP_SLG_NAME11
	;
	;「メニュー名称」の選択可否
	;@SHOP_SLG_CHECK11
	;
	;「メニュー名称」の左カラムメニューの入力処理
	;@SHOP_SLG_EVENTBUY11
	;
	;「メニュー名称」の表示処理
	;@SHOP_SLG_EVENTBUY_SHOW11


	拠点フェイズにはあるが戦略フェイズで使用していないもの
	;「メニュー名称」の選択可能キャラ存在判定リスト１（上）
	;@SHOP_LIFE_CHECKCHARA11(ARG:0)
	;
	;「メニュー名称」の選択可能キャラ存在判定リスト２（下・補佐）
	;@SHOP_LIFE_CHECKCHARA_SUB11(ARG:0)
	;
	;「メニュー名称」の右カラムオフ判定
	;@SHOP_LIFE_EVENTBUY_COLUMN_RIGHT_OFF_CHECK11
	;
	;「メニュー名称」の右カラムボタン入力値をキャラ番号に変換する処理のオフ判定
	;@SHOP_LIFE_USERSHOP_COLUMN_RIGHT_CONVERT_CHARANUM_OFF_CHECK11
	;
	;「メニュー名称」の右カラムキャラリスト１（上）のボタン
	;@SHOP_LIFE_LIST1_BUTTON11(ARG:0, ARG:1)
	;
	;「メニュー名称」の右カラムキャラリスト２（下）のボタン
	;@SHOP_LIFE_LIST2_BUTTON11(ARG:0, ARG:1)
	;
	;「メニュー名称」の右カラムボタンの入力処理補佐
	;@SHOP_LIFE_EVENTBUY_SUB11(ARG:0)
	;
	;「メニュー名称」のリスト１（上）入力処理
	;@SHOP_LIFE_USERSHOP11(ARG:0)
	;
	;「メニュー名称」のリスト２（下）入力処理
	;@SHOP_LIFE_USERSHOP_SUB11(ARG:0)


##メニュー整理のとき考えたこと
	蛇足ですが一応添えてみます。

	+一行目を固定行に
		拠点フェイズとの表示合わせです。


	+自動 オート設定
	       現在:手動

		カテゴリがあれば一行にまとまりそうだったので
		自動 [現在指示中] [現在委任中]←色変えでボタン表示
		に変更しました。

		自動の位置は最下部でわかりやすかったのですが、
			特殊カテゴリは独立・野に下るなど勢力を変更するコマンドを含むため、最下部に配置したい。
			拠点フェイズと表示を合わせるため、最上部に１行コメント欄を用意できる。
			説明文が２行にまたがっているメニューの表示を１行にしたい。
			自動は最も全体への影響が強いコマンドなので目立たせたい。
		等の理由で最上部に移動させました。
		慣れるまで操作しにくいかもしれません。


	+政策 政策変更
			　政策
		　政策効果

		こちらもカテゴリがあれば一行にまとまりそうだったので
		政策 [　経済成長][　徴兵効率][　防衛倍率]←色変えでボタン表示
		に変更しました。

		クリック切り替え方式なので、同じ方式である自動のすぐ下に置きました。
		（以前は自動のすぐ上だったのですが、この政策を特殊カテゴリの下に置くことに迷いがありました）

		効果1.2倍の注意書きについては表示しませんでした。
		特別訓練と同じやりかたで添えることはできそうです。

		数字が具体的だと嬉しいのですが、
		枠の狭いメインメニューで表示を崩してまで具体的にしなくても
		ヘルプのどこかにあればよさそうな気がしています。

	〜ボタン色を変えるメニューがここまで〜

	+戦略 部隊編成
	      防衛解除
	      都市管理

		都市管理はメニュー名称が政策風で、コマンド内容は情報と戦略、
		どのカテゴリに置くか迷いましたが、
		力の入ったコンテンツですし、
		戦略メニューとして扱うと一番プレイヤーに活用されるのではと思い
		ここに配置しました。

	交渉 外交
		外交は派生メニューが大量なので独立したカテゴリにしました。
		カテゴリ名は外交にすると外交・外交になるのでとりあえず交渉に。

	情報 勢力情報
	     能力一覧

		能力表示からの能力一覧が拠点側にもあるメニューなので、
		カテゴリタイトルを揃えました。
		FLAG:観戦モードで唯一使用できるメニューなので、まとめたかったのもあり。

	人材 国庫入金
	     徴兵解雇
	     スカウト
	     奴隷市場
	     特別訓練
	     割引情報

		特別訓練は独立したカテゴリにしたかったのですが、
		カテゴリ数が番号内におさまらなくなりそうで諦めました。

		独立させたかった理由は割引情報・料金情報があることです。
		２行に跨るため、補佐している情報が上下どちらのメニューのものか
		わかりにくくならないように
		カテゴリの一番下に設置することにしました。
		（よく使うので上に置きたくもあったのですが）

		訓練を最下部とすると、人材のコンテンツは
		「入金→登用→育成」という手順に並べるのが自然に思え、この並びになりました。

		できたら国庫を使う国庫入金＆徴兵と、
		個人資産を使うスカウト〜特別訓練も分けたかったのですが、カテゴリ不足。


	〜ここから領地探索以外、移籍や革命や勢力外に出る内容〜

	特殊  領地探索
	      野に下る
	      独立
	      クーデター
	      国譲り
	      仕官する
	      旗揚げする
	      訓練する
	      謁見する

		領地探索は独立したカテゴリにしたかったのですが、
		番号内におさまらなくなりそうで諦めました。

		1MBに迫る最も巨大なコンテンツですが、
		運任せの要素が強いので、余裕の出る後半に遊ぶ想定とみなして位置を下げました。
		代わりにカテゴリの一番上に置いて目立つように。

		あとは一般士官にできる行動を条件難易度順に並べ、
		次に君主にしかできない行動で並べました。

		最後、放浪時のコンテンツもぎりぎり入ったのでひとまず特殊に置きました。
		特殊カテゴリが不足するようなら、
		訓練を人材にしたり、謁見を外交にしてもいいかもしれません。

	進行 開戦

	設定 設定
	     セーブ
	     ロード

